import{_ as Q}from"./index-4d89e49a.js";import{r as y,u as pe,A as he,j as t,i as fe,B as ue,C as me,E as ge,G as xe,H as ye,a as B}from"./vendor-d2d59fe7.js";import{k as be,l as we,Q as F,a as X,f as _e,b as Se}from"./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js";import{R as De}from"./index-ac977246.js";const Ce="_chartContainer_1mphg_1",Fe="_lightMode_1mphg_47",ve="_dateFilter_1mphg_51",$e="_officefilter_1mphg_207",Ee="_topContainer_1mphg_299",je="_darkMode_1mphg_319",ke="_iconsContainer_1mphg_487",Ne="_icon_1mphg_487",Oe="_exportOptions_1mphg_571",Be="_exportOption_1mphg_571",Te="_tableContainer_1mphg_825",ze="_table_1mphg_825",Ae="_summaryHeader_1mphg_861",Ie="_periodHeader_1mphg_869",Le="_closeButton_1mphg_901",Pe="_tableWrapper_1mphg_931",We="_loadingOverlay_1mphg_939",qe="_NoDataOverlay_1mphg_963",He="_loadingSpinner_1mphg_991",Re="_boldOption_1mphg_1003",Ge="_optionGroup_1mphg_1013",n={chartContainer:Ce,lightMode:Fe,"label-text":"_label-text_1mphg_47",dateFilter:ve,officefilter:$e,topContainer:Ee,darkMode:je,"theme-container":"_theme-container_1mphg_329",iconsContainer:ke,icon:Ne,exportOptions:Oe,exportOption:Be,tableContainer:Te,table:ze,summaryHeader:Ae,periodHeader:Ie,closeButton:Le,tableWrapper:Pe,loadingOverlay:We,NoDataOverlay:qe,loadingSpinner:He,boldOption:Re,optionGroup:Ge},Qe=({selectedRange:h,themeMode:p,selectedOffice:R,isAdmin:Me,alldata:G,isLoading:M,officeName:v})=>{const[f,Z]=y.useState([]),[A,T]=y.useState(!1),I=y.useRef(null),L=y.useRef(null),[K,ee]=y.useState(!0),[P,te]=y.useState([]),[$,V]=y.useState(!1),{t:a}=pe();a("Date"),`${a("Sales")}`,`${a("Expense")}`,a("Rows"),y.useEffect(()=>{const e=g(h[0]),o=g(h[1]);e&&o&&R&&(()=>{const b=G;if(Array.isArray(b.graph1)){const d=b.graph1.map(l=>({requestedDate:g(new Date(l.requestedDate)),sales:l.totalIncome,expense:l.totalExpense}));let s=d.filter(l=>l.sales!==0||l.expense!==0);const E=d.reduce((l,w)=>l+w.sales,0).toFixed(2),_=d.reduce((l,w)=>l+w.expense,0).toFixed(2);s.push({requestedDate:a("Total"),sales:E,expense:_}),te(s),Z(b.graph1)}})()},[G]);const U=(f.filter(e=>e.totalIncome>0).reduce((e,o)=>e+o.totalIncome,0)/f.length).toFixed(0);y.useEffect(()=>{if(h[0]&&h[1]){const e=new Date(h[0]),o=new Date(h[1]),u=he(o,e)+1;ee(u<=7)}},[h,R]);const ae={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:p==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:(window.innerWidth>550,270),data:[a("Sales"),a("Expense"),a("Average Sales")],textStyle:{color:p==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:"4%",right:"3%",top:"10%",bottom:f.length>0?"15%":"20%",containLabel:f.length>0},xAxis:{type:"time",axisPointer:{label:{formatter:function(e){let o=new Date(e.value);return g(o)}}},nameLocation:"middle",nameGap:35,data:f.map(e=>e.requestedDate),axisLine:{lineStyle:{color:p==="dark"?"#ffffff":"#000000"}},axisLabel:{hideOverlap:!0,formatter:"{d} {MMM}",color:p==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,axisLine:{lineStyle:{color:p==="dark"?"#ffffff":"#000000"}},axisLabel:{color:p==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:p==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],dataZoom:[{show:!0,type:"inside",filterMode:"none",xAxisIndex:[0],startValue:new Date(h[0]),endValue:new Date(h[1])}],series:K?[{name:a("Sales"),type:"bar",data:f.map(e=>[e.requestedDate,e.totalIncome]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0]}},{name:a("Expense"),type:"bar",data:f.map(e=>[e.requestedDate,e.totalExpense]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0]}},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:f.map(e=>[e.requestedDate,U])}]:[{name:a("Sales"),type:"line",smooth:!0,symbol:"none",data:f.map(e=>[e.requestedDate,e.totalIncome])},{name:a("Expense"),type:"line",smooth:!0,symbol:"none",data:f.map(e=>[e.requestedDate,e.totalExpense])},{name:a("Average Sales"),type:"line",symbol:"none",smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:f.map(e=>[e.requestedDate,U])}]},Y=e=>{let o="";const u=new Uint8Array(e),b=u.byteLength;for(let d=0;d<b;d++)o+=String.fromCharCode(u[d]);return window.btoa(o)},oe=async()=>{const e=F.loading("Please wait..."),o=g(h[0]),u=g(h[1]),b=await Q(()=>import("./exceljs.min-e7e785f7.js").then(l=>l.e),["assets/exceljs.min-e7e785f7.js","assets/vendor-d2d59fe7.js"]),d=new b.Workbook,s=d.addWorksheet("Graph Data"),E=await B.get(X,{responseType:"blob"}),_=new FileReader;_.onload=function(){const l=_.result,w=d.addImage({base64:l,extension:"png"});s.addImage(w,{tl:{col:0,row:0},ext:{width:100,height:60}});const j=s.getCell("A1");j.value=`${a("Sales-Expense Summary")} (${v})`,j.font={bold:!0,color:{argb:"000000"},size:14},j.alignment={vertical:"middle",horizontal:"center"},s.mergeCells("A1:D1");const i=s.getCell("A2");i.value=`${a("Period")}: ${o} ${a("to")} ${u}`,i.font={bold:!0,color:{argb:"000000"},size:12},i.alignment={horizontal:"center"},s.mergeCells("A2:D2"),s.getColumn(1).width=15,s.getColumn(2).width=50,s.getColumn(3).width=15;const z=s.addRow([a("#"),a("Date"),a("Sales"),a("Expense")]);z.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},z.eachCell(r=>{r.font={bold:!0,color:{argb:"000000"},size:12},r.border={bottom:{style:"thin",color:{argb:"000000"}}}});const k=f.filter(r=>r.totalIncome!==0||r.totalExpense!==0);k.forEach((r,x)=>{const m=s.addRow([x+1,g(new Date(r.requestedDate)),Number(r.totalIncome),Number(r.totalExpense)]);m.getCell(2).numFmt="0.00",m.getCell(3).numFmt="0.00",m.getCell(1).alignment={horizontal:"left"},m.getCell(2).alignment={horizontal:"left"},m.getCell(3).alignment={horizontal:"right"},m.getCell(4).alignment={horizontal:"right"}});const N=s.addRow(["",a("Total"),"",""]);N.font={bold:!0,color:{argb:"000000"},size:12};const W=k.reduce((r,x)=>r+x.totalIncome,0),q=k.reduce((r,x)=>r+x.totalExpense,0),D=s.getCell(`C${N.number}`);D.value=`₹ ${W.toFixed(2)}`,D.alignment={horizontal:"right"};const O=s.getCell(`D${N.number}`);O.value=`₹ ${q.toFixed(2)}`,O.alignment={horizontal:"right"},d.xlsx.writeBuffer().then(async r=>{const x=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=new FormData;m.append("file",x,`${Date.now()}sales-expense_${v}_${o}_${u}.xlsx`);try{const C=await B.post("http://115.124.120.251:5064/api/uploader",m,{headers:{"Content-Type":"multipart/form-data"}});C.status==200?F.update(e,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):F.update(e,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const H=C.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${H}`}catch(C){console.error("Error saving Excel file:",C)}})},_.readAsDataURL(E.data)},ne=async()=>{const e=g(h[0]),o=g(h[1]),u=F.loading("Please wait..."),d=new URLSearchParams(window.location.search).get("lang"),s=await B.get(_e,{responseType:"arraybuffer"}),E=Y(s.data),_=await B.get(Se,{responseType:"arraybuffer"}),l=Y(_.data);Q(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js").then(w=>w.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js","assets/vendor-d2d59fe7.js","assets/index-4d89e49a.js","assets/index-0090fde3.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async w=>{let j=w.default;const i=new j;i.setFontSize(12),i.addFileToVFS("NotoSansBengali.ttf",E),i.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),i.setFont("NotoSansBengali"),i.addFileToVFS("NotoSansDevanagari.ttf",l),i.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),i.setFont("NotoSansDevanagari");const z=X,k=35,N=20;i.addImage(z,"PNG",15,9,k,N);const W=[[`${a("Sales-Expense Summary")} (${v})`]];i.autoTable({startY:27,head:W,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0},styles:{font:d==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const q=[[`${a("Period")}: ${e} ${a("to")} ${o}`]];i.autoTable({startY:36,head:q,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:d==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const D=f.filter(c=>c.totalIncome!==0||c.totalExpense!==0),O=D.map((c,S)=>[S+1,g(new Date(c.requestedDate)),`₹ ${c.totalIncome.toFixed(2)}`,`₹ ${c.totalExpense.toFixed(2)}`]),r=D.reduce((c,S)=>c+S.totalIncome,0),x=D.reduce((c,S)=>c+S.totalExpense,0);(r!==0||x!==0)&&O.push(["",a("Total"),`₹ ${r.toFixed(2)}`,`₹ ${x.toFixed(2)}`]);const m=[a("#"),a("Date"),a("Sales"),a("Expense")],C={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},H={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"},ie={0:5,1:25,2:25,3:25};i.autoTable(m,O,{startY:45,headStyles:H,columnStyles:C,styles:{font:d==="hi"?"NotoSansDevanagari":"NotoSansBengali"},columnWidth:"wrap",columnWidths:ie});const de=Date.now(),ce=new Blob([i.output("blob")],{type:"application/pdf"}),J=new FormData;J.append("file",ce,`${de}sales-expense_${v}_${e}_${o}.pdf`);try{const c=await B.post("http://115.124.120.251:5064/api/uploader",J,{headers:{"Content-Type":"multipart/form-data"}});c.status==200?F.update(u,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):F.update(u,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const S=await c.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${S}`}catch(c){console.error("Error saving PDF file:",c)}})};y.useEffect(()=>{const e=o=>{I.current&&!I.current.contains(o.target)&&L.current&&!L.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&T(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const se=()=>{T(!A)},g=e=>{if(!e)return"";const o=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${u}-${o}`},re=()=>{V(!$),T(!1)},le=(e,o)=>window.innerWidth>500||e.length<=o?e:e.substring(0,o)+"...";return t.jsxs("div",{className:`${n.chartContainer} ${p==="dark"?n.darkMode:n.lightMode}`,children:[t.jsx(be,{position:"top-center",theme:p}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${p==="dark"?n.darkMode:n.lightMode}`,children:[a("Sales-Expense")," ",a("of")," ",le(v,10)]}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:I,children:t.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${n.icon} ${p==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:se,children:A?t.jsx(fe,{style:{fontSize:"1.1rem"}}):t.jsx(ue,{style:{fontSize:"1.1rem"}})}),A&&t.jsxs("div",{className:`${n.exportOptions} ${p==="dark"?n.darkMode:n.lightMode}`,ref:L,children:[$?t.jsxs("div",{className:n.exportOption,onClick:()=>{V(!$),T(!1)},children:[t.jsx(ge,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:n.exportOption,onClick:re,children:[t.jsx(me,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:n.exportOption,onClick:oe,children:[t.jsx(xe,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:n.exportOption,onClick:ne,children:[t.jsx(ye,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),M&&t.jsx("div",{className:n.NoDataOverlay,children:t.jsx("img",{src:we,alt:"Loading...",width:50,height:50})}),P.length==1&&!$&&!M?t.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",$?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table ${p=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:a("Date")}),t.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]}),t.jsxs("th",{scope:"col",children:[a("Expense"),"(₹)"]})]})}),t.jsx("tbody",{children:P.map((e,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:P.length-1===o?"":o+1}),t.jsx("td",{children:e.requestedDate}),t.jsx("td",{children:parseFloat(e.sales).toFixed(2)}),t.jsx("td",{children:parseFloat(e.expense).toFixed(2)})]},e.requestedDate))})]})}):t.jsx(De,{option:ae,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:p==="dark"?n.darkMode:n.lightMode})]})};export{Qe as default};
