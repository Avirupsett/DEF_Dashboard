import{_ as Z}from"./index-a969bf75.js";import{r as x,u as ue,z as ge,j as t,i as me,A as xe,B as ye,C as be,E as we,G as Se,a as B}from"./vendor-fe8b2466.js";import{L as K,R as _e}from"./index-e2efe08c.js";import{k as De,l as Fe,Q as v,a as ee,f as Ce,b as ve}from"./NotoSansDevanagari-VariableFont_wdth_wght-3d850415.js";const Ee="_chartContainer_1mphg_1",$e="_lightMode_1mphg_47",je="_dateFilter_1mphg_51",ke="_officefilter_1mphg_207",Ne="_topContainer_1mphg_299",Oe="_darkMode_1mphg_319",Be="_iconsContainer_1mphg_487",Ae="_icon_1mphg_487",Ie="_exportOptions_1mphg_571",Te="_exportOption_1mphg_571",ze="_tableContainer_1mphg_825",Le="_table_1mphg_825",Pe="_summaryHeader_1mphg_861",We="_periodHeader_1mphg_869",qe="_closeButton_1mphg_901",Re="_tableWrapper_1mphg_931",Ge="_loadingOverlay_1mphg_939",He="_NoDataOverlay_1mphg_963",Me="_loadingSpinner_1mphg_991",Ve="_boldOption_1mphg_1003",Ue="_optionGroup_1mphg_1013",i={chartContainer:Ee,lightMode:$e,"label-text":"_label-text_1mphg_47",dateFilter:je,officefilter:ke,topContainer:Ne,darkMode:Oe,"theme-container":"_theme-container_1mphg_329",iconsContainer:Be,icon:Ae,exportOptions:Ie,exportOption:Te,tableContainer:ze,table:Le,summaryHeader:Pe,periodHeader:We,closeButton:qe,tableWrapper:Re,loadingOverlay:Ge,NoDataOverlay:He,loadingSpinner:Me,boldOption:Ve,optionGroup:Ue},Ke=({selectedRange:u,themeMode:h,showGraph:M,selectedOffice:V,isAdmin:Ye,alldata:U,isLoading:Y,officeName:E})=>{const[g,te]=x.useState([]),[z,A]=x.useState(!1),L=x.useRef(null),P=x.useRef(null),[ae,oe]=x.useState(!0),[W,ne]=x.useState([]),[$,q]=x.useState(!1),{t:a}=ue();a("Date"),`${a("Sales")}`,`${a("Expense")}`,a("Rows"),x.useEffect(()=>{const e=y(u[0]),o=y(u[1]);e&&o&&V&&(()=>{const r=U;if(Array.isArray(r.graph1)){const n=r.graph1.map(c=>({requestedDate:y(new Date(c.requestedDate)),sales:c.totalIncome,expense:c.totalExpense}));let l=n.filter(c=>c.sales!==0||c.expense!==0);const _=n.reduce((c,S)=>c+S.sales,0).toFixed(2),w=n.reduce((c,S)=>c+S.expense,0).toFixed(2);l.push({requestedDate:a("Total"),sales:_,expense:w}),ne(l),te(r.graph1)}})()},[U]),x.useEffect(()=>{q(!M)},[M]);const J=(g.filter(e=>e.totalIncome>0).reduce((e,o)=>e+o.totalIncome,0)/g.length).toFixed(0);x.useEffect(()=>{if(u[0]&&u[1]){const e=new Date(u[0]),o=new Date(u[1]),s=ge(o,e)+1;oe(s<=7)}},[u,V]);function I(e,o){var s=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16);s=parseInt(s*(100+o)/100),r=parseInt(r*(100+o)/100),n=parseInt(n*(100+o)/100),s=s<255?s:255,r=r<255?r:255,n=n<255?n:255,s=Math.round(s),r=Math.round(r),n=Math.round(n);var l=s.toString(16).length==1?"0"+s.toString(16):s.toString(16),_=r.toString(16).length==1?"0"+r.toString(16):r.toString(16),w=n.toString(16).length==1?"0"+n.toString(16):n.toString(16);return"#"+l+_+w}const se={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:h==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:(window.innerWidth>550,270),data:[a("Sales"),a("Expense"),a("Average Sales")],textStyle:{color:h==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:"4%",right:"3%",top:"10%",bottom:g.length>0?"15%":"20%",containLabel:g.length>0},xAxis:{type:"time",axisPointer:{label:{formatter:function(e){let o=new Date(e.value);return y(o)}}},nameLocation:"middle",nameGap:35,data:g.map(e=>e.requestedDate),axisLine:{lineStyle:{color:h==="dark"?"#ffffff":"#000000"}},axisLabel:{rotate:window.innerWidth<768?45:0,hideOverlap:!0,formatter:"{d} {MMM}",color:h==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,axisLine:{lineStyle:{color:h==="dark"?"#ffffff":"#000000"}},axisLabel:{color:h==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:h==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],dataZoom:[{show:!0,type:"inside",filterMode:"none",xAxisIndex:[0],startValue:new Date(u[0]),endValue:new Date(u[1])}],series:ae?[{name:a("Sales"),type:"bar",data:g.map(e=>[e.requestedDate,e.totalIncome]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0],color:new K(0,0,0,1,[{offset:1,color:I("#66BA69",0)},{offset:0,color:I("#66BA69",30)}])}},{name:a("Expense"),type:"bar",data:g.map(e=>[e.requestedDate,e.totalExpense]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0],color:new K(0,0,0,1,[{offset:1,color:I("#E81A1A",0)},{offset:0,color:I("#ff1A1A",40)}])}},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,itemStyle:{color:"#FFC107"},lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:g.map(e=>[e.requestedDate,J])}]:[{name:a("Sales"),type:"line",smooth:!0,symbol:"none",data:g.map(e=>[e.requestedDate,e.totalIncome])},{name:a("Expense"),type:"line",smooth:!0,symbol:"none",data:g.map(e=>[e.requestedDate,e.totalExpense])},{name:a("Average Sales"),itemStyle:{color:"#FFC107"},type:"line",symbol:"none",smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:g.map(e=>[e.requestedDate,J])}]},Q=e=>{let o="";const s=new Uint8Array(e),r=s.byteLength;for(let n=0;n<r;n++)o+=String.fromCharCode(s[n]);return window.btoa(o)},re=async()=>{const e=v.loading("Please wait..."),o=y(u[0]),s=y(u[1]),r=await Z(()=>import("./exceljs.min-9dc286db.js").then(c=>c.e),["assets/exceljs.min-9dc286db.js","assets/vendor-fe8b2466.js"]),n=new r.Workbook,l=n.addWorksheet("Graph Data"),_=await B.get(ee,{responseType:"blob"}),w=new FileReader;w.onload=function(){const c=w.result,S=n.addImage({base64:c,extension:"png"});l.addImage(S,{tl:{col:0,row:0},ext:{width:100,height:60}});const j=l.getCell("A1");j.value=`${a("Sales-Expense Summary")} (${E})`,j.font={bold:!0,color:{argb:"000000"},size:14},j.alignment={vertical:"middle",horizontal:"center"},l.mergeCells("A1:D1");const p=l.getCell("A2");p.value=`${a("Period")}: ${o} ${a("to")} ${s}`,p.font={bold:!0,color:{argb:"000000"},size:12},p.alignment={horizontal:"center"},l.mergeCells("A2:D2"),l.getColumn(1).width=15,l.getColumn(2).width=50,l.getColumn(3).width=15;const T=l.addRow([a("#"),a("Date"),a("Sales"),a("Expense")]);T.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},T.eachCell(d=>{d.font={bold:!0,color:{argb:"000000"},size:12},d.border={bottom:{style:"thin",color:{argb:"000000"}}}});const k=g.filter(d=>d.totalIncome!==0||d.totalExpense!==0);k.forEach((d,b)=>{const m=l.addRow([b+1,y(new Date(d.requestedDate)),Number(d.totalIncome),Number(d.totalExpense)]);m.getCell(2).numFmt="0.00",m.getCell(3).numFmt="0.00",m.getCell(1).alignment={horizontal:"left"},m.getCell(2).alignment={horizontal:"left"},m.getCell(3).alignment={horizontal:"right"},m.getCell(4).alignment={horizontal:"right"}});const N=l.addRow(["",a("Total"),"",""]);N.font={bold:!0,color:{argb:"000000"},size:12};const R=k.reduce((d,b)=>d+b.totalIncome,0),G=k.reduce((d,b)=>d+b.totalExpense,0),F=l.getCell(`C${N.number}`);F.value=`₹ ${R.toFixed(2)}`,F.alignment={horizontal:"right"};const O=l.getCell(`D${N.number}`);O.value=`₹ ${G.toFixed(2)}`,O.alignment={horizontal:"right"},n.xlsx.writeBuffer().then(async d=>{const b=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=new FormData;m.append("file",b,`${Date.now()}sales-expense_${E}_${o}_${s}.xlsx`);try{const C=await B.post("http://115.124.120.251:5064/api/uploader",m,{headers:{"Content-Type":"multipart/form-data"}});C.status==200?v.update(e,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(e,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const H=C.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${H}`}catch(C){console.error("Error saving Excel file:",C)}})},w.readAsDataURL(_.data)},le=async()=>{const e=y(u[0]),o=y(u[1]),s=v.loading("Please wait..."),n=new URLSearchParams(window.location.search).get("lang"),l=await B.get(Ce,{responseType:"arraybuffer"}),_=Q(l.data),w=await B.get(ve,{responseType:"arraybuffer"}),c=Q(w.data);Z(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-3d850415.js").then(S=>S.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-3d850415.js","assets/vendor-fe8b2466.js","assets/index-a969bf75.js","assets/index-0653e607.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async S=>{let j=S.default;const p=new j;p.setFontSize(12),p.addFileToVFS("NotoSansBengali.ttf",_),p.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),p.setFont("NotoSansBengali"),p.addFileToVFS("NotoSansDevanagari.ttf",c),p.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),p.setFont("NotoSansDevanagari");const T=ee,k=35,N=20;p.addImage(T,"PNG",15,9,k,N);const R=[[`${a("Sales-Expense Summary")} (${E})`]];p.autoTable({startY:27,head:R,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0},styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const G=[[`${a("Period")}: ${e} ${a("to")} ${o}`]];p.autoTable({startY:36,head:G,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const F=g.filter(f=>f.totalIncome!==0||f.totalExpense!==0),O=F.map((f,D)=>[D+1,y(new Date(f.requestedDate)),`₹ ${f.totalIncome.toFixed(2)}`,`₹ ${f.totalExpense.toFixed(2)}`]),d=F.reduce((f,D)=>f+D.totalIncome,0),b=F.reduce((f,D)=>f+D.totalExpense,0);(d!==0||b!==0)&&O.push(["",a("Total"),`₹ ${d.toFixed(2)}`,`₹ ${b.toFixed(2)}`]);const m=[a("#"),a("Date"),a("Sales"),a("Expense")],C={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},H={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"},pe={0:5,1:25,2:25,3:25};p.autoTable(m,O,{startY:45,headStyles:H,columnStyles:C,styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"},columnWidth:"wrap",columnWidths:pe});const fe=Date.now(),he=new Blob([p.output("blob")],{type:"application/pdf"}),X=new FormData;X.append("file",he,`${fe}sales-expense_${E}_${e}_${o}.pdf`);try{const f=await B.post("http://115.124.120.251:5064/api/uploader",X,{headers:{"Content-Type":"multipart/form-data"}});f.status==200?v.update(s,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(s,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const D=await f.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${D}`}catch(f){console.error("Error saving PDF file:",f)}})};x.useEffect(()=>{const e=o=>{L.current&&!L.current.contains(o.target)&&P.current&&!P.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&A(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const ie=()=>{A(!z)},y=e=>{if(!e)return"";const o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${s}-${o}`},de=()=>{q(!$),A(!1)},ce=(e,o)=>window.innerWidth>500||e.length<=o?e:e.substring(0,o)+"...";return t.jsxs("div",{className:`${i.chartContainer} ${h==="dark"?i.darkMode:i.lightMode}`,children:[t.jsx(De,{position:"top-center",theme:h}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("div",{className:`fw-bold noselect fs-${window.innerWidth<=768?7:5} ${h==="dark"?i.darkMode:i.lightMode}`,children:[a("Sales-Expense")," ",a("of")," ",ce(E,10)]}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:L,children:t.jsxs("div",{className:`${i.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${i.icon} ${h==="dark"?i.darkMode:i.lightMode} px-2 py-1`,onClick:ie,children:z?t.jsx(me,{style:{fontSize:"1.1rem"}}):t.jsx(xe,{style:{fontSize:"1.1rem"}})}),z&&t.jsxs("div",{className:`${i.exportOptions} ${h==="dark"?i.darkMode:i.lightMode}`,ref:P,children:[$?t.jsxs("div",{className:i.exportOption,onClick:()=>{q(!$),A(!1)},children:[t.jsx(be,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:i.exportOption,onClick:de,children:[t.jsx(ye,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:i.exportOption,onClick:re,children:[t.jsx(we,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:i.exportOption,onClick:le,children:[t.jsx(Se,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),Y&&t.jsx("div",{className:i.NoDataOverlay,children:t.jsx("img",{src:Fe,alt:"Loading...",width:50,height:50})}),W.length==1&&!$&&!Y?t.jsx("div",{className:`${i.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",$?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table ${h=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:a("Date")}),t.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]}),t.jsxs("th",{scope:"col",children:[a("Expense"),"(₹)"]})]})}),t.jsx("tbody",{children:W.map((e,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:W.length-1===o?"":o+1}),t.jsx("td",{children:e.requestedDate}),t.jsx("td",{children:parseFloat(e.sales).toFixed(2)}),t.jsx("td",{children:parseFloat(e.expense).toFixed(2)})]},e.requestedDate))})]})}):t.jsx(_e,{option:se,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:h==="dark"?i.darkMode:i.lightMode})]})};export{Ke as default};
