import{_ as Y}from"./index-4d89e49a.js";import{r as f,u as rt,j as t,i as lt,B as it,C as ct,P as dt,G as ut,H as pt,a as B}from"./vendor-d2d59fe7.js";import{R as ht}from"./index-ac977246.js";import{k as gt,l as ft,Q as y,a as q,f as mt,b as _t}from"./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js";const xt="_piechart_7z7nz_11",yt="_chartContainer_7z7nz_23",Ct="_legendButtonContainer_7z7nz_49",bt="_legendButton_7z7nz_49",zt="_codeBlockIcon_7z7nz_133",wt="_lightMode_7z7nz_191",St="_dateFilter_7z7nz_195",Ft="_officefilter_7z7nz_351",jt="_topContainer_7z7nz_443",Dt="_darkMode_7z7nz_463",Nt="_iconsContainer_7z7nz_631",$t="_icon_7z7nz_631",vt="_exportOptions_7z7nz_715",kt="_exportOption_7z7nz_715",Ot="_NoDataOverlay_7z7nz_861",Pt="_tableContainer_7z7nz_993",Bt="_table_7z7nz_993",Mt="_summaryHeader_7z7nz_1029",Et="_periodHeader_7z7nz_1037",Tt="_closeButton_7z7nz_1069",Lt="_tableWrapper_7z7nz_1099",It="_loadingOverlay_7z7nz_1107",At="_loadingSpinner_7z7nz_1133",Ht="_boldOption_7z7nz_1145",Rt="_optionGroup_7z7nz_1155",a={piechart:xt,chartContainer:yt,"legend-text":"_legend-text_7z7nz_31",legendButtonContainer:Ct,legendButton:bt,codeBlockIcon:zt,lightMode:wt,"label-text":"_label-text_7z7nz_191",dateFilter:St,officefilter:Ft,topContainer:jt,darkMode:Dt,"theme-container":"_theme-container_7z7nz_473",iconsContainer:Nt,icon:$t,exportOptions:vt,exportOption:kt,NoDataOverlay:Ot,tableContainer:Pt,table:Bt,summaryHeader:Mt,periodHeader:Et,closeButton:Tt,tableWrapper:Lt,loadingOverlay:It,loadingSpinner:At,boldOption:Ht,optionGroup:Rt},Jt=({themeMode:m,selectedRange:x,selectedOffice:J,isAdmin:Wt,alldata:M,officeName:D,isLoading:H})=>{const[u,Q]=f.useState([]),[E,N]=f.useState(!1),T=f.useRef(null),L=f.useRef(null),{t:o}=rt(),[C,X]=f.useState([]),[b,R]=f.useState(!1);f.useEffect(()=>{const e=U(x[0]),n=U(x[1]);if(e&&n&&J&&M.graph5){const r=M.graph5;Q(r);const p=r.reduce((i,s)=>i+s.Count,0);X([...r,{PaymentModeName:"Total",Count:p}])}},[M]);const K={polar:{radius:[30,"80%"]},radiusAxis:{type:"value",axisTick:{show:!1},axisLabel:{show:!1},max:u.length>0?u.sort((e,n)=>n.Count-e.Count)[1].Count+5:5},angleAxis:{type:"category",data:u.map(e=>o(e.PaymentModeName)),startAngle:75,axisLabel:{color:m==="dark"?"#ffffff":"#000000"}},tooltip:{},series:{type:"bar",data:u.map(e=>({value:e.Count,itemStyle:{color:e.PaymentModeName==o("UPI")?"#5fb476":e.PaymentModeName==o("Card")?"#f0d070":e.PaymentModeName==o("Cash")?"#73a2ee":"#e77267"}})),coordinateSystem:"polar",label:{show:!0,position:"middle",formatter:"{c}"}},animation:!0},W=e=>{let n="";const r=new Uint8Array(e),p=r.byteLength;for(let i=0;i<p;i++)n+=String.fromCharCode(r[i]);return window.btoa(n)},$=e=>{if(!e)return"";const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${r}-${n}`},U=e=>{if(!e)return"";const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${n}-${r}-${p}`},Z=async()=>{const e=y.loading("Please wait..."),n=$(x[0]),r=$(x[1]),p=await Y(()=>import("./exceljs.min-e7e785f7.js").then(_=>_.e),["assets/exceljs.min-e7e785f7.js","assets/vendor-d2d59fe7.js"]),i=new p.Workbook,s=i.addWorksheet("Data");fetch(q).then(_=>_.blob()).then(async _=>{const z=new FileReader;z.onload=async function(){const I=z.result,w=i.addImage({base64:I,extension:"png"});s.addImage(w,{tl:{col:0,row:0},ext:{width:100,height:60}});const S=s.getCell("A1");S.value=`${o("Payment Mode Data")} (${D})`,S.font={bold:!0,color:{argb:"000000"},size:14},S.alignment={vertical:"middle",horizontal:"center"},s.mergeCells("A1:D1");const l=s.getCell("A2");l.value=`${o("Period")}: ${n} ${o("to")} ${r}`,l.font={bold:!0,color:{argb:"000000"},size:12},l.alignment={horizontal:"center"},s.mergeCells("A2:D2"),s.getColumn(1).width=15,s.getColumn(2).width=50,s.getColumn(3).width=15,s.getColumn(4).width=15;const v=s.addRow([o("#"),o("Payment"),o("Count")]);v.font={bold:!0,color:{argb:"000000"},size:12},v.eachCell(c=>{c.font={bold:!0,color:{argb:"000000"},size:12},c.border={bottom:{style:"thin",color:{argb:"000000"}}}}),u.forEach((c,g)=>{const d=s.addRow([g+1,c.PaymentModeName,c.Count]);d.getCell(1).alignment={horizontal:"left"},d.getCell(2).alignment={horizontal:"left"},d.getCell(3).alignment={horizontal:"right"},d.getCell(4).alignment={horizontal:"right"}});const k=s.addRow(["",o("Total"),""]);k.font={bold:!0,color:{argb:"000000"},size:12};const O=u.reduce((c,g)=>c+g.Count,0),F=s.getCell(`C${k.number}`);F.value=`${O}`,F.alignment={horizontal:"right"};const A=`${Date.now()}PaymentMode_${D}_${n}_${r}.xlsx`;i.xlsx.writeBuffer().then(async c=>{const g=new FormData;g.append("file",new Blob([c]),A);try{const d=await B.post("http://115.124.120.251:5064/api/uploader",g,{headers:{"Content-Type":"multipart/form-data"}});d.status==200?y.update(e,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):y.update(e,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const P=d.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${P}`}catch(d){console.error("Error saving Excel file:",d)}})},z.readAsDataURL(_)})},tt=async()=>{const e=y.loading("Please wait..."),n=$(x[0]),r=$(x[1]),i=new URLSearchParams(window.location.search).get("lang"),s=await B.get(mt,{responseType:"arraybuffer"}),_=W(s.data),z=await B.get(_t,{responseType:"arraybuffer"}),I=W(z.data);Y(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js").then(w=>w.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js","assets/vendor-d2d59fe7.js","assets/index-4d89e49a.js","assets/index-0090fde3.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async w=>{let S=w.default;const l=new S;l.addFileToVFS("NotoSansBengali.ttf",_),l.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),l.setFont("NotoSansBengali"),l.addFileToVFS("NotoSansDevanagari.ttf",I),l.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),l.setFont("NotoSansDevanagari");const v=[[o("#"),o("Payment"),o("Count")]],k={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"}},O={fontSize:12,fontStyle:"bold",halign:"center"},F={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},G=q,A=35,c=20;l.addImage(G,"PNG",15,12,A,c);const g=[[`${o("Payment Mode")} (${D})`]];l.autoTable({head:g,body:[],headStyles:{...O,fillColor:F.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:i==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const d=[[`${o("Period")}: ${n} ${o("to")} ${r}`]];l.autoTable({startY:39.5,head:d,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:i==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let P=u.map((h,j)=>[j+1,h.PaymentModeName,`${h.Count}`]);const ot=u.reduce((h,j)=>h+j.Count,0);P.push(["",o("Total"),ot]);const nt={startY:l.autoTable.previous.finalY+1,head:v,body:P,headStyles:{...O,fillColor:F.secondHeader,textColor:"#FFFFFF"},columnStyles:k,styles:{font:i==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};l.autoTable(nt);const at=`${Date.now()}PaymentMode_${D}_${n}_${r}.pdf`,st=l.output("blob"),V=new FormData;V.append("file",st,at);try{const h=await B.post("http://115.124.120.251:5064/api/uploader",V,{headers:{"Content-Type":"multipart/form-data"}});h.status==200?y.update(e,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):y.update(e,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const j=await h.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${j}`}catch(h){console.error("Error saving PDF file:",h)}})};f.useEffect(()=>{const e=n=>{T.current&&!T.current.contains(n.target)&&L.current&&!L.current.contains(n.target)&&n.target.tagName!=="svg"&&n.target.tagName!=="path"&&N(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const et=()=>{N(!E)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${a.chartContainer} ${m==="dark"?a.darkMode:a.lightMode}`,children:[t.jsx(gt,{position:"top-center",theme:m}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsx("div",{className:"d-flex align-items-center",children:t.jsx("div",{className:`fw-bold me-2 fs-${window.innerWidth<=768?7:5} ${m==="dark"?a.darkMode:a.lightMode}`,children:o("Payment Mode")})}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:T,children:t.jsxs("div",{className:`${a.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${a.icon} ${m==="dark"?a.darkMode:a.lightMode} px-2 py-1`,onClick:et,children:E?t.jsx(lt,{style:{fontSize:"1.1rem"}}):t.jsx(it,{style:{fontSize:"1.1rem"}})}),E&&t.jsxs("div",{className:`${a.exportOptions} ${m==="dark"?a.darkMode:a.lightMode}`,ref:L,children:[b?t.jsxs("div",{className:a.exportOption,onClick:()=>{R(!b),N(!1)},children:[t.jsx(dt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:o("View Graph")})]}):t.jsxs("div",{className:a.exportOption,onClick:()=>{R(!b),N(!1)},children:[t.jsx(ct,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:o("View Table")})]}),t.jsxs("div",{className:a.exportOption,onClick:Z,children:[t.jsx(ut,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:o("Export to Excel")})]}),t.jsxs("div",{className:a.exportOption,onClick:tt,children:[t.jsx(pt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:o("Export to PDF")})]})]})]})})]})}),H&&t.jsx("div",{className:a.loadingOverlay,children:t.jsx("img",{src:ft,alt:"Loading...",width:50,height:50})}),C.length>0&&C[C.length-1].Count===0&&!b&&!H?t.jsx("div",{className:`${a.loadingOverlay} fs-5`,children:o("No Data Found")}):"",b?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"342px"},children:t.jsxs("table",{className:`table  ${m=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:o("Payment")}),t.jsx("th",{scope:"col",children:o("Count")})]})}),t.jsx("tbody",{children:C.map((e,n)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:C.length-1===n?"":n+1}),t.jsx("td",{children:e.PaymentModeName}),t.jsx("td",{children:e.Count})]},e.PaymentModeName))})]})}):t.jsx(ht,{option:K,style:{height:"350px",width:"100%",maxWidth:"2300px"},className:a.piechart},u.length)]})})};export{Jt as default};
