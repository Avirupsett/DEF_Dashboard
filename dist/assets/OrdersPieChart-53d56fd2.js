import{_ as K}from"./index-4d89e49a.js";import{r as g,u as yt,M as bt,j as t,T as _t,N as St,O as Z,i as wt,B as Ct,C as Ft,P as jt,G as Nt,H as $t,a as E}from"./vendor-d2d59fe7.js";import{R as vt}from"./index-ac977246.js";import{k as Dt,l as kt,Q as C,a as tt,f as Ot,b as Bt}from"./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js";const Tt="_piechart_1ah4s_11",Pt="_chartContainer_1ah4s_23",zt="_legendButtonContainer_1ah4s_49",Et="_legendButton_1ah4s_49",Lt="_codeBlockIcon_1ah4s_133",Rt="_lightMode_1ah4s_191",Wt="_dateFilter_1ah4s_195",It="_officefilter_1ah4s_351",Qt="_topContainer_1ah4s_443",Ht="_darkMode_1ah4s_463",At="_iconsContainer_1ah4s_631",Mt="_icon_1ah4s_631",Gt="_exportOptions_1ah4s_715",qt="_exportOption_1ah4s_715",Ut="_NoDataOverlay_1ah4s_861",Vt="_tableContainer_1ah4s_993",Yt="_table_1ah4s_993",Jt="_summaryHeader_1ah4s_1029",Xt="_periodHeader_1ah4s_1037",Kt="_closeButton_1ah4s_1069",Zt="_tableWrapper_1ah4s_1099",te="_loadingOverlay_1ah4s_1107",ee="_loadingSpinner_1ah4s_1133",oe="_boldOption_1ah4s_1145",ae="_optionGroup_1ah4s_1155",s={piechart:Tt,chartContainer:Pt,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:zt,legendButton:Et,codeBlockIcon:Lt,lightMode:Rt,"label-text":"_label-text_1ah4s_191",dateFilter:Wt,officefilter:It,topContainer:Qt,darkMode:Ht,"theme-container":"_theme-container_1ah4s_473",iconsContainer:At,icon:Mt,exportOptions:Gt,exportOption:qt,NoDataOverlay:Ut,tableContainer:Vt,table:Yt,summaryHeader:Jt,periodHeader:Xt,closeButton:Kt,tableWrapper:Zt,loadingOverlay:te,loadingSpinner:ee,boldOption:oe,optionGroup:ae},he=({themeMode:y,selectedRange:v,selectedOffice:ne,isAdmin:se,alldata:L,isLoading:U,officeName:D})=>{const[S,et]=g.useState([]),[V,ot]=g.useState([]),[R,at]=g.useState([]),[W,F]=g.useState(!1),I=g.useRef(null),Q=g.useRef(null),H=g.useRef(null),{t:e}=yt(),[A,M]=g.useState(!1),[k,nt]=g.useState([]),[j,G]=g.useState(!1),[w,st]=g.useState("Sale");function lt(o){return o.flatMap(i=>i.lstproduct).reduce((i,d)=>{const{productName:n,totalSales:p,qty:l,color:c,unitShortName:h}=d;return p!==0&&(i[n]?(i[n].totalSales+=p,i[n].qty+=l):i[n]={totalSales:p,qty:l,color:c,unitShortName:h}),i},{})}g.useEffect(()=>{if(L.graph2){const o=lt(L.graph2),a=Object.entries(o).map(([l,{totalSales:c,color:h}])=>({value:c.toFixed(2),name:l,itemStyle:{color:h}}));at(a);const u=Object.entries(o).map(([l,{qty:c,color:h}])=>({value:c.toFixed(2),name:l,itemStyle:{color:h}}));ot(u);const i=Object.entries(o).map(([l,{totalSales:c,color:h,qty:b,unitShortName:r}])=>({productName:l,totalSale:c.toFixed(2),color:h,totalQty:b.toFixed(2),unit:r}));et(i);const d=Object.entries(o).map(([l,{totalSales:c,qty:h,unitShortName:b}])=>({ProductName:l,Sales:c.toFixed(1),Quantity:`${h.toFixed(1)} ${b}`})),n=i.reduce((l,c)=>l+parseFloat(c.totalSale),0).toFixed(2),p=i.reduce((l,c)=>l+parseFloat(c.totalQty),0);d.push({ProductName:e("Total"),Sales:`${n}`,Quantity:`${p}`}),nt(d)}},[L]);const rt=()=>{S.length>0&&(M(!A),F(!1),G(!1))},it={tooltip:{trigger:"item",formatter:w==="Sale"?`<b>{b}</b><br><b>${e("Total Sales")}:</b> {c}`:`<b>{b}</b><br><b>${e("Total Qty")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:y==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:A,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:y==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"2%",style:{fill:y==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Sales",type:"pie",radius:w==="Sale"?["40%","65%"]:["35%","70%"],roseType:w==="Sale"?"":"radius",center:["50%","50%"],selectedMode:"single",avoidLabelOverlap:!0,label:{show:R.length<=10,color:y==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:w==="Sale"?R.length>0?R:[]:V.length>0?V:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},Y=o=>{let a="";const u=new Uint8Array(o),i=u.byteLength;for(let d=0;d<i;d++)a+=String.fromCharCode(u[d]);return window.btoa(a)},O=o=>{if(!o)return"";const a=o.getFullYear(),u=String(o.getMonth()+1).padStart(2,"0");return`${String(o.getDate()).padStart(2,"0")}-${u}-${a}`},ct=async()=>{const o=C.loading("Please wait..."),a=O(v[0]),u=O(v[1]),i=await K(()=>import("./exceljs.min-e7e785f7.js").then(p=>p.e),["assets/exceljs.min-e7e785f7.js","assets/vendor-d2d59fe7.js"]),d=new i.Workbook,n=d.addWorksheet("Data");fetch(tt).then(p=>p.blob()).then(async p=>{const l=new FileReader;l.onload=async function(){const c=l.result,h=d.addImage({base64:c,extension:"png"});n.addImage(h,{tl:{col:0,row:0},ext:{width:100,height:60}});const b=n.getCell("A1");b.value=`${e("Product Wise Summary Data")} (${D})`,b.font={bold:!0,color:{argb:"000000"},size:14},b.alignment={vertical:"middle",horizontal:"center"},n.mergeCells("A1:D1");const r=n.getCell("A2");r.value=`${e("Period")}: ${a} ${e("to")} ${u}`,r.font={bold:!0,color:{argb:"000000"},size:12},r.alignment={horizontal:"center"},n.mergeCells("A2:D2"),n.getColumn(1).width=15,n.getColumn(2).width=50,n.getColumn(3).width=15,n.getColumn(4).width=15;const B=n.addRow([e("#"),e("Product Name"),e("Quantity"),e("Total Sales")]);B.font={bold:!0,color:{argb:"000000"},size:12},B.eachCell(f=>{f.font={bold:!0,color:{argb:"000000"},size:12},f.border={bottom:{style:"thin",color:{argb:"000000"}}}}),S.forEach((f,_)=>{const m=n.addRow([_+1,f.productName,`${f.totalQty} ${f.unit}`,f.totalSale]);m.getCell(1).alignment={horizontal:"left"},m.getCell(2).alignment={horizontal:"left"},m.getCell(3).alignment={horizontal:"right"},m.getCell(4).alignment={horizontal:"right"}});const T=n.addRow(["",e("Total"),"",""]);T.font={bold:!0,color:{argb:"000000"},size:12};const P=S.reduce((f,_)=>f+parseFloat(_.totalSale),0),N=n.getCell(`D${T.number}`);N.value=`₹ ${P.toFixed(2)}`,N.alignment={horizontal:"right"};const q=`${Date.now()}product_wise_summary_${D}_${a}_${u}.xlsx`;d.xlsx.writeBuffer().then(async f=>{const _=new FormData;_.append("file",new Blob([f]),q);try{const m=await E.post("http://115.124.120.251:5064/api/uploader",_,{headers:{"Content-Type":"multipart/form-data"}});m.status==200?C.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):C.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const z=m.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${z}`}catch(m){console.error("Error saving Excel file:",m)}})},l.readAsDataURL(p)})},dt=async()=>{const o=C.loading("Please wait..."),a=O(v[0]),u=O(v[1]),d=new URLSearchParams(window.location.search).get("lang"),n=await E.get(Ot,{responseType:"arraybuffer"}),p=Y(n.data),l=await E.get(Bt,{responseType:"arraybuffer"}),c=Y(l.data);K(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js").then(h=>h.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js","assets/vendor-d2d59fe7.js","assets/index-4d89e49a.js","assets/index-0090fde3.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async h=>{let b=h.default;const r=new b;r.addFileToVFS("NotoSansBengali.ttf",p),r.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),r.setFont("NotoSansBengali"),r.addFileToVFS("NotoSansDevanagari.ttf",c),r.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),r.setFont("NotoSansDevanagari");const B=[[e("#"),e("Product Name"),e("Quantity"),e("Total Sale")]],T={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},P={fontSize:12,fontStyle:"bold",halign:"center"},N={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},J=tt,q=35,f=20;r.addImage(J,"PNG",15,12,q,f);const _=[[`${e("Product Wise Summary Data")} (${D})`]];r.autoTable({head:_,body:[],headStyles:{...P,fillColor:N.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:d==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const m=[[`${e("Period")}: ${a} ${e("to")} ${u}`]];r.autoTable({startY:39.5,head:m,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:d==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let z=S.map((x,$)=>[$+1,x.productName,`${x.totalQty} ${x.unit}`,`₹ ${x.totalSale}`]);const ft=S.reduce((x,$)=>x+parseFloat($.totalSale),0);z.push(["",e("Total"),"",`₹ ${ft.toFixed(2)}`]);const gt={startY:r.autoTable.previous.finalY+1,head:B,body:z,headStyles:{...P,fillColor:N.secondHeader,textColor:"#FFFFFF"},columnStyles:T,styles:{font:d==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};r.autoTable(gt);const mt=`${Date.now()}product_wise_summary_${D}_${a}_${u}.pdf`,xt=r.output("blob"),X=new FormData;X.append("file",xt,mt);try{const x=await E.post("http://115.124.120.251:5064/api/uploader",X,{headers:{"Content-Type":"multipart/form-data"}});x.status==200?C.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):C.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const $=await x.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${$}`}catch(x){console.error("Error saving PDF file:",x)}})};g.useEffect(()=>{const o=a=>{I.current&&!I.current.contains(a.target)&&Q.current&&!Q.current.contains(a.target)&&a.target.tagName!=="svg"&&a.target.tagName!=="path"&&F(!1),H.current&&!H.current.contains(a.target)&&M(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const ht=()=>{M(!1),F(!W)},ut=(o,a)=>{a!==null&&st(a)},pt=bt({typography:{button:{textTransform:"none"}}});return t.jsx(t.Fragment,{children:t.jsxs("div",{ref:H,className:`${s.chartContainer} ${y==="dark"?s.darkMode:s.lightMode}`,children:[t.jsx(Dt,{position:"top-center",theme:y}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:s.legendButton,onClick:rt,children:[t.jsx("img",{src:"https://def-pumps.inspirigenceworks.co.in/images/code-block.png",alt:"Code Block Icon",className:s.codeBlockIcon,title:"Legends",style:{filter:A||S.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:`fw-bold me-2 fs-${window.innerWidth<=768?7:5} ${y==="dark"?s.darkMode:s.lightMode}`,children:e("Product")}),t.jsx(_t,{theme:pt,children:t.jsxs(St,{size:"small",color:"primary",value:w,exclusive:!0,onChange:ut,"aria-label":"Platform",style:{fontFamily:'"Public Sans", sans-serif !important'},children:[t.jsx(Z,{style:{color:w=="Sale"?"":"var(--text-color)"},className:`fw-bold fs-${window.innerWidth<=1300?7:6}`,value:"Sale",children:e("Sale")}),t.jsx(Z,{style:{color:w=="Qty"?"":"var(--text-color)"},className:`fw-bold fs-${window.innerWidth<=1300?7:6}`,value:"Qty",children:e("Qty")})]})})]}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:I,children:t.jsxs("div",{className:`${s.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${s.icon} ${y==="dark"?s.darkMode:s.lightMode} px-2 py-1`,onClick:ht,children:W?t.jsx(wt,{style:{fontSize:"1.1rem"}}):t.jsx(Ct,{style:{fontSize:"1.1rem"}})}),W&&t.jsxs("div",{className:`${s.exportOptions} ${y==="dark"?s.darkMode:s.lightMode}`,ref:Q,children:[j?t.jsxs("div",{className:s.exportOption,onClick:()=>{G(!j),F(!1)},children:[t.jsx(jt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:s.exportOption,onClick:()=>{G(!j),F(!1)},children:[t.jsx(Ft,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:s.exportOption,onClick:ct,children:[t.jsx(Nt,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:s.exportOption,onClick:dt,children:[t.jsx($t,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),U&&t.jsx("div",{className:s.NoDataOverlay,children:t.jsx("img",{src:kt,alt:"Loading...",width:50,height:50})}),k.length==1&&!j&&!U?t.jsx("div",{className:`${s.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",j?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"289px"},children:t.jsxs("table",{className:`table  ${y=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:k.map((o,a)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:k.length-1===a?"":a+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:k.length-1===a?"":o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(vt,{option:it,style:{height:"297px",width:"100%",maxWidth:"2300px"},className:s.piechart},S.length)]})})};export{he as default};
