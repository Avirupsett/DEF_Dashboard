import{_ as H}from"./index-408207ed.js";import{r as p,u as tt,j as t,h as et,A as ot,z as at,J as nt,C as st,E as rt}from"./vendor-abef7372.js";import{L as lt,a as it,E as ct,M as dt,l as W,F as ht}from"./index-e248b1af.js";const ft="_piechart_1ah4s_11",ut="_chartContainer_1ah4s_23",pt="_legendButtonContainer_1ah4s_49",_t="_legendButton_1ah4s_49",gt="_codeBlockIcon_1ah4s_133",mt="_lightMode_1ah4s_191",xt="_dateFilter_1ah4s_195",bt="_officefilter_1ah4s_351",yt="_topContainer_1ah4s_443",St="_darkMode_1ah4s_463",Ct="_iconsContainer_1ah4s_631",wt="_icon_1ah4s_631",jt="_exportOptions_1ah4s_715",kt="_exportOption_1ah4s_715",vt="_NoDataOverlay_1ah4s_861",Ft="_tableContainer_1ah4s_993",Nt="_table_1ah4s_993",Dt="_summaryHeader_1ah4s_1029",Ot="_periodHeader_1ah4s_1037",Pt="_closeButton_1ah4s_1069",$t="_tableWrapper_1ah4s_1099",Bt="_loadingOverlay_1ah4s_1107",Et="_loadingSpinner_1ah4s_1133",zt="_boldOption_1ah4s_1145",Tt="_optionGroup_1ah4s_1155",e={piechart:ft,chartContainer:ut,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:pt,legendButton:_t,codeBlockIcon:gt,lightMode:mt,"label-text":"_label-text_1ah4s_191",dateFilter:xt,officefilter:bt,topContainer:yt,darkMode:St,"theme-container":"_theme-container_1ah4s_473",iconsContainer:Ct,icon:wt,exportOptions:jt,exportOption:kt,NoDataOverlay:vt,tableContainer:Ft,table:Nt,summaryHeader:Dt,periodHeader:Ot,closeButton:Pt,tableWrapper:$t,loadingOverlay:Bt,loadingSpinner:Et,boldOption:zt,optionGroup:Tt},It=({themeMode:_,selectedRange:g,selectedOffice:E,isAdmin:R,alldata:j,isLoading:z})=>{const[b,I]=p.useState([]),[k,L]=p.useState([]),[v,y]=p.useState(!1),F=p.useRef(null),N=p.useRef(null),D=p.useRef(null),{t:a}=tt(),[O,P]=p.useState(!1),[T,M]=p.useState([]),[S,$]=p.useState(!1),A=[{name:"Product Name",label:a("Product")},{name:"Quantity",label:a("Quantity")},{name:"Sales",label:`${a("Sales")}(₹)`}],Q={selectableRowsHeader:!1,filter:!1,download:!1,print:!1,viewColumns:!1,search:!1,responsive:"standard",selectableRows:"none",rowsPerPage:10,rowsPerPageOptions:[10,25,50],tableBodyHeight:"229px",elevation:0,fixedHeader:!1,textLabels:{pagination:{rowsPerPage:a("Rows")}}};function G(s){return s.flatMap(n=>n.lstproduct).reduce((n,o)=>{const{productName:i,totalSales:r,qty:c,color:h,unitShortName:f}=o;return r!==0&&(n[i]?(n[i].totalSales+=r,n[i].qty+=c):n[i]={totalSales:r,qty:c,color:h,unitShortName:f}),n},{})}p.useEffect(()=>{const s=x(g[0]),l=x(g[1]);if(s&&l&&E&&j.graph2){const d=G(j.graph2),n=Object.entries(d).map(([r,{totalSales:c,color:h}])=>({value:c,name:r,itemStyle:{color:h}}));L(n);const o=Object.entries(d).map(([r,{totalSales:c,color:h,qty:f,unitShortName:m}])=>({productName:r,totalSale:c,color:h,totalQty:f,unit:m}));I(o);const i=Object.entries(d).map(([r,{totalSales:c,qty:h,unitShortName:f}])=>({"Product Name":r,Sales:c,Quantity:`${h} ${f}`}));M(i)}},[g,E,R,j]);const V=()=>{b.length>0&&(P(!O),y(!1),$(!1))},Y={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${a("Total Sales")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:_==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:O,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"2%",style:{fill:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Sales",type:"pie",radius:["40%","65%"],center:["50%","50%"],selectedMode:"single",avoidLabelOverlap:!0,label:{show:k.length<=10,color:_==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:k.length>0?k:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},U=async()=>{const s=x(g[0]),l=x(g[1]),d=await H(()=>import("./exceljs.min-4028e8da.js").then(i=>i.e),["assets/exceljs.min-4028e8da.js","assets/vendor-abef7372.js"]),n=new d.Workbook,o=n.addWorksheet("Data");fetch(W).then(i=>i.blob()).then(i=>{const r=new FileReader;r.onload=function(){const c=r.result,h=n.addImage({base64:c,extension:"png"});o.addImage(h,{tl:{col:0,row:0},ext:{width:100,height:70}});const f=o.getCell("A2");f.value=a("Product Wise Summary Data"),f.font={bold:!0,color:{argb:"000000"},size:14},f.alignment={vertical:"middle",horizontal:"center"},o.mergeCells("A2:C2");const m=o.getCell("A3");m.value=`${a("Period")}: ${s} ${a("to")} ${l}`,m.font={bold:!0,color:{argb:"000000"},size:12},m.alignment={horizontal:"center"},o.mergeCells("A3:C3"),o.getColumn(1).width=50,o.getColumn(2).width=15;const C=o.addRow([a("Product Name"),a("Quantity"),a("Total Sales")]);C.font={bold:!0,color:{argb:"000000"},size:12},C.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),b.forEach(u=>{o.addRow([u.productName,`${u.totalQty} ${u.unit}`,`₹${u.totalSale}`])});const B=`product_wise_summary_data_${Date.now()}.xlsx`;n.xlsx.writeBuffer().then(u=>{ht.saveAs(new Blob([u]),B)})},r.readAsDataURL(i)})},x=s=>{if(!s)return"";const l=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${l}-${d}-${n}`},q=async()=>{const s=x(g[0]),l=x(g[1]);H(()=>import("./index-e248b1af.js").then(d=>d.j),["assets/index-e248b1af.js","assets/vendor-abef7372.js","assets/index-408207ed.js","assets/index-4da97eed.css"]).then(d=>{let n=d.default;const o=new n,i=[["Product Name","Quantity","Total Sale"]],r={1:{halign:"right"},2:{halign:"right"}},c={fontSize:12,fontStyle:"bold",halign:"center"},h={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},f=W,m=35,C=20;o.addImage(f,"PNG",15,12,m,C);const B=[["Product Wise Summary Data"]];o.autoTable({head:B,body:[],headStyles:{...c,fillColor:h.summaryHeader,textColor:"#FFFFFF"},margin:{top:30}});const u=[[`Period: ${s} to ${l}`]];o.autoTable({startY:39.5,head:u,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30}});const X=b.map(w=>[w.productName,`${w.totalQty} ${w.unit}`,w.totalSale.toFixed(2)]),K={startY:o.autoTable.previous.finalY+1,head:i,body:X,headStyles:{...c,fillColor:h.secondHeader,textColor:"#FFFFFF"},columnStyles:r};o.autoTable(K);const Z=`product_wise_summary_data_${Date.now()}.pdf`;o.save(Z)})};p.useEffect(()=>{const s=l=>{F.current&&!F.current.contains(l.target)&&N.current&&!N.current.contains(l.target)&&l.target.tagName!=="svg"&&l.target.tagName!=="path"&&y(!1),D.current&&!D.current.contains(l.target)&&P(!1)};return document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}},[]);const J=()=>{P(!1),y(!v)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${e.chartContainer} ${_==="dark"?e.darkMode:e.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:e.legendButton,onClick:V,ref:D,children:[t.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:e.codeBlockIcon,title:"Legends",style:{filter:O||b.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-5 ${_==="dark"?e.darkMode:e.lightMode}`,children:a("Product Volume")}),t.jsx("div",{className:"d-flex g-0",ref:F,children:t.jsxs("div",{className:`${e.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${e.icon} ${_==="dark"?e.darkMode:e.lightMode} px-2 py-1`,onClick:J,children:v?t.jsx(et,{style:{fontSize:"1.1rem"}}):t.jsx(ot,{style:{fontSize:"1.1rem"}})}),v&&t.jsxs("div",{className:`${e.exportOptions} ${_==="dark"?e.darkMode:e.lightMode}`,ref:N,children:[S?t.jsxs("div",{className:e.exportOption,onClick:()=>{$(!S),y(!1)},children:[t.jsx(nt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:e.exportOption,onClick:()=>{$(!S),y(!1)},children:[t.jsx(at,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:e.exportOption,onClick:U,children:[t.jsx(st,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:e.exportOption,onClick:q,children:[t.jsx(rt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),z&&t.jsx("div",{className:e.NoDataOverlay,children:t.jsx(lt,{animationData:it,loop:!0})}),T.length==0&&!S&&!z?t.jsx("div",{className:`${e.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",S?t.jsx("div",{className:"container-fluid pt-2",children:t.jsx(dt,{data:T,columns:A,options:Q})}):t.jsx(ct,{option:Y,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:e.piechart},b.length)]})})};export{It as default};
