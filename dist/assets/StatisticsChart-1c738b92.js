import{_ as X}from"./index-4d7f1e73.js";import{r as b,u as he,A as ue,j as t,i as ge,B as me,C as xe,E as ye,G as be,H as we,a as B}from"./vendor-d27bb63f.js";import{L as Z,R as Se}from"./index-3570dccd.js";import{k as _e,l as De,Q as v,a as K,f as Fe,b as Ce}from"./NotoSansDevanagari-VariableFont_wdth_wght-d6f1c465.js";const ve="_chartContainer_1mphg_1",$e="_lightMode_1mphg_47",Ee="_dateFilter_1mphg_51",je="_officefilter_1mphg_207",ke="_topContainer_1mphg_299",Ne="_darkMode_1mphg_319",Oe="_iconsContainer_1mphg_487",Be="_icon_1mphg_487",Ae="_exportOptions_1mphg_571",Ie="_exportOption_1mphg_571",Te="_tableContainer_1mphg_825",ze="_table_1mphg_825",Le="_summaryHeader_1mphg_861",Pe="_periodHeader_1mphg_869",We="_closeButton_1mphg_901",qe="_tableWrapper_1mphg_931",Re="_loadingOverlay_1mphg_939",Ge="_NoDataOverlay_1mphg_963",He="_loadingSpinner_1mphg_991",Me="_boldOption_1mphg_1003",Ve="_optionGroup_1mphg_1013",i={chartContainer:ve,lightMode:$e,"label-text":"_label-text_1mphg_47",dateFilter:Ee,officefilter:je,topContainer:ke,darkMode:Ne,"theme-container":"_theme-container_1mphg_329",iconsContainer:Oe,icon:Be,exportOptions:Ae,exportOption:Ie,tableContainer:Te,table:ze,summaryHeader:Le,periodHeader:Pe,closeButton:We,tableWrapper:qe,loadingOverlay:Re,NoDataOverlay:Ge,loadingSpinner:He,boldOption:Me,optionGroup:Ve},Ze=({selectedRange:u,themeMode:h,selectedOffice:H,isAdmin:Ue,alldata:M,isLoading:V,officeName:$})=>{const[g,ee]=b.useState([]),[z,A]=b.useState(!1),L=b.useRef(null),P=b.useRef(null),[te,ae]=b.useState(!0),[W,oe]=b.useState([]),[E,U]=b.useState(!1),{t:a}=he();a("Date"),`${a("Sales")}`,`${a("Expense")}`,a("Rows"),b.useEffect(()=>{const e=x(u[0]),o=x(u[1]);e&&o&&H&&(()=>{const r=M;if(Array.isArray(r.graph1)){const n=r.graph1.map(c=>({requestedDate:x(new Date(c.requestedDate)),sales:c.totalIncome,expense:c.totalExpense}));let l=n.filter(c=>c.sales!==0||c.expense!==0);const _=n.reduce((c,S)=>c+S.sales,0).toFixed(2),w=n.reduce((c,S)=>c+S.expense,0).toFixed(2);l.push({requestedDate:a("Total"),sales:_,expense:w}),oe(l),ee(r.graph1)}})()},[M]);const Y=(g.filter(e=>e.totalIncome>0).reduce((e,o)=>e+o.totalIncome,0)/g.length).toFixed(0);b.useEffect(()=>{if(u[0]&&u[1]){const e=new Date(u[0]),o=new Date(u[1]),s=ue(o,e)+1;ae(s<=7)}},[u,H]);function I(e,o){var s=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16);s=parseInt(s*(100+o)/100),r=parseInt(r*(100+o)/100),n=parseInt(n*(100+o)/100),s=s<255?s:255,r=r<255?r:255,n=n<255?n:255,s=Math.round(s),r=Math.round(r),n=Math.round(n);var l=s.toString(16).length==1?"0"+s.toString(16):s.toString(16),_=r.toString(16).length==1?"0"+r.toString(16):r.toString(16),w=n.toString(16).length==1?"0"+n.toString(16):n.toString(16);return"#"+l+_+w}const ne={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:h==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:(window.innerWidth>550,270),data:[a("Sales"),a("Expense"),a("Average Sales")],textStyle:{color:h==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:"4%",right:"3%",top:"10%",bottom:g.length>0?"15%":"20%",containLabel:g.length>0},xAxis:{type:"time",axisPointer:{label:{formatter:function(e){let o=new Date(e.value);return x(o)}}},nameLocation:"middle",nameGap:35,data:g.map(e=>e.requestedDate),axisLine:{lineStyle:{color:h==="dark"?"#ffffff":"#000000"}},axisLabel:{hideOverlap:!0,formatter:"{d} {MMM}",color:h==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,axisLine:{lineStyle:{color:h==="dark"?"#ffffff":"#000000"}},axisLabel:{color:h==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:h==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],dataZoom:[{show:!0,type:"inside",filterMode:"none",xAxisIndex:[0],startValue:new Date(u[0]),endValue:new Date(u[1])}],series:te?[{name:a("Sales"),type:"bar",data:g.map(e=>[e.requestedDate,e.totalIncome]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0],color:new Z(0,0,0,1,[{offset:1,color:I("#66BA69",0)},{offset:0,color:I("#66BA69",30)}])}},{name:a("Expense"),type:"bar",data:g.map(e=>[e.requestedDate,e.totalExpense]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0],color:new Z(0,0,0,1,[{offset:1,color:I("#E81A1A",0)},{offset:0,color:I("#ff1A1A",40)}])}},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,itemStyle:{color:"#FFC107"},lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:g.map(e=>[e.requestedDate,Y])}]:[{name:a("Sales"),type:"line",smooth:!0,symbol:"none",data:g.map(e=>[e.requestedDate,e.totalIncome])},{name:a("Expense"),type:"line",smooth:!0,symbol:"none",data:g.map(e=>[e.requestedDate,e.totalExpense])},{name:a("Average Sales"),itemStyle:{color:"#FFC107"},type:"line",symbol:"none",smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:g.map(e=>[e.requestedDate,Y])}]},J=e=>{let o="";const s=new Uint8Array(e),r=s.byteLength;for(let n=0;n<r;n++)o+=String.fromCharCode(s[n]);return window.btoa(o)},se=async()=>{const e=v.loading("Please wait..."),o=x(u[0]),s=x(u[1]),r=await X(()=>import("./exceljs.min-b41d4843.js").then(c=>c.e),["assets/exceljs.min-b41d4843.js","assets/vendor-d27bb63f.js"]),n=new r.Workbook,l=n.addWorksheet("Graph Data"),_=await B.get(K,{responseType:"blob"}),w=new FileReader;w.onload=function(){const c=w.result,S=n.addImage({base64:c,extension:"png"});l.addImage(S,{tl:{col:0,row:0},ext:{width:100,height:60}});const j=l.getCell("A1");j.value=`${a("Sales-Expense Summary")} (${$})`,j.font={bold:!0,color:{argb:"000000"},size:14},j.alignment={vertical:"middle",horizontal:"center"},l.mergeCells("A1:D1");const p=l.getCell("A2");p.value=`${a("Period")}: ${o} ${a("to")} ${s}`,p.font={bold:!0,color:{argb:"000000"},size:12},p.alignment={horizontal:"center"},l.mergeCells("A2:D2"),l.getColumn(1).width=15,l.getColumn(2).width=50,l.getColumn(3).width=15;const T=l.addRow([a("#"),a("Date"),a("Sales"),a("Expense")]);T.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},T.eachCell(d=>{d.font={bold:!0,color:{argb:"000000"},size:12},d.border={bottom:{style:"thin",color:{argb:"000000"}}}});const k=g.filter(d=>d.totalIncome!==0||d.totalExpense!==0);k.forEach((d,y)=>{const m=l.addRow([y+1,x(new Date(d.requestedDate)),Number(d.totalIncome),Number(d.totalExpense)]);m.getCell(2).numFmt="0.00",m.getCell(3).numFmt="0.00",m.getCell(1).alignment={horizontal:"left"},m.getCell(2).alignment={horizontal:"left"},m.getCell(3).alignment={horizontal:"right"},m.getCell(4).alignment={horizontal:"right"}});const N=l.addRow(["",a("Total"),"",""]);N.font={bold:!0,color:{argb:"000000"},size:12};const q=k.reduce((d,y)=>d+y.totalIncome,0),R=k.reduce((d,y)=>d+y.totalExpense,0),F=l.getCell(`C${N.number}`);F.value=`₹ ${q.toFixed(2)}`,F.alignment={horizontal:"right"};const O=l.getCell(`D${N.number}`);O.value=`₹ ${R.toFixed(2)}`,O.alignment={horizontal:"right"},n.xlsx.writeBuffer().then(async d=>{const y=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=new FormData;m.append("file",y,`${Date.now()}sales-expense_${$}_${o}_${s}.xlsx`);try{const C=await B.post("http://115.124.120.251:5064/api/uploader",m,{headers:{"Content-Type":"multipart/form-data"}});C.status==200?v.update(e,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(e,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const G=C.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${G}`}catch(C){console.error("Error saving Excel file:",C)}})},w.readAsDataURL(_.data)},re=async()=>{const e=x(u[0]),o=x(u[1]),s=v.loading("Please wait..."),n=new URLSearchParams(window.location.search).get("lang"),l=await B.get(Fe,{responseType:"arraybuffer"}),_=J(l.data),w=await B.get(Ce,{responseType:"arraybuffer"}),c=J(w.data);X(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-d6f1c465.js").then(S=>S.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-d6f1c465.js","assets/vendor-d27bb63f.js","assets/index-4d7f1e73.js","assets/index-ccf11cd4.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async S=>{let j=S.default;const p=new j;p.setFontSize(12),p.addFileToVFS("NotoSansBengali.ttf",_),p.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),p.setFont("NotoSansBengali"),p.addFileToVFS("NotoSansDevanagari.ttf",c),p.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),p.setFont("NotoSansDevanagari");const T=K,k=35,N=20;p.addImage(T,"PNG",15,9,k,N);const q=[[`${a("Sales-Expense Summary")} (${$})`]];p.autoTable({startY:27,head:q,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0},styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const R=[[`${a("Period")}: ${e} ${a("to")} ${o}`]];p.autoTable({startY:36,head:R,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const F=g.filter(f=>f.totalIncome!==0||f.totalExpense!==0),O=F.map((f,D)=>[D+1,x(new Date(f.requestedDate)),`₹ ${f.totalIncome.toFixed(2)}`,`₹ ${f.totalExpense.toFixed(2)}`]),d=F.reduce((f,D)=>f+D.totalIncome,0),y=F.reduce((f,D)=>f+D.totalExpense,0);(d!==0||y!==0)&&O.push(["",a("Total"),`₹ ${d.toFixed(2)}`,`₹ ${y.toFixed(2)}`]);const m=[a("#"),a("Date"),a("Sales"),a("Expense")],C={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},G={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"},ce={0:5,1:25,2:25,3:25};p.autoTable(m,O,{startY:45,headStyles:G,columnStyles:C,styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"},columnWidth:"wrap",columnWidths:ce});const pe=Date.now(),fe=new Blob([p.output("blob")],{type:"application/pdf"}),Q=new FormData;Q.append("file",fe,`${pe}sales-expense_${$}_${e}_${o}.pdf`);try{const f=await B.post("http://115.124.120.251:5064/api/uploader",Q,{headers:{"Content-Type":"multipart/form-data"}});f.status==200?v.update(s,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(s,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const D=await f.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${D}`}catch(f){console.error("Error saving PDF file:",f)}})};b.useEffect(()=>{const e=o=>{L.current&&!L.current.contains(o.target)&&P.current&&!P.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&A(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const le=()=>{A(!z)},x=e=>{if(!e)return"";const o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${s}-${o}`},ie=()=>{U(!E),A(!1)},de=(e,o)=>window.innerWidth>500||e.length<=o?e:e.substring(0,o)+"...";return t.jsxs("div",{className:`${i.chartContainer} ${h==="dark"?i.darkMode:i.lightMode}`,children:[t.jsx(_e,{position:"top-center",theme:h}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("div",{className:`fw-bold noselect fs-${window.innerWidth<=768?7:5} ${h==="dark"?i.darkMode:i.lightMode}`,children:[a("Sales-Expense")," ",a("of")," ",de($,10)]}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:L,children:t.jsxs("div",{className:`${i.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${i.icon} ${h==="dark"?i.darkMode:i.lightMode} px-2 py-1`,onClick:le,children:z?t.jsx(ge,{style:{fontSize:"1.1rem"}}):t.jsx(me,{style:{fontSize:"1.1rem"}})}),z&&t.jsxs("div",{className:`${i.exportOptions} ${h==="dark"?i.darkMode:i.lightMode}`,ref:P,children:[E?t.jsxs("div",{className:i.exportOption,onClick:()=>{U(!E),A(!1)},children:[t.jsx(ye,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:i.exportOption,onClick:ie,children:[t.jsx(xe,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:i.exportOption,onClick:se,children:[t.jsx(be,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:i.exportOption,onClick:re,children:[t.jsx(we,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),V&&t.jsx("div",{className:i.NoDataOverlay,children:t.jsx("img",{src:De,alt:"Loading...",width:50,height:50})}),W.length==1&&!E&&!V?t.jsx("div",{className:`${i.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",E?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table ${h=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:a("Date")}),t.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]}),t.jsxs("th",{scope:"col",children:[a("Expense"),"(₹)"]})]})}),t.jsx("tbody",{children:W.map((e,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:W.length-1===o?"":o+1}),t.jsx("td",{children:e.requestedDate}),t.jsx("td",{children:parseFloat(e.sales).toFixed(2)}),t.jsx("td",{children:parseFloat(e.expense).toFixed(2)})]},e.requestedDate))})]})}):t.jsx(Se,{option:ne,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:h==="dark"?i.darkMode:i.lightMode})]})};export{Ze as default};
