import{_ as J}from"./index-563da8c0.js";import{r as f,u as it,j as e,i as ct,A as dt,B as ut,N as pt,E as gt,G as ht,a as M}from"./vendor-95b9cd9c.js";import{L as ft,R as mt}from"./index-837eb269.js";import{k as _t,l as yt,Q as C,a as Q,f as xt,b as Ct}from"./NotoSansDevanagari-VariableFont_wdth_wght-d4d26ad0.js";const bt="_piechart_7z7nz_11",zt="_chartContainer_7z7nz_23",St="_legendButtonContainer_7z7nz_49",wt="_legendButton_7z7nz_49",Ft="_codeBlockIcon_7z7nz_133",vt="_lightMode_7z7nz_191",Nt="_dateFilter_7z7nz_195",jt="_officefilter_7z7nz_351",Dt="_topContainer_7z7nz_443",$t="_darkMode_7z7nz_463",kt="_iconsContainer_7z7nz_631",Pt="_icon_7z7nz_631",Ot="_exportOptions_7z7nz_715",Bt="_exportOption_7z7nz_715",Mt="_NoDataOverlay_7z7nz_861",Et="_tableContainer_7z7nz_993",Tt="_table_7z7nz_993",It="_summaryHeader_7z7nz_1029",Lt="_periodHeader_7z7nz_1037",Rt="_closeButton_7z7nz_1069",At="_tableWrapper_7z7nz_1099",Ht="_loadingOverlay_7z7nz_1107",Gt="_loadingSpinner_7z7nz_1133",Ut="_boldOption_7z7nz_1145",Wt="_optionGroup_7z7nz_1155",i={piechart:bt,chartContainer:zt,"legend-text":"_legend-text_7z7nz_31",legendButtonContainer:St,legendButton:wt,codeBlockIcon:Ft,lightMode:vt,"label-text":"_label-text_7z7nz_191",dateFilter:Nt,officefilter:jt,topContainer:Dt,darkMode:$t,"theme-container":"_theme-container_7z7nz_473",iconsContainer:kt,icon:Pt,exportOptions:Ot,exportOption:Bt,NoDataOverlay:Mt,tableContainer:Et,table:Tt,summaryHeader:It,periodHeader:Lt,closeButton:Rt,tableWrapper:At,loadingOverlay:Ht,loadingSpinner:Gt,boldOption:Ut,optionGroup:Wt},Kt=({themeMode:_,selectedRange:x,selectedOffice:X,isAdmin:Vt,showGraph:G,alldata:E,officeName:N,isLoading:U})=>{const[p,K]=f.useState([]),[T,j]=f.useState(!1),I=f.useRef(null),L=f.useRef(null),{t:o}=it(),[b,Z]=f.useState([]),[z,R]=f.useState(!1);f.useEffect(()=>{const t=V(x[0]),n=V(x[1]);if(t&&n&&X&&E.graph5){const a=E.graph5;K(a);const s=a.reduce((r,l)=>r+l.Count,0);Z([...a,{PaymentModeName:"Total",Count:s}])}},[E]);function D(t,n){var a=parseInt(t.substring(1,3),16),s=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16);a=parseInt(a*(100+n)/100),s=parseInt(s*(100+n)/100),r=parseInt(r*(100+n)/100),a=a<255?a:255,s=s<255?s:255,r=r<255?r:255,a=Math.round(a),s=Math.round(s),r=Math.round(r);var l=a.toString(16).length==1?"0"+a.toString(16):a.toString(16),g=s.toString(16).length==1?"0"+s.toString(16):s.toString(16),y=r.toString(16).length==1?"0"+r.toString(16):r.toString(16);return"#"+l+g+y}const tt={polar:{radius:[30,"80%"]},radiusAxis:{type:"value",axisTick:{show:!1},axisLabel:{show:!1},max:p.length>0?p.sort((t,n)=>n.Count-t.Count)[1].Count+5:5},angleAxis:{type:"category",data:p.map(t=>o(t.PaymentModeName)),startAngle:75,axisLabel:{color:_==="dark"?"#ffffff":"#000000"}},tooltip:{},series:{type:"bar",data:p.map(t=>({value:t.Count,itemStyle:{color:new ft(0,0,0,1,[{offset:1,color:t.PaymentModeName==o("UPI")?"#5fb476":t.PaymentModeName==o("Card")?"#f0d070":t.PaymentModeName==o("Cash")?"#73a2ee":"#e77267"},{offset:0,color:t.PaymentModeName==o("UPI")?D("#5fb476",50):t.PaymentModeName==o("Card")?D("#f0d070",50):t.PaymentModeName==o("Cash")?D("#73a2ee",50):D("#e77267",50)}]),borderRadius:[5,5,5,5]},label:{show:!0,color:"#000000"}})),coordinateSystem:"polar",label:{show:!0,position:"middle",formatter:"{c}"}},animation:!0},W=t=>{let n="";const a=new Uint8Array(t),s=a.byteLength;for(let r=0;r<s;r++)n+=String.fromCharCode(a[r]);return window.btoa(n)},$=t=>{if(!t)return"";const n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0");return`${String(t.getDate()).padStart(2,"0")}-${a}-${n}`},V=t=>{if(!t)return"";const n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${n}-${a}-${s}`},et=async()=>{const t=C.loading("Please wait..."),n=$(x[0]),a=$(x[1]),s=await J(()=>import("./exceljs.min-03f8d777.js").then(g=>g.e),["assets/exceljs.min-03f8d777.js","assets/vendor-95b9cd9c.js"]),r=new s.Workbook,l=r.addWorksheet("Data");fetch(Q).then(g=>g.blob()).then(async g=>{const y=new FileReader;y.onload=async function(){const A=y.result,S=r.addImage({base64:A,extension:"png"});l.addImage(S,{tl:{col:0,row:0},ext:{width:100,height:60}});const w=l.getCell("A1");w.value=`${o("Payment Mode Data")} (${N})`,w.font={bold:!0,color:{argb:"000000"},size:14},w.alignment={vertical:"middle",horizontal:"center"},l.mergeCells("A1:D1");const c=l.getCell("A2");c.value=`${o("Period")}: ${n} ${o("to")} ${a}`,c.font={bold:!0,color:{argb:"000000"},size:12},c.alignment={horizontal:"center"},l.mergeCells("A2:D2"),l.getColumn(1).width=15,l.getColumn(2).width=50,l.getColumn(3).width=15,l.getColumn(4).width=15;const k=l.addRow([o("#"),o("Payment"),o("Count")]);k.font={bold:!0,color:{argb:"000000"},size:12},k.eachCell(d=>{d.font={bold:!0,color:{argb:"000000"},size:12},d.border={bottom:{style:"thin",color:{argb:"000000"}}}}),p.forEach((d,m)=>{const u=l.addRow([m+1,d.PaymentModeName,d.Count]);u.getCell(1).alignment={horizontal:"left"},u.getCell(2).alignment={horizontal:"left"},u.getCell(3).alignment={horizontal:"right"},u.getCell(4).alignment={horizontal:"right"}});const P=l.addRow(["",o("Total"),""]);P.font={bold:!0,color:{argb:"000000"},size:12};const O=p.reduce((d,m)=>d+m.Count,0),F=l.getCell(`C${P.number}`);F.value=`${O}`,F.alignment={horizontal:"right"};const H=`${Date.now()}PaymentMode_${N}_${n}_${a}.xlsx`;r.xlsx.writeBuffer().then(async d=>{const m=new FormData;m.append("file",new Blob([d]),H);try{const u=await M.post("http://115.124.120.251:5064/api/uploader",m,{headers:{"Content-Type":"multipart/form-data"}});u.status==200?C.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):C.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const B=u.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${B}`}catch(u){console.error("Error saving Excel file:",u)}})},y.readAsDataURL(g)})},ot=async()=>{const t=C.loading("Please wait..."),n=$(x[0]),a=$(x[1]),r=new URLSearchParams(window.location.search).get("lang"),l=await M.get(xt,{responseType:"arraybuffer"}),g=W(l.data),y=await M.get(Ct,{responseType:"arraybuffer"}),A=W(y.data);J(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-d4d26ad0.js").then(S=>S.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-d4d26ad0.js","assets/vendor-95b9cd9c.js","assets/index-563da8c0.js","assets/index-ccf11cd4.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async S=>{let w=S.default;const c=new w;c.addFileToVFS("NotoSansBengali.ttf",g),c.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),c.setFont("NotoSansBengali"),c.addFileToVFS("NotoSansDevanagari.ttf",A),c.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),c.setFont("NotoSansDevanagari");const k=[[o("#"),o("Payment"),o("Count")]],P={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"}},O={fontSize:12,fontStyle:"bold",halign:"center"},F={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},Y=Q,H=35,d=20;c.addImage(Y,"PNG",15,12,H,d);const m=[[`${o("Payment Mode")} (${N})`]];c.autoTable({head:m,body:[],headStyles:{...O,fillColor:F.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const u=[[`${o("Period")}: ${n} ${o("to")} ${a}`]];c.autoTable({startY:39.5,head:u,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let B=p.map((h,v)=>[v+1,h.PaymentModeName,`${h.Count}`]);const at=p.reduce((h,v)=>h+v.Count,0);B.push(["",o("Total"),at]);const rt={startY:c.autoTable.previous.finalY+1,head:k,body:B,headStyles:{...O,fillColor:F.secondHeader,textColor:"#FFFFFF"},columnStyles:P,styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};c.autoTable(rt);const st=`${Date.now()}PaymentMode_${N}_${n}_${a}.pdf`,lt=c.output("blob"),q=new FormData;q.append("file",lt,st);try{const h=await M.post("http://115.124.120.251:5064/api/uploader",q,{headers:{"Content-Type":"multipart/form-data"}});h.status==200?C.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):C.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const v=await h.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${v}`}catch(h){console.error("Error saving PDF file:",h)}})};f.useEffect(()=>{const t=n=>{I.current&&!I.current.contains(n.target)&&L.current&&!L.current.contains(n.target)&&n.target.tagName!=="svg"&&n.target.tagName!=="path"&&j(!1)};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),f.useEffect(()=>{R(!G)},[G]);const nt=()=>{j(!T)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`${i.chartContainer} ${_==="dark"?i.darkMode:i.lightMode}`,children:[e.jsx(_t,{position:"top-center",theme:_}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("div",{className:`fw-bold noselect me-2 fs-${window.innerWidth<=768?7:5} ${_==="dark"?i.darkMode:i.lightMode}`,children:o("Payment Mode")})}),e.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:I,children:e.jsxs("div",{className:`${i.iconsContainer} d-flex justify-content-center align-items-center`,children:[e.jsx("div",{className:`${i.icon} ${_==="dark"?i.darkMode:i.lightMode} px-2 py-1`,onClick:nt,children:T?e.jsx(ct,{style:{fontSize:"1.1rem"}}):e.jsx(dt,{style:{fontSize:"1.1rem"}})}),T&&e.jsxs("div",{className:`${i.exportOptions} ${_==="dark"?i.darkMode:i.lightMode}`,ref:L,children:[z?e.jsxs("div",{className:i.exportOption,onClick:()=>{R(!z),j(!1)},children:[e.jsx(pt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),e.jsx("span",{children:o("View Graph")})]}):e.jsxs("div",{className:i.exportOption,onClick:()=>{R(!z),j(!1)},children:[e.jsx(ut,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),e.jsx("span",{children:o("View Table")})]}),e.jsxs("div",{className:i.exportOption,onClick:et,children:[e.jsx(gt,{style:{fontSize:"1.1rem",color:"green"}}),e.jsx("span",{children:o("Export to Excel")})]}),e.jsxs("div",{className:i.exportOption,onClick:ot,children:[e.jsx(ht,{style:{fontSize:"1.1rem",color:"red"}}),e.jsx("span",{children:o("Export to PDF")})]})]})]})})]})}),U&&e.jsx("div",{className:i.loadingOverlay,children:e.jsx("img",{src:yt,alt:"Loading...",width:50,height:50})}),b.length>0&&b[b.length-1].Count===0&&!z&&!U?e.jsx("div",{className:`${i.loadingOverlay} fs-5`,children:o("No Data Found")}):"",z?e.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"342px"},children:e.jsxs("table",{className:`table  ${_=="dark"?"table-dark":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"#"}),e.jsx("th",{scope:"col",children:o("Payment")}),e.jsx("th",{scope:"col",children:o("Count")})]})}),e.jsx("tbody",{children:b.map((t,n)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:b.length-1===n?"":n+1}),e.jsx("td",{children:t.PaymentModeName}),e.jsx("td",{children:t.Count})]},t.PaymentModeName))})]})}):e.jsx(mt,{option:tt,style:{height:"350px",width:"100%",maxWidth:"2300px"},className:i.piechart},p.length)]})})};export{Kt as default};
