import{_ as K}from"./index-e40c2807.js";import{r as x,u as ge,A as me,j as t,i as xe,B as ye,C as Se,G as be,H as we,I as _e,a as B}from"./vendor-776b30b8.js";import{l as De}from"./ReactToastify-9380c2b8.js";import{k as Fe,Q as v,l as ee,f as Ce,a as ve}from"./NotoSansDevanagari-VariableFont_wdth_wght-cc11332b.js";import"./jspdf.es.min-4b9d738f.js";const $e="_chartContainer_1mphg_1",je="_lightMode_1mphg_47",Ee="_dateFilter_1mphg_51",ke="_officefilter_1mphg_207",Ne="_topContainer_1mphg_299",Oe="_darkMode_1mphg_319",Be="_iconsContainer_1mphg_487",Ie="_icon_1mphg_487",Ae="_exportOptions_1mphg_571",Te="_exportOption_1mphg_571",ze="_tableContainer_1mphg_825",Le="_table_1mphg_825",We="_summaryHeader_1mphg_861",Pe="_periodHeader_1mphg_869",qe="_closeButton_1mphg_901",Ge="_tableWrapper_1mphg_931",Me="_loadingOverlay_1mphg_939",He="_NoDataOverlay_1mphg_963",Re="_loadingSpinner_1mphg_991",Ve="_boldOption_1mphg_1003",Ue="_optionGroup_1mphg_1013",i={chartContainer:$e,lightMode:je,"label-text":"_label-text_1mphg_47",dateFilter:Ee,officefilter:ke,topContainer:Ne,darkMode:Oe,"theme-container":"_theme-container_1mphg_329",iconsContainer:Be,icon:Ie,exportOptions:Ae,exportOption:Te,tableContainer:ze,table:Le,summaryHeader:We,periodHeader:Pe,closeButton:qe,tableWrapper:Ge,loadingOverlay:Me,NoDataOverlay:He,loadingSpinner:Re,boldOption:Ve,optionGroup:Ue},et=({echarts:R,ReactECharts:te,selectedRange:u,themeMode:f,showGraph:V,selectedOffice:U,isAdmin:Ye,alldata:Y,isLoading:J,officeName:$})=>{const[g,ae]=x.useState([]),[z,I]=x.useState(!1),L=x.useRef(null),W=x.useRef(null),[oe,ne]=x.useState(!0),[P,se]=x.useState([]),[j,q]=x.useState(!1),{t:a}=ge();x.useEffect(()=>{const e=y(u[0]),o=y(u[1]);e&&o&&U&&(()=>{const r=Y;if(Array.isArray(r.graph1)){const n=r.graph1.map(c=>({requestedDate:y(new Date(c.requestedDate)),sales:c.totalIncome,expense:c.totalExpense}));let l=n.filter(c=>c.sales!==0||c.expense!==0);const _=n.reduce((c,w)=>c+w.sales,0).toFixed(2),b=n.reduce((c,w)=>c+w.expense,0).toFixed(2);l.push({requestedDate:a("Total"),sales:_,expense:b}),se(l),ae(r.graph1)}})()},[Y]),x.useEffect(()=>{q(!V)},[V]);const Q=(g.filter(e=>e.totalIncome>0).reduce((e,o)=>e+o.totalIncome,0)/g.length).toFixed(0);x.useEffect(()=>{if(u[0]&&u[1]){const e=new Date(u[0]),o=new Date(u[1]),s=me(o,e)+1;ne(s<=7)}},[u,U]);function A(e,o){var s=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16);s=parseInt(s*(100+o)/100),r=parseInt(r*(100+o)/100),n=parseInt(n*(100+o)/100),s=s<255?s:255,r=r<255?r:255,n=n<255?n:255,s=Math.round(s),r=Math.round(r),n=Math.round(n);var l=s.toString(16).length==1?"0"+s.toString(16):s.toString(16),_=r.toString(16).length==1?"0"+r.toString(16):r.toString(16),b=n.toString(16).length==1?"0"+n.toString(16):n.toString(16);return"#"+l+_+b}const re={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:f==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:(window.innerWidth>550,270),data:[a("Sales"),a("Expense"),a("Average Sales")],textStyle:{color:f==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:"4%",right:"3%",top:"10%",bottom:g.length>0?"15%":"20%",containLabel:g.length>0},xAxis:{type:"time",axisPointer:{label:{formatter:function(e){let o=new Date(e.value);return y(o)}}},nameLocation:"middle",nameGap:35,data:g.map(e=>e.requestedDate),axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{rotate:window.innerWidth<768?45:0,hideOverlap:!0,formatter:"{d} {MMM}",color:f==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{color:f==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:f==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],dataZoom:[{show:!0,type:"inside",filterMode:"none",xAxisIndex:[0],startValue:new Date(u[0]),endValue:new Date(u[1])}],series:oe?[{name:a("Sales"),type:"bar",data:g.map(e=>[e.requestedDate,e.totalIncome]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0],color:new R.graphic.LinearGradient(0,0,0,1,[{offset:1,color:A("#66BA69",0)},{offset:0,color:A("#66BA69",30)}])}},{name:a("Expense"),type:"bar",data:g.map(e=>[e.requestedDate,e.totalExpense]),yAxisIndex:0,barWidth:"35%",itemStyle:{borderRadius:[5,5,0,0],color:new R.graphic.LinearGradient(0,0,0,1,[{offset:1,color:A("#E81A1A",0)},{offset:0,color:A("#ff1A1A",40)}])}},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,itemStyle:{color:"#FFC107"},lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:g.map(e=>[e.requestedDate,Q])}]:[{name:a("Sales"),type:"line",smooth:!0,symbol:"none",data:g.map(e=>[e.requestedDate,e.totalIncome])},{name:a("Expense"),type:"line",smooth:!0,symbol:"none",data:g.map(e=>[e.requestedDate,e.totalExpense])},{name:a("Average Sales"),itemStyle:{color:"#FFC107"},type:"line",symbol:"none",smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:g.map(e=>[e.requestedDate,Q])}]},X=e=>{let o="";const s=new Uint8Array(e),r=s.byteLength;for(let n=0;n<r;n++)o+=String.fromCharCode(s[n]);return window.btoa(o)},le=async()=>{const e=v.loading("Please wait..."),o=y(u[0]),s=y(u[1]),r=await K(()=>import("./exceljs.min-1857c812.js").then(c=>c.e),["assets/exceljs.min-1857c812.js","assets/vendor-776b30b8.js"]),n=new r.Workbook,l=n.addWorksheet("Graph Data"),_=await B.get(ee,{responseType:"blob"}),b=new FileReader;b.onload=function(){const c=b.result,w=n.addImage({base64:c,extension:"png"});l.addImage(w,{tl:{col:0,row:0},ext:{width:100,height:60}});const E=l.getCell("A1");E.value=`${a("Sales-Expense Summary")} (${$})`,E.font={bold:!0,color:{argb:"000000"},size:14},E.alignment={vertical:"middle",horizontal:"center"},l.mergeCells("A1:D1");const p=l.getCell("A2");p.value=`${a("Period")}: ${o} ${a("to")} ${s}`,p.font={bold:!0,color:{argb:"000000"},size:12},p.alignment={horizontal:"center"},l.mergeCells("A2:D2"),l.getColumn(1).width=15,l.getColumn(2).width=50,l.getColumn(3).width=15;const T=l.addRow([a("#"),a("Date"),a("Sales"),a("Expense")]);T.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},T.eachCell(d=>{d.font={bold:!0,color:{argb:"000000"},size:12},d.border={bottom:{style:"thin",color:{argb:"000000"}}}});const k=g.filter(d=>d.totalIncome!==0||d.totalExpense!==0);k.forEach((d,S)=>{const m=l.addRow([S+1,y(new Date(d.requestedDate)),Number(d.totalIncome),Number(d.totalExpense)]);m.getCell(2).numFmt="0.00",m.getCell(3).numFmt="0.00",m.getCell(1).alignment={horizontal:"left"},m.getCell(2).alignment={horizontal:"left"},m.getCell(3).alignment={horizontal:"right"},m.getCell(4).alignment={horizontal:"right"}});const N=l.addRow(["",a("Total"),"",""]);N.font={bold:!0,color:{argb:"000000"},size:12};const G=k.reduce((d,S)=>d+S.totalIncome,0),M=k.reduce((d,S)=>d+S.totalExpense,0),F=l.getCell(`C${N.number}`);F.value=`₹ ${G.toFixed(2)}`,F.alignment={horizontal:"right"};const O=l.getCell(`D${N.number}`);O.value=`₹ ${M.toFixed(2)}`,O.alignment={horizontal:"right"},n.xlsx.writeBuffer().then(async d=>{const S=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=new FormData;m.append("file",S,`${Date.now()}sales-expense_${$}_${o}_${s}.xlsx`);try{const C=await B.post("http://115.124.120.251:5064/api/uploader",m,{headers:{"Content-Type":"multipart/form-data"}});C.status==200?v.update(e,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(e,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const H=C.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${H}`}catch(C){console.error("Error saving Excel file:",C)}})},b.readAsDataURL(_.data)},ie=async()=>{const e=y(u[0]),o=y(u[1]),s=v.loading("Please wait..."),n=new URLSearchParams(window.location.search).get("lang"),l=await B.get(Ce,{responseType:"arraybuffer"}),_=X(l.data),b=await B.get(ve,{responseType:"arraybuffer"}),c=X(b.data);K(()=>import("./jspdf.es.min-4b9d738f.js").then(w=>w.j),["assets/jspdf.es.min-4b9d738f.js","assets/index-e40c2807.js","assets/vendor-776b30b8.js","assets/index-0653e607.css"]).then(async w=>{let E=w.default;const p=new E;p.setFontSize(12),p.addFileToVFS("NotoSansBengali.ttf",_),p.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),p.setFont("NotoSansBengali"),p.addFileToVFS("NotoSansDevanagari.ttf",c),p.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),p.setFont("NotoSansDevanagari");const T=ee,k=35,N=20;p.addImage(T,"PNG",15,9,k,N);const G=[[`${a("Sales-Expense Summary")} (${$})`]];p.autoTable({startY:27,head:G,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0},styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const M=[[`${a("Period")}: ${e} ${a("to")} ${o}`]];p.autoTable({startY:36,head:M,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const F=g.filter(h=>h.totalIncome!==0||h.totalExpense!==0),O=F.map((h,D)=>[D+1,y(new Date(h.requestedDate)),`₹ ${h.totalIncome.toFixed(2)}`,`₹ ${h.totalExpense.toFixed(2)}`]),d=F.reduce((h,D)=>h+D.totalIncome,0),S=F.reduce((h,D)=>h+D.totalExpense,0);(d!==0||S!==0)&&O.push(["",a("Total"),`₹ ${d.toFixed(2)}`,`₹ ${S.toFixed(2)}`]);const m=[a("#"),a("Date"),a("Sales"),a("Expense")],C={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},H={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"},he={0:5,1:25,2:25,3:25};p.autoTable(m,O,{startY:45,headStyles:H,columnStyles:C,styles:{font:n==="hi"?"NotoSansDevanagari":"NotoSansBengali"},columnWidth:"wrap",columnWidths:he});const fe=Date.now(),ue=new Blob([p.output("blob")],{type:"application/pdf"}),Z=new FormData;Z.append("file",ue,`${fe}sales-expense_${$}_${e}_${o}.pdf`);try{const h=await B.post("http://115.124.120.251:5064/api/uploader",Z,{headers:{"Content-Type":"multipart/form-data"}});h.status==200?v.update(s,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(s,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const D=await h.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${D}`}catch(h){console.error("Error saving PDF file:",h)}})};x.useEffect(()=>{const e=o=>{L.current&&!L.current.contains(o.target)&&W.current&&!W.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&I(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const de=()=>{I(!z)},y=e=>{if(!e)return"";const o=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${s}-${o}`},ce=()=>{q(!j),I(!1)},pe=(e,o)=>window.innerWidth>500||e.length<=o?e:e.substring(0,o)+"...";return t.jsxs("div",{className:`${i.chartContainer} ${f==="dark"?i.darkMode:i.lightMode}`,children:[t.jsx(Fe,{position:"top-center",theme:f}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("div",{className:`fw-bold noselect fs-${window.innerWidth<=768?7:5} ${f==="dark"?i.darkMode:i.lightMode}`,children:[a("Sales-Expense")," ",a("of")," ",pe($,10)]}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:L,children:t.jsxs("div",{className:`${i.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${i.icon} ${f==="dark"?i.darkMode:i.lightMode} px-2 py-1`,onClick:de,children:z?t.jsx(xe,{style:{fontSize:"1.1rem"}}):t.jsx(ye,{style:{fontSize:"1.1rem"}})}),z&&t.jsxs("div",{className:`${i.exportOptions} ${f==="dark"?i.darkMode:i.lightMode}`,ref:W,children:[j?t.jsxs("div",{className:i.exportOption,onClick:()=>{q(!j),I(!1)},children:[t.jsx(be,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:i.exportOption,onClick:ce,children:[t.jsx(Se,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:i.exportOption,onClick:le,children:[t.jsx(we,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:i.exportOption,onClick:ie,children:[t.jsx(_e,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),J&&t.jsx("div",{className:i.NoDataOverlay,children:t.jsx("img",{src:De,alt:"Loading...",width:50,height:50})}),P.length==1&&!j&&!J?t.jsx("div",{className:`${i.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",j?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table ${f=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:a("Date")}),t.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]}),t.jsxs("th",{scope:"col",children:[a("Expense"),"(₹)"]})]})}),t.jsx("tbody",{children:P.map((e,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:P.length-1===o?"":o+1}),t.jsx("td",{children:e.requestedDate}),t.jsx("td",{children:parseFloat(e.sales).toFixed(2)}),t.jsx("td",{children:parseFloat(e.expense).toFixed(2)})]},e.requestedDate))})]})}):t.jsx(te,{option:re,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:f==="dark"?i.darkMode:i.lightMode})]})};export{et as default};
