import{_ as W}from"./index-ef582c05.js";import{r as f,u as K,j as t,h as Z,z as tt,A as et,J as ot,C as at,E as nt}from"./vendor-257ea584.js";import{l as rt,E as st,a as H,F as lt}from"./index-520e0e8e.js";const it="_piechart_yc0ui_11",ct="_chartContainer_yc0ui_23",dt="_legendButtonContainer_yc0ui_49",ut="_legendButton_yc0ui_49",ht="_codeBlockIcon_yc0ui_133",pt="_lightMode_yc0ui_191",ft="_dateFilter_yc0ui_195",_t="_officefilter_yc0ui_351",gt="_topContainer_yc0ui_443",mt="_darkMode_yc0ui_463",yt="_iconsContainer_yc0ui_631",xt="_icon_yc0ui_631",bt="_exportOptions_yc0ui_715",Ct="_NoDataOverlay_yc0ui_741",St="_exportOption_yc0ui_715",jt="_tableContainer_yc0ui_999",wt="_table_yc0ui_999",Ft="_summaryHeader_yc0ui_1035",kt="_periodHeader_yc0ui_1043",Nt="_closeButton_yc0ui_1075",vt="_tableWrapper_yc0ui_1105",Dt="_loadingOverlay_yc0ui_1113",Ot="_loadingSpinner_yc0ui_1139",$t="_boldOption_yc0ui_1151",Pt="_optionGroup_yc0ui_1161",e={piechart:it,chartContainer:ct,"legend-text":"_legend-text_yc0ui_31",legendButtonContainer:dt,legendButton:ut,codeBlockIcon:ht,lightMode:pt,"label-text":"_label-text_yc0ui_191",dateFilter:ft,officefilter:_t,topContainer:gt,darkMode:mt,"theme-container":"_theme-container_yc0ui_473",iconsContainer:yt,icon:xt,exportOptions:bt,NoDataOverlay:Ct,exportOption:St,tableContainer:jt,table:wt,summaryHeader:Ft,periodHeader:kt,closeButton:Nt,tableWrapper:vt,loadingOverlay:Dt,loadingSpinner:Ot,boldOption:$t,optionGroup:Pt},Tt=({themeMode:_,selectedRange:g,selectedOffice:B,isAdmin:I,alldata:w,isLoading:z})=>{const[x,Q]=f.useState([]),[F,b]=f.useState(!1),k=f.useRef(null),N=f.useRef(null),v=f.useRef(null),[D,O]=f.useState(!1),[T,R]=f.useState([]),[C,$]=f.useState(!1),[P,A]=f.useState([]),{t:r}=K();function L(o){return o.flatMap(n=>n.lstproduct).reduce((n,a)=>{const{productName:i,totalSales:l,qty:c,color:u,unitShortName:h}=a;return l!==0&&(n[i]?(n[i].totalSales+=l,n[i].qty+=c):n[i]={totalSales:l,qty:c,color:u,unitShortName:h}),n},{})}f.useEffect(()=>{const o=y(g[0]),s=y(g[1]);if(o&&s&&B&&w.graph2){const d=L(w.graph2),n=Object.entries(d).map(([l,{qty:c,color:u}])=>({value:c,name:l,itemStyle:{color:u}}));A(n);const a=Object.entries(d).map(([l,{totalSales:c,color:u,qty:h,unitShortName:m}])=>({productName:l,totalSale:c,color:u,totalQty:h,unit:m}));Q(a);const i=Object.entries(d).map(([l,{totalSales:c,qty:u,unitShortName:h}])=>({ProductName:l,Sales:c,Quantity:`${u} ${h}`}));R(i)}},[g,B,I,w]);const M=()=>{x.length>0&&O(!D),b(!1),$(!1)},G={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${r("Total Qty")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:_==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:D,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"top",style:{fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Qty",type:"pie",radius:["35%","70%"],center:["50%","50%"],roseType:"radius",selectedMode:"single",avoidLabelOverlap:!0,label:{show:P.length<=10,color:_==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:P.length>0?P:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},V=async()=>{const o=y(g[0]),s=y(g[1]),d=await W(()=>import("./exceljs.min-d3f5f5bd.js").then(i=>i.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),n=new d.Workbook,a=n.addWorksheet("Data");fetch(H).then(i=>i.blob()).then(i=>{const l=new FileReader;l.onload=function(){const c=l.result,u=n.addImage({base64:c,extension:"png"});a.addImage(u,{tl:{col:0,row:0},ext:{width:100,height:70}});const h=a.getCell("A2");h.value=r("Product Wise Summary Data"),h.font={bold:!0,color:{argb:"000000"},size:14},h.alignment={vertical:"middle",horizontal:"center"},a.mergeCells("A2:C2");const m=a.getCell("A3");m.value=`${r("Period")}: ${o} ${r("to")} ${s}`,m.font={bold:!0,color:{argb:"000000"},size:12},m.alignment={horizontal:"center"},a.mergeCells("A3:C3"),a.getColumn(1).width=50,a.getColumn(2).width=15;const S=a.addRow([r("Product Name"),r("Quantity"),r("Total Sales")]);S.font={bold:!0,color:{argb:"000000"},size:12},S.eachCell(p=>{p.font={bold:!0,color:{argb:"000000"},size:12},p.border={bottom:{style:"thin",color:{argb:"000000"}}}}),x.forEach(p=>{a.addRow([p.productName,`${p.totalQty} ${p.unit}`,`₹${p.totalSale}`])});const E=`product_wise_summary_data_${Date.now()}.xlsx`;n.xlsx.writeBuffer().then(p=>{lt.saveAs(new Blob([p]),E)})},l.readAsDataURL(i)})},y=o=>{if(!o)return"";const s=o.getFullYear(),d=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");return`${s}-${d}-${n}`},Y=async()=>{const o=y(g[0]),s=y(g[1]);W(()=>import("./index-520e0e8e.js").then(d=>d.j),["assets/index-520e0e8e.js","assets/vendor-257ea584.js","assets/index-ef582c05.js","assets/index-4da97eed.css"]).then(d=>{let n=d.default;const a=new n,i=[["Product Name","Quantity","Total Sale"]],l={1:{halign:"right"},2:{halign:"right"}},c={fontSize:12,fontStyle:"bold",halign:"center"},u={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},h=H,m=35,S=20;a.addImage(h,"PNG",15,12,m,S);const E=[["Product Wise Summary Data"]];a.autoTable({head:E,body:[],headStyles:{...c,fillColor:u.summaryHeader,textColor:"#FFFFFF"},margin:{top:30}});const p=[[`Period: ${o} to ${s}`]];a.autoTable({startY:39.5,head:p,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30}});const J=x.map(j=>[j.productName,`${j.totalQty} ${j.unit}`,j.totalSale.toFixed(2)]),U={startY:a.autoTable.previous.finalY+1,head:i,body:J,headStyles:{...c,fillColor:u.secondHeader,textColor:"#FFFFFF"},columnStyles:l};a.autoTable(U);const X=`product_wise_summary_data_${Date.now()}.pdf`;a.save(X)})};f.useEffect(()=>{const o=s=>{k.current&&!k.current.contains(s.target)&&N.current&&!N.current.contains(s.target)&&s.target.tagName!=="svg"&&s.target.tagName!=="path"&&b(!1),v.current&&!v.current.contains(s.target)&&O(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const q=()=>{O(!1),b(!F)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${e.chartContainer} ${_==="dark"?e.darkMode:e.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:e.legendButton,onClick:M,ref:v,children:[t.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:e.codeBlockIcon,title:"Legends",style:{filter:D||x.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${_==="dark"?e.darkMode:e.lightMode}`,children:r("Product Quantity")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:k,children:t.jsxs("div",{className:`${e.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${e.icon} ${_==="dark"?e.darkMode:e.lightMode} px-2 py-1`,onClick:q,children:F?t.jsx(Z,{style:{fontSize:"1.1rem"}}):t.jsx(tt,{style:{fontSize:"1.1rem"}})}),F&&t.jsxs("div",{className:`${e.exportOptions} ${_==="dark"?e.darkMode:e.lightMode}`,ref:N,children:[C?t.jsxs("div",{className:e.exportOption,onClick:()=>{$(!C),b(!1)},children:[t.jsx(ot,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:r("View Graph")})]}):t.jsxs("div",{className:e.exportOption,onClick:()=>{$(!C),b(!1)},children:[t.jsx(et,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:r("View Table")})]}),t.jsxs("div",{className:e.exportOption,onClick:V,children:[t.jsx(at,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:r("Export to Excel")})]}),t.jsxs("div",{className:e.exportOption,onClick:Y,children:[t.jsx(nt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:r("Export to PDF")})]})]})]})})]})}),z&&t.jsx("div",{className:e.NoDataOverlay,children:t.jsx("img",{src:rt,alt:"Loading...",width:50,height:50})}),T.length==0&&!C&&!z?t.jsx("div",{className:`${e.NoDataOverlay} fs-5`,children:r("No Data Found")}):"",C?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${_=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:r("Product")}),t.jsx("th",{scope:"col",children:r("Quantity")}),t.jsxs("th",{scope:"col",children:[r("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:T.map((o,s)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:s+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(st,{option:G,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:e.piechart},x.length)]})})};export{Tt as default};
