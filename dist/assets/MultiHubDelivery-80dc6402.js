import{_ as G}from"./index-fd6a7c6d.js";import{r as f,u as ie,j as e}from"./vendor-36ea1262.js";import{H as ce,n as de,w as pe,x as fe,y as he,z as ge,A as ue,i as $}from"./index.esm-39a9cba4.js";import{l as me}from"./ReactToastify-c5df916d.js";import{k as xe,Q as b,l as q,f as _e,a as be}from"./NotoSansDevanagari-VariableFont_wdth_wght-47b406a6.js";import"./jspdf.es.min-1b2a50b8.js";import"./Dashboard-36456d17.js";import"./install-b5fa7292.js";import"./assertThisInitialized-a147f0d7.js";const ye="_piechart_16h7l_5",Ce="_chartContainer_16h7l_19",we="_legendButtonContainer_16h7l_47",Se="_legendButton_16h7l_47",Fe="_codeBlockIcon_16h7l_131",Ne="_lightMode_16h7l_193",ve="_dateFilter_16h7l_203",je="_officefilter_16h7l_361",ke="_topContainer_16h7l_453",Oe="_darkMode_16h7l_473",$e="_iconsContainer_16h7l_641",De="_icon_16h7l_641",Be="_exportOptions_16h7l_733",He="_exportOption_16h7l_733",Ee="_NoDataOverlay_16h7l_883",Le="_tableContainer_16h7l_1019",ze="_table_16h7l_1019",Te="_summaryHeader_16h7l_1055",Ie="_periodHeader_16h7l_1063",Re="_closeButton_16h7l_1095",Ae="_tableWrapper_16h7l_1125",Pe="_loadingOverlay_16h7l_1133",Me="_loadingSpinner_16h7l_1159",We="_boldOption_16h7l_1171",Ue="_optionGroup_16h7l_1181",n={piechart:ye,chartContainer:Ce,"legend-text":"_legend-text_16h7l_27",legendButtonContainer:we,legendButton:Se,codeBlockIcon:Fe,lightMode:Ne,"label-text":"_label-text_16h7l_193",dateFilter:ve,officefilter:je,topContainer:ke,darkMode:Oe,"theme-container":"_theme-container_16h7l_483",iconsContainer:$e,icon:De,exportOptions:Be,exportOption:He,NoDataOverlay:Ee,tableContainer:Le,table:ze,summaryHeader:Te,periodHeader:Ie,closeButton:Re,tableWrapper:Ae,loadingOverlay:Pe,loadingSpinner:Me,boldOption:We,optionGroup:Ue},ct=({echarts:Ve,ReactECharts:Y,themeMode:h,selectedRange:N,selectedOffice:Ge,showGraph:A,isAdmin:qe,alldata:Ye,officeName:P,isLoading:M,setSelectedRange:Je,isDateRangeActive:Qe,setIsDateRangeActive:Xe,hubData:p})=>{const[J,Ke]=f.useState([]),[D,y]=f.useState(!1),B=f.useRef(null),H=f.useRef(null),E=f.useRef(null),{t:a}=ie(),[L,z]=f.useState(!1);f.useState([]);const[C,v]=f.useState(!1);f.useEffect(()=>{v(!A)},[A]);const Q=p?Array.from(new Set(p.flatMap(t=>Object.keys(t).slice(1)))):[],X={tooltip:{trigger:"axis",formatter:function(t){let o=`<div style="text-align: left;"><strong>${t[0].name}</strong><br/>`;return t.forEach(r=>{r.value!==0&&(o+=`<span style="display:inline-block; margin-right:5px; border-radius: 50%; width: 8px; height: 8px; background-color: ${r.color};"></span>${r.seriesName}: <strong>${r.value}</strong><br/>`)}),o+="</div>",o}},legend:{orient:"vertical",backgroundColor:h==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:L,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:h==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},grid:{left:"7%",right:"4%",top:"10%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:p?p.map(t=>t.HubName):[],axisLabel:{rotate:45,formatter:function(t){return t.length>10?t.substring(0,10)+"...":t}}},yAxis:{type:"value",name:"DeliveryCount"},series:Q.map(t=>({name:t,type:"bar",stack:"stackedBar",data:p.map(o=>o[t]),itemStyle:{borderRadius:[5,5,5,5]}}))},W=t=>{let o="";const r=new Uint8Array(t),x=r.byteLength;for(let i=0;i<x;i++)o+=String.fromCharCode(r[i]);return window.btoa(o)},j=t=>{if(!t)return"";let o=new Date(t);const r=o.getFullYear(),x=String(o.getMonth()+1).padStart(2,"0");return`${String(o.getDate()).padStart(2,"0")}-${x}-${r}`};f.useEffect(()=>{const t=o=>{B.current&&!B.current.contains(o.target)&&H.current&&!H.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&y(!1),E.current&&!E.current.contains(o.target)&&z(!1)};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const K=()=>{z(!1),y(!D)},Z=async()=>{const t=b.loading("Please wait..."),o=j(N[0]),r=j(N[1]),x=await G(()=>import("./exceljs.min-6ae529e9.js").then(u=>u.e),["assets/exceljs.min-6ae529e9.js","assets/vendor-36ea1262.js"]),i=new x.Workbook,l=i.addWorksheet("Data");fetch(q).then(u=>u.blob()).then(async u=>{const w=new FileReader;w.onload=async function(){const T=w.result,S=i.addImage({base64:T,extension:"png"});l.addImage(S,{tl:{col:0,row:0},ext:{width:100,height:60}});const F=l.getCell("A1");F.value=`${a("Hub Deliveries Distribution")}`,F.font={bold:!0,color:{argb:"000000"},size:14},F.alignment={vertical:"middle",horizontal:"center"},l.mergeCells("A1:D1");const s=l.getCell("A2");s.value=`${a("Period")}: ${o} ${a("to")} ${r}`,s.font={bold:!0,color:{argb:"000000"},size:12},s.alignment={horizontal:"center"},l.mergeCells("A2:D2"),l.getColumn(1).width=15,l.getColumn(2).width=50,l.getColumn(3).width=15,l.getColumn(4).width=15;const k=l.addRow([a("#"),a("Hub Name"),a("Office")]);k.font={bold:!0,color:{argb:"000000"},size:12},k.eachCell(c=>{c.font={bold:!0,color:{argb:"000000"},size:12},c.border={bottom:{style:"thin",color:{argb:"000000"}}}}),p.forEach((c,_)=>{const d=l.addRow([_+1,c.HubName,Object.keys(c).map(m=>{if(m!=="HubName"&&c[m]>0)return m}).toString().replace("null,","").replace(/[,]{2,}/g,",").replace(/^[,]/g,"").replace(/[,]$/g,"")]);d.getCell(1).alignment={horizontal:"left"},d.getCell(2).alignment={horizontal:"left"},d.getCell(3).alignment={horizontal:"left"},d.getCell(4).alignment={horizontal:"right"}});const O=`${Date.now()}hub_wise_summary_${P}_${o}_${r}.xlsx`;i.xlsx.writeBuffer().then(async c=>{const _=new FormData;_.append("file",new Blob([c]),O);try{const d=await $.post("http://115.124.120.251:5064/api/uploader",_,{headers:{"Content-Type":"multipart/form-data"}});d.status==200?b.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):b.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const m=d.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${m}`}catch(d){console.error("Error saving Excel file:",d)}})},w.readAsDataURL(u)})},ee=async()=>{const t=b.loading("Please wait..."),o=j(N[0]),r=j(N[1]),i=new URLSearchParams(window.location.search).get("lang"),l=await $.get(_e,{responseType:"arraybuffer"}),u=W(l.data),w=await $.get(be,{responseType:"arraybuffer"}),T=W(w.data);G(()=>import("./jspdf.es.min-1b2a50b8.js").then(S=>S.j),["assets/jspdf.es.min-1b2a50b8.js","assets/index-fd6a7c6d.js","assets/vendor-36ea1262.js","assets/index-ce24f766.css","assets/Dashboard-36456d17.js","assets/index.esm-39a9cba4.js","assets/install-b5fa7292.js","assets/assertThisInitialized-a147f0d7.js","assets/Dashboard-5c3f3713.css"]).then(async S=>{let F=S.default;const s=new F;s.addFileToVFS("NotoSansBengali.ttf",u),s.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),s.setFont("NotoSansBengali"),s.addFileToVFS("NotoSansDevanagari.ttf",T),s.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),s.setFont("NotoSansDevanagari");const k=[[a("#"),a("Hub Name"),a("Office")]],U={0:{halign:"center"},1:{halign:"center"},2:{halign:"left"},3:{halign:"center"}},O={fontSize:12,fontStyle:"bold",halign:"center"},c={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},_=q,d=35,m=20;s.addImage(_,"PNG",15,12,d,m);const oe=[[`${a("Hub Deliveries Distribution")}`]];s.autoTable({head:oe,body:[],headStyles:{...O,fillColor:c.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:i==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const ne=[[`${a("Period")}: ${o} ${a("to")} ${r}`]];s.autoTable({startY:39.5,head:ne,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:i==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let ae=p.map((g,I)=>[I+1,g.HubName,Object.keys(g).map(R=>{if(R!=="HubName"&&g[R]>0)return R}).toString().replace(/[,]{2,}/g,",").replace(/^[,]/g,"").replace(/[,]$/g,"")]);const re={startY:s.autoTable.previous.finalY+1,head:k,body:ae,headStyles:{...O,fillColor:c.secondHeader,textColor:"#FFFFFF"},columnStyles:U,styles:{font:i==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};s.autoTable(re);const se=`${Date.now()}hub_wise_summary_${P}_${o}_${r}.pdf`,le=s.output("blob"),V=new FormData;V.append("file",le,se);try{const g=await $.post("http://115.124.120.251:5064/api/uploader",V,{headers:{"Content-Type":"multipart/form-data"}});g.status==200?b.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):b.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const I=await g.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${I}`}catch(g){console.error("Error saving PDF file:",g)}})};ce({typography:{button:{textTransform:"none"}}});const te=()=>{z(!L),y(!1),v(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{ref:E,className:`${n.chartContainer} ${h==="dark"?n.darkMode:n.lightMode}`,children:[e.jsx(xe,{position:"top-center",theme:h}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[e.jsx("button",{className:n.legendButton,onClick:te,children:e.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:n.codeBlockIcon,title:"Legends",style:{filter:L?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})}),e.jsx("div",{className:`fw-bold noselect me-2 fs-${window.innerWidth<=768?7:5} ${h==="dark"?n.darkMode:n.lightMode}`,children:a("Hub Deliveries Distribution")}),e.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:B,children:e.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[e.jsx("div",{className:`${n.icon} ${h==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:K,children:D?e.jsx(de,{style:{fontSize:"1.1rem"}}):e.jsx(pe,{style:{fontSize:"1.1rem"}})}),D&&e.jsxs("div",{className:`${n.exportOptions} ${h==="dark"?n.darkMode:n.lightMode}`,ref:H,children:[C?e.jsxs("div",{className:n.exportOption,onClick:()=>{v(!C),y(!1)},children:[e.jsx(he,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),e.jsx("span",{children:a("View Graph")})]}):e.jsxs("div",{className:n.exportOption,onClick:()=>{v(!C),y(!1)},children:[e.jsx(fe,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),e.jsx("span",{children:a("View Table")})]}),e.jsxs("div",{className:n.exportOption,onClick:Z,children:[e.jsx(ge,{style:{fontSize:"1.1rem",color:"green"}}),e.jsx("span",{children:a("Export to Excel")})]}),e.jsxs("div",{className:n.exportOption,onClick:ee,children:[e.jsx(ue,{style:{fontSize:"1.1rem",color:"red"}}),e.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),M&&e.jsx("div",{className:n.loadingOverlay,children:e.jsx("img",{src:me,alt:"Loading...",width:50,height:50})}),p&&p.length==0&&!C&&!M?e.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",C?e.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"333px"},children:e.jsxs("table",{className:`table  ${h=="dark"?"table-dark":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"#"}),e.jsx("th",{scope:"col",children:a("Hub Name")}),e.jsx("th",{scope:"col",children:a("Office")})]})}),e.jsx("tbody",{children:p.map((t,o)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:o+1}),e.jsx("td",{children:t.HubName}),e.jsx("td",{children:Object.keys(t).map(r=>{if(r!=="HubName"&&t[r]!==0)return r+", "})})]},`${t.HubName}`))})]})}):e.jsx(Y,{option:X,style:{height:"341px",width:"100%",maxWidth:"2300px"},className:n.piechart},J.length)]})})};export{ct as default};
