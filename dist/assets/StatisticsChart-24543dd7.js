import{_ as J}from"./index-3f2a06ab.js";import{r as g,u as ce,z as pe,j as t,i as fe,A as he,B as xe,C as ue,E as me,G as ge,a as $}from"./vendor-ff86a3b6.js";import{k as ye,l as be,E as we,Q as F,a as Q,f as Se,b as _e}from"./NotoSansDevanagari-VariableFont_wdth_wght-f7c0b8f2.js";const Fe="_chartContainer_1mphg_1",Ce="_lightMode_1mphg_47",De="_dateFilter_1mphg_51",ve="_officefilter_1mphg_207",Ee="_topContainer_1mphg_299",je="_darkMode_1mphg_319",ke="_iconsContainer_1mphg_487",Ne="_icon_1mphg_487",$e="_exportOptions_1mphg_571",Oe="_exportOption_1mphg_571",Be="_tableContainer_1mphg_825",Ie="_table_1mphg_825",Te="_summaryHeader_1mphg_861",Ae="_periodHeader_1mphg_869",ze="_closeButton_1mphg_901",Le="_tableWrapper_1mphg_931",Pe="_loadingOverlay_1mphg_939",We="_NoDataOverlay_1mphg_963",He="_loadingSpinner_1mphg_991",qe="_boldOption_1mphg_1003",Ge="_optionGroup_1mphg_1013",n={chartContainer:Fe,lightMode:Ce,"label-text":"_label-text_1mphg_47",dateFilter:De,officefilter:ve,topContainer:Ee,darkMode:je,"theme-container":"_theme-container_1mphg_329",iconsContainer:ke,icon:Ne,exportOptions:$e,exportOption:Oe,tableContainer:Be,table:Ie,summaryHeader:Te,periodHeader:Ae,closeButton:ze,tableWrapper:Le,loadingOverlay:Pe,NoDataOverlay:We,loadingSpinner:He,boldOption:qe,optionGroup:Ge},Ye=({selectedRange:h,themeMode:i,selectedOffice:T,isAdmin:X,alldata:q,isLoading:G,officeName:Z})=>{const[x,K]=g.useState([]),[A,O]=g.useState(!1),z=g.useRef(null),L=g.useRef(null),[ee,te]=g.useState(!0),[V,ae]=g.useState([]),[C,R]=g.useState(!1),{t:a}=ce();a("Date"),`${a("Sales")}`,`${a("Expense")}`,a("Rows"),g.useEffect(()=>{const e=w(h[0]),o=w(h[1]);e&&o&&T&&(()=>{const m=q;if(Array.isArray(m.graph1)){const p=m.graph1.map(d=>({requestedDate:d.requestedDate,sales:d.totalIncome,expense:d.totalExpense}));let s=p.filter(d=>d.sales!==0||d.expense!==0);const D=p.reduce((d,y)=>d+y.sales,0).toFixed(2),b=p.reduce((d,y)=>d+y.expense,0).toFixed(2);s.push({requestedDate:a("Total"),sales:D,expense:b}),ae(s),K(m.graph1)}})()},[h,T,X,q]);const U=(x.filter(e=>e.totalIncome>0).reduce((e,o)=>e+o.totalIncome,0)/x.filter(e=>e.totalIncome>0).length).toFixed(0);g.useEffect(()=>{if(h[0]&&h[1]){const e=new Date(h[0]),o=new Date(h[1]),l=pe(o,e)+1;te(l<=7)}},[h,T]);const oe={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:i==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",formatter:function(e){for(var o=`<b>${a("Date")}:</b> `+e[0].name+"<br/>",l=0;l<e.length;l++)o+="<b>"+e[l].seriesName+":</b> "+e[l].value+"<br/>";return o},textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:(window.innerWidth>550,270),data:[a("Sales"),a("Expense"),a("Average Sales")],textStyle:{color:i==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:(window.innerWidth<=768,"4%"),right:"3%",top:"10%",bottom:x.length>0?"15%":"20%",containLabel:x.length>0},xAxis:{type:"category",name:"",nameLocation:"middle",nameGap:35,nameTextStyle:{color:i==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},boundaryGap:!0,data:x.map(e=>e.requestedDate),axisLine:{lineStyle:{color:i==="dark"?"#ffffff":"#000000"}},axisLabel:{color:i==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,nameTextStyle:{color:i==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},axisLine:{lineStyle:{color:i==="dark"?"#ffffff":"#000000"}},axisLabel:{color:i==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:i==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],dataZoom:[{show:!0,type:"inside",filterMode:"none",xAxisIndex:[0],startValue:new Date(h[0]),endValue:new Date(h[1])}],series:ee?[{name:a("Sales"),type:"bar",data:x.map(e=>e.totalIncome),yAxisIndex:0},{name:a("Expense"),type:"bar",data:x.map(e=>e.totalExpense),yAxisIndex:0},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:x.map(()=>U)}]:[{name:a("Sales"),type:"line",smooth:!0,data:x.map(e=>e.totalIncome),yAxisIndex:0},{name:a("Expense"),type:"line",smooth:!0,data:x.map(e=>e.totalExpense),yAxisIndex:0},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:x.map(()=>U)}]},Y=e=>{let o="";const l=new Uint8Array(e),m=l.byteLength;for(let p=0;p<m;p++)o+=String.fromCharCode(l[p]);return window.btoa(o)},ne=async()=>{const e=F.loading("Please wait..."),o=w(h[0]),l=w(h[1]),m=await J(()=>import("./exceljs.min-e7dcf029.js").then(d=>d.e),["assets/exceljs.min-e7dcf029.js","assets/vendor-ff86a3b6.js"]),p=new m.Workbook,s=p.addWorksheet("Graph Data"),D=await $.get(Q,{responseType:"blob"}),b=new FileReader;b.onload=function(){const d=b.result,y=p.addImage({base64:d,extension:"png"});s.addImage(y,{tl:{col:0,row:0},ext:{width:100,height:60}});const v=s.getCell("A1");v.value=a("Sales-Expense Summary"),v.font={bold:!0,color:{argb:"000000"},size:14},v.alignment={vertical:"middle",horizontal:"center"},s.mergeCells("A1:C1");const c=s.getCell("A2");c.value=`${a("Period")}: ${o} ${a("to")} ${l}`,c.font={bold:!0,color:{argb:"000000"},size:12},c.alignment={horizontal:"center"},s.mergeCells("A2:C2"),s.getColumn(1).width=50,s.getColumn(2).width=15,s.getColumn(3).width=15;const B=s.addRow([a("Date"),a("Sales"),a("Expense")]);B.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},B.eachCell(r=>{r.font={bold:!0,color:{argb:"000000"},size:12},r.border={bottom:{style:"thin",color:{argb:"000000"}}}});const E=x.filter(r=>r.totalIncome!==0||r.totalExpense!==0);E.forEach(r=>{const u=s.addRow([r.requestedDate,Number(r.totalIncome),Number(r.totalExpense)]);u.getCell(2).numFmt="0.00",u.getCell(3).numFmt="0.00"});const j=s.addRow([a("Total"),"",""]);j.font={bold:!0,color:{argb:"000000"},size:12};const P=E.reduce((r,u)=>r+u.totalIncome,0),W=E.reduce((r,u)=>r+u.totalExpense,0),S=s.getCell(`B${j.number}`);S.value=`₹${P.toFixed(2)}`,S.alignment={horizontal:"right"};const k=s.getCell(`C${j.number}`);k.value=`₹${W.toFixed(2)}`,k.alignment={horizontal:"right"},p.xlsx.writeBuffer().then(async r=>{const u=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),I=new FormData;I.append("file",u,`${Date.now()}_sales-expense.xlsx`);try{const _=await $.post("http://115.124.120.251:5064/api/uploader",I,{headers:{"Content-Type":"multipart/form-data"}});_.status==200?F.update(e,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):F.update(e,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const H=_.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${H}`}catch(_){console.error("Error saving Excel file:",_)}})},b.readAsDataURL(D.data)},se=async()=>{const e=w(h[0]),o=w(h[1]),l=F.loading("Please wait..."),p=new URLSearchParams(window.location.search).get("lang"),s=await $.get(Se,{responseType:"arraybuffer"}),D=Y(s.data),b=await $.get(_e,{responseType:"arraybuffer"}),d=Y(b.data);J(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-f7c0b8f2.js").then(y=>y.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-f7c0b8f2.js","assets/vendor-ff86a3b6.js","assets/index-3f2a06ab.js","assets/index-4da97eed.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async y=>{let v=y.default;const c=new v;c.setFontSize(12),c.addFileToVFS("NotoSansBengali.ttf",D),c.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),c.setFont("NotoSansBengali"),c.addFileToVFS("NotoSansDevanagari.ttf",d),c.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),c.setFont("NotoSansDevanagari");const B=Q,E=35,j=20;c.addImage(B,"PNG",15,9,E,j);const P=[[a("Sales-Expense Summary")]];c.autoTable({startY:27,head:P,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0},styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const W=[[`${a("Period")}: ${e} ${a("to")} ${o}`]];c.autoTable({startY:36,head:W,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const S=x.filter(f=>f.totalIncome!==0||f.totalExpense!==0),k=S.map(f=>[f.requestedDate,f.totalIncome.toFixed(2),f.totalExpense.toFixed(2)]),r=S.reduce((f,N)=>f+N.totalIncome,0),u=S.reduce((f,N)=>f+N.totalExpense,0);(r!==0||u!==0)&&k.push([a("Total"),`${r.toFixed(2)}`,`${u.toFixed(2)}`]);const I=[a("Date"),a("Sales"),a("Expense")],_={1:{halign:"right"},2:{halign:"right"}},H={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"};c.autoTable(I,k,{startY:45,headStyles:H,columnStyles:_,styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const ie=Date.now(),de=new Blob([c.output("blob")],{type:"application/pdf"}),M=new FormData;M.append("file",de,`${ie}_sales-expense.pdf`);try{const f=await $.post("http://115.124.120.251:5064/api/uploader",M,{headers:{"Content-Type":"multipart/form-data"}});f.status==200?F.update(l,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):F.update(l,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const N=await f.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${N}`}catch(f){console.error("Error saving PDF file:",f)}})};g.useEffect(()=>{const e=o=>{z.current&&!z.current.contains(o.target)&&L.current&&!L.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&O(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const re=()=>{O(!A)},w=e=>{if(!e)return"";const o=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0");return`${o}-${l}-${m}`},le=()=>{R(!C),O(!1)};return t.jsxs("div",{className:`${n.chartContainer} ${i==="dark"?n.darkMode:n.lightMode}`,children:[t.jsx(ye,{position:"top-center",theme:i}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${i==="dark"?n.darkMode:n.lightMode}`,children:[a("Sales-Expense")," ",a("of")," ",Z]}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:z,children:t.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${n.icon} ${i==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:re,children:A?t.jsx(fe,{style:{fontSize:"1.1rem"}}):t.jsx(he,{style:{fontSize:"1.1rem"}})}),A&&t.jsxs("div",{className:`${n.exportOptions} ${i==="dark"?n.darkMode:n.lightMode}`,ref:L,children:[C?t.jsxs("div",{className:n.exportOption,onClick:()=>{R(!C),O(!1)},children:[t.jsx(ue,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:n.exportOption,onClick:le,children:[t.jsx(xe,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:n.exportOption,onClick:ne,children:[t.jsx(me,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:n.exportOption,onClick:se,children:[t.jsx(ge,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),G&&t.jsx("div",{className:n.NoDataOverlay,children:t.jsx("img",{src:be,alt:"Loading...",width:50,height:50})}),V.length==1&&!C&&!G?t.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",C?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table ${i=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:a("Date")}),t.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]}),t.jsxs("th",{scope:"col",children:[a("Expense"),"(₹)"]})]})}),t.jsx("tbody",{children:V.map((e,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:o+1}),t.jsx("td",{children:e.requestedDate}),t.jsx("td",{children:parseFloat(e.sales).toFixed(2)}),t.jsx("td",{children:parseFloat(e.expense).toFixed(2)})]},e.requestedDate))})]})}):t.jsx(we,{option:oe,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:i==="dark"?n.darkMode:n.lightMode})]})};export{Ye as default};
