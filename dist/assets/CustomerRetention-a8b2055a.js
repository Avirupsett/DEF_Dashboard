import{r,f as F,j as t}from"./vendor-f48e548e.js";import{l as T}from"./loading-e5c9837d.js";import{k as E}from"./react-toastify.esm-81104cc6.js";/* empty css                      */import{j as I}from"./assertThisInitialized-02748e78.js";import{T as A}from"./ButtonBase-a89ef7b4.js";import{F as W,S as P,M as _}from"./Select-7d29be83.js";import{I as Y}from"./InputLabel-6317524e.js";import"./jspdf.es.min-9cb7d1fb.js";import"./index-a7500c48.js";import"./Dashboard-bac1c265.js";import"./installSVGRenderer-7788c1a1.js";import"./Skeleton-5c5f8b2f.js";import"./createSvgIcon-a28dcbb5.js";import"./useTheme-6bee9f51.js";const $="_piechart_wa0ri_11",H="_chartContainer_wa0ri_23",R="_legendButtonContainer_wa0ri_49",L="_legendButton_wa0ri_49",G="_codeBlockIcon_wa0ri_133",z="_lightMode_wa0ri_191",V="_dateFilter_wa0ri_195",q="_officefilter_wa0ri_351",J="_topContainer_wa0ri_443",K="_darkMode_wa0ri_463",Q="_iconsContainer_wa0ri_631",U="_icon_wa0ri_631",X="_exportOptions_wa0ri_715",Z="_exportOption_wa0ri_715",tt="_NoDataOverlay_wa0ri_861",et="_tableContainer_wa0ri_993",rt="_table_wa0ri_993",ot="_summaryHeader_wa0ri_1029",at="_periodHeader_wa0ri_1037",nt="_closeButton_wa0ri_1069",st="_tableWrapper_wa0ri_1099",it="_loadingOverlay_wa0ri_1107",lt="_loadingSpinner_wa0ri_1133",ct="_boldOption_wa0ri_1145",dt="_optionGroup_wa0ri_1155",l={piechart:$,chartContainer:H,"legend-text":"_legend-text_wa0ri_31",legendButtonContainer:R,legendButton:L,codeBlockIcon:G,lightMode:z,"label-text":"_label-text_wa0ri_191",dateFilter:V,officefilter:q,topContainer:J,darkMode:K,"theme-container":"_theme-container_wa0ri_473",iconsContainer:Q,icon:U,exportOptions:X,exportOption:Z,NoDataOverlay:tt,tableContainer:et,table:rt,summaryHeader:ot,periodHeader:at,closeButton:nt,tableWrapper:st,loadingOverlay:it,loadingSpinner:lt,boldOption:ct,optionGroup:dt},Yt=({echarts:ut,ReactECharts:j,themeMode:u,selectedRange:n,selectedOffice:ht,isAdmin:pt,alldata:i,showGraph:mt,officeName:_t,isLoading:x,newExData:xt})=>{const[s,c]=r.useState([]),[ft,S]=r.useState(!1),f=r.useRef(null),g=r.useRef(null),w=r.useRef(null),{t:o}=F(),[gt,v]=r.useState(!1),[h,wt]=r.useState([]);r.useState(!0);const[y,yt]=r.useState(!1),[d,p]=r.useState("Daily");r.useState([]),r.useState([]),r.useState([]);const[m,bt]=r.useState(!1),[b,Ct]=r.useState("Customer Retention");r.useEffect(()=>{const e=Math.round((new Date(n[1]).getTime()-new Date(n[0]).getTime())/864e5);i.graph4&&(e<=31?(p("Daily"),c(i.graph4.DaywiseRecurringCustomer)):(p("Monthly"),c(i.graph4.MonthlyRecurringCustomer)))},[i,n]);const N={tooltip:{position:"top"},grid:{height:window.innerWidth>768?"75%":"65%",left:window.innerWidth>768?"15%":"25%",bottom:window.innerWidth>768?"20%":"29%"},xAxis:{type:"category",data:s?s.cohort_index:[],splitArea:{show:!0}},yAxis:{type:"category",data:s?s.formatted_dates:[],splitArea:{show:!0}},visualMap:{min:0,max:100,calculable:!0,orient:"horizontal",left:"center"},series:[{type:"heatmap",data:s&&s.data?s.data.map(function(e){return[e[1],e[0],e[2]||"-"]}):[],label:{show:!0},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},C=e=>{if(!e)return"";const a=e.getFullYear(),B=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${B}-${a}`};r.useEffect(()=>{const e=a=>{f.current&&!f.current.contains(a.target)&&g.current&&!g.current.contains(a.target)&&a.target.tagName!=="svg"&&a.target.tagName!=="path"&&S(!1),w.current&&!w.current.contains(a.target)&&v(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const D=e=>{const a=e.target.value;switch(p(a),a){case"Daily":c(i.graph4.DaywiseRecurringCustomer);break;case"Monthly":c(i.graph4.MonthlyRecurringCustomer);break;case"Yearly":c(i.graph4.YearlyRecurringCustomer);break;default:return}},M=I({typography:{button:{textTransform:"none"}}}),O=C(n[0]),k=C(n[1]);return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${l.chartContainer} ${u==="dark"?l.darkMode:l.lightMode}`,children:[t.jsx(E,{position:"top-center",theme:u}),t.jsx("div",{className:"container-fluid",children:t.jsx("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:t.jsx("div",{className:"d-flex align-items-center",children:t.jsx(A,{theme:M,children:t.jsxs(W,{sx:{mx:1,mt:1,minWidth:180},size:"small",children:[t.jsx(Y,{id:"demo-simple-select-helper-label",style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},children:o(b)}),t.jsxs(P,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:d,onChange:D,style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},label:o(b),children:[t.jsx(_,{disabled:!(Math.round((new Date(n[1]).getTime()-new Date(n[0]).getTime())/(1e3*60*60*24))<=31),style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Daily",children:o("Daily")}),t.jsx(_,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Monthly",children:o("Monthly")}),t.jsx(_,{disabled:!(Math.round(new Date(n[1]).getFullYear()-new Date(n[0]).getFullYear())>=1),style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Yearly",children:o("Yearly")})]})]})})})})}),x&&t.jsx("div",{className:l.loadingOverlay,children:t.jsx("img",{src:T,alt:"Loading...",width:50,height:50})}),s&&s.length==0&&!y&&!x?t.jsx("div",{className:`${l.NoDataOverlay} fs-5`,children:o("No Data Found")}):null,y?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"290px"},children:t.jsxs("table",{className:`table ${u=="dark"?"table-dark":""}`,children:[t.jsxs("thead",{children:[t.jsx("tr",{children:t.jsxs("th",{colSpan:"3",style:{textAlign:"center"},children:[o("Period"),": ",O," ",o("to")," ",k]})}),t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:o(m===!0?d==="Name"?"Customer Name":d==="Mobile"?"Mobile No":"Vehicle No":"Customer Type")}),t.jsx("th",{scope:"col",children:m==!0?o("Count"):o("Total Count")})]})]}),t.jsxs("tbody",{children:[h.map((e,a)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:a+1}),t.jsxs("td",{children:[" ",m===!0?d==="Name"?e.CustomerName:d==="Mobile"?e.MobileNo:e.VehicleNo:e.CustomerName]}),t.jsx("td",{children:e["Total Count"]})]},a)),h.length>0&&t.jsxs("tr",{children:[t.jsx("th",{scope:"row"}),t.jsx("td",{children:o("Total")}),t.jsx("td",{children:h.reduce((e,a)=>e+a["Total Count"],0)})]})]})]})}):t.jsx(j,{option:N,style:{height:"350px",width:"100%",maxWidth:"2300px"},className:l.piechart})]})})};export{Yt as default};
