import{_ as W}from"./index-ef582c05.js";import{r as f,u as K,j as t,h as Z,z as tt,A as et,J as ot,C as at,E as nt}from"./vendor-257ea584.js";import{l as st,E as rt,a as H,F as lt}from"./index-520e0e8e.js";const it="_piechart_1ah4s_11",ct="_chartContainer_1ah4s_23",dt="_legendButtonContainer_1ah4s_49",ht="_legendButton_1ah4s_49",pt="_codeBlockIcon_1ah4s_133",ut="_lightMode_1ah4s_191",ft="_dateFilter_1ah4s_195",_t="_officefilter_1ah4s_351",gt="_topContainer_1ah4s_443",mt="_darkMode_1ah4s_463",xt="_iconsContainer_1ah4s_631",bt="_icon_1ah4s_631",yt="_exportOptions_1ah4s_715",St="_exportOption_1ah4s_715",Ct="_NoDataOverlay_1ah4s_861",jt="_tableContainer_1ah4s_993",wt="_table_1ah4s_993",kt="_summaryHeader_1ah4s_1029",Ft="_periodHeader_1ah4s_1037",Nt="_closeButton_1ah4s_1069",vt="_tableWrapper_1ah4s_1099",Ot="_loadingOverlay_1ah4s_1107",Dt="_loadingSpinner_1ah4s_1133",$t="_boldOption_1ah4s_1145",Pt="_optionGroup_1ah4s_1155",e={piechart:it,chartContainer:ct,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:dt,legendButton:ht,codeBlockIcon:pt,lightMode:ut,"label-text":"_label-text_1ah4s_191",dateFilter:ft,officefilter:_t,topContainer:gt,darkMode:mt,"theme-container":"_theme-container_1ah4s_473",iconsContainer:xt,icon:bt,exportOptions:yt,exportOption:St,NoDataOverlay:Ct,tableContainer:jt,table:wt,summaryHeader:kt,periodHeader:Ft,closeButton:Nt,tableWrapper:vt,loadingOverlay:Ot,loadingSpinner:Dt,boldOption:$t,optionGroup:Pt},Tt=({themeMode:_,selectedRange:g,selectedOffice:B,isAdmin:I,alldata:w,isLoading:z})=>{const[b,R]=f.useState([]),[k,A]=f.useState([]),[F,y]=f.useState(!1),N=f.useRef(null),v=f.useRef(null),O=f.useRef(null),{t:s}=K(),[D,$]=f.useState(!1),[T,L]=f.useState([]),[S,P]=f.useState(!1);function M(o){return o.flatMap(n=>n.lstproduct).reduce((n,a)=>{const{productName:i,totalSales:l,qty:c,color:h,unitShortName:p}=a;return l!==0&&(n[i]?(n[i].totalSales+=l,n[i].qty+=c):n[i]={totalSales:l,qty:c,color:h,unitShortName:p}),n},{})}f.useEffect(()=>{const o=x(g[0]),r=x(g[1]);if(o&&r&&B&&w.graph2){const d=M(w.graph2),n=Object.entries(d).map(([l,{totalSales:c,color:h}])=>({value:c,name:l,itemStyle:{color:h}}));A(n);const a=Object.entries(d).map(([l,{totalSales:c,color:h,qty:p,unitShortName:m}])=>({productName:l,totalSale:c,color:h,totalQty:p,unit:m}));R(a);const i=Object.entries(d).map(([l,{totalSales:c,qty:h,unitShortName:p}])=>({ProductName:l,Sales:c,Quantity:`${h} ${p}`}));L(i)}},[g,B,I,w]);const Q=()=>{b.length>0&&($(!D),y(!1),P(!1))},G={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${s("Total Sales")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:_==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:D,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"2%",style:{fill:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Sales",type:"pie",radius:["40%","65%"],center:["50%","50%"],selectedMode:"single",avoidLabelOverlap:!0,label:{show:k.length<=10,color:_==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:k.length>0?k:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},V=async()=>{const o=x(g[0]),r=x(g[1]),d=await W(()=>import("./exceljs.min-d3f5f5bd.js").then(i=>i.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),n=new d.Workbook,a=n.addWorksheet("Data");fetch(H).then(i=>i.blob()).then(i=>{const l=new FileReader;l.onload=function(){const c=l.result,h=n.addImage({base64:c,extension:"png"});a.addImage(h,{tl:{col:0,row:0},ext:{width:100,height:70}});const p=a.getCell("A2");p.value=s("Product Wise Summary Data"),p.font={bold:!0,color:{argb:"000000"},size:14},p.alignment={vertical:"middle",horizontal:"center"},a.mergeCells("A2:C2");const m=a.getCell("A3");m.value=`${s("Period")}: ${o} ${s("to")} ${r}`,m.font={bold:!0,color:{argb:"000000"},size:12},m.alignment={horizontal:"center"},a.mergeCells("A3:C3"),a.getColumn(1).width=50,a.getColumn(2).width=15;const C=a.addRow([s("Product Name"),s("Quantity"),s("Total Sales")]);C.font={bold:!0,color:{argb:"000000"},size:12},C.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),b.forEach(u=>{a.addRow([u.productName,`${u.totalQty} ${u.unit}`,`₹${u.totalSale}`])});const E=`product_wise_summary_data_${Date.now()}.xlsx`;n.xlsx.writeBuffer().then(u=>{lt.saveAs(new Blob([u]),E)})},l.readAsDataURL(i)})},x=o=>{if(!o)return"";const r=o.getFullYear(),d=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");return`${r}-${d}-${n}`},Y=async()=>{const o=x(g[0]),r=x(g[1]);W(()=>import("./index-520e0e8e.js").then(d=>d.j),["assets/index-520e0e8e.js","assets/vendor-257ea584.js","assets/index-ef582c05.js","assets/index-4da97eed.css"]).then(d=>{let n=d.default;const a=new n,i=[["Product Name","Quantity","Total Sale"]],l={1:{halign:"right"},2:{halign:"right"}},c={fontSize:12,fontStyle:"bold",halign:"center"},h={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},p=H,m=35,C=20;a.addImage(p,"PNG",15,12,m,C);const E=[["Product Wise Summary Data"]];a.autoTable({head:E,body:[],headStyles:{...c,fillColor:h.summaryHeader,textColor:"#FFFFFF"},margin:{top:30}});const u=[[`Period: ${o} to ${r}`]];a.autoTable({startY:39.5,head:u,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30}});const J=b.map(j=>[j.productName,`${j.totalQty} ${j.unit}`,j.totalSale.toFixed(2)]),U={startY:a.autoTable.previous.finalY+1,head:i,body:J,headStyles:{...c,fillColor:h.secondHeader,textColor:"#FFFFFF"},columnStyles:l};a.autoTable(U);const X=`product_wise_summary_data_${Date.now()}.pdf`;a.save(X)})};f.useEffect(()=>{const o=r=>{N.current&&!N.current.contains(r.target)&&v.current&&!v.current.contains(r.target)&&r.target.tagName!=="svg"&&r.target.tagName!=="path"&&y(!1),O.current&&!O.current.contains(r.target)&&$(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const q=()=>{$(!1),y(!F)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${e.chartContainer} ${_==="dark"?e.darkMode:e.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:e.legendButton,onClick:Q,ref:O,children:[t.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:e.codeBlockIcon,title:"Legends",style:{filter:D||b.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${_==="dark"?e.darkMode:e.lightMode}`,children:s("Product Volume")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:N,children:t.jsxs("div",{className:`${e.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${e.icon} ${_==="dark"?e.darkMode:e.lightMode} px-2 py-1`,onClick:q,children:F?t.jsx(Z,{style:{fontSize:"1.1rem"}}):t.jsx(tt,{style:{fontSize:"1.1rem"}})}),F&&t.jsxs("div",{className:`${e.exportOptions} ${_==="dark"?e.darkMode:e.lightMode}`,ref:v,children:[S?t.jsxs("div",{className:e.exportOption,onClick:()=>{P(!S),y(!1)},children:[t.jsx(ot,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:s("View Graph")})]}):t.jsxs("div",{className:e.exportOption,onClick:()=>{P(!S),y(!1)},children:[t.jsx(et,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:s("View Table")})]}),t.jsxs("div",{className:e.exportOption,onClick:V,children:[t.jsx(at,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:s("Export to Excel")})]}),t.jsxs("div",{className:e.exportOption,onClick:Y,children:[t.jsx(nt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:s("Export to PDF")})]})]})]})})]})}),z&&t.jsx("div",{className:e.NoDataOverlay,children:t.jsx("img",{src:st,alt:"Loading...",width:50,height:50})}),T.length==0&&!S&&!z?t.jsx("div",{className:`${e.NoDataOverlay} fs-5`,children:s("No Data Found")}):"",S?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${_=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:s("Product")}),t.jsx("th",{scope:"col",children:s("Quantity")}),t.jsxs("th",{scope:"col",children:[s("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:T.map((o,r)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:r+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(rt,{option:G,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:e.piechart},b.length)]})})};export{Tt as default};
