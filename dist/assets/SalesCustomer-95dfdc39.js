import{_ as re}from"./index-5e5c4b91.js";import{r as d,u as je,L as Ne,j as e,T as De,P as le,Q as ze,R as ie,U as T,i as ke,A as $e,B as Te,C as Be,E as Oe,G as Ee,a as R}from"./vendor-5be16ce1.js";import{k as Pe,l as Le,E as Ie,Q as j,a as ce,f as Ve,b as Ae}from"./NotoSansDevanagari-VariableFont_wdth_wght-34f5f1d4.js";const Re="_piechart_1fzch_11",We="_chartContainer_1fzch_23",He="_legendButtonContainer_1fzch_49",Me="_legendButton_1fzch_49",Ue="_codeBlockIcon_1fzch_133",Ge="_lightMode_1fzch_191",Ye="_dateFilter_1fzch_195",qe="_officefilter_1fzch_351",Qe="_topContainer_1fzch_443",Je="_darkMode_1fzch_463",Xe="_iconsContainer_1fzch_631",Ke="_icon_1fzch_631",Ze="_exportOptions_1fzch_715",et="_exportOption_1fzch_715",tt="_NoDataOverlay_1fzch_861",ot="_tableContainer_1fzch_993",at="_table_1fzch_993",nt="_summaryHeader_1fzch_1029",st="_periodHeader_1fzch_1037",rt="_closeButton_1fzch_1069",lt="_tableWrapper_1fzch_1099",it="_loadingOverlay_1fzch_1107",ct="_loadingSpinner_1fzch_1133",dt="_boldOption_1fzch_1145",ft="_optionGroup_1fzch_1155",l={piechart:Re,chartContainer:We,"legend-text":"_legend-text_1fzch_31",legendButtonContainer:He,legendButton:Me,codeBlockIcon:Ue,lightMode:Ge,"label-text":"_label-text_1fzch_191",dateFilter:Ye,officefilter:qe,topContainer:Qe,darkMode:Je,"theme-container":"_theme-container_1fzch_473",iconsContainer:Xe,icon:Ke,exportOptions:Ze,exportOption:et,NoDataOverlay:tt,tableContainer:ot,table:at,summaryHeader:nt,periodHeader:st,closeButton:rt,tableWrapper:lt,loadingOverlay:it,loadingSpinner:ct,boldOption:dt,optionGroup:ft},xt=({themeMode:f,selectedRange:y,selectedOffice:X,isAdmin:de,alldata:W,officeName:B,isLoading:K})=>{const[p,S]=d.useState([]),[H,O]=d.useState(!1),M=d.useRef(null),U=d.useRef(null),Z=d.useRef(null),{t:o}=je(),[ut,ee]=d.useState(!1),[G,C]=d.useState([]),[N,te]=d.useState(!1),[h,fe]=d.useState("Name"),[v,ue]=d.useState([]),[w,he]=d.useState([]),[F,pe]=d.useState([]),[Y,me]=d.useState(5);d.useEffect(()=>{const t=ae(y[0]),n=ae(y[1]);if(t&&n&&X&&W.graph4){const a=W.graph4,s=a.byName,r=a.byMobile,i=a.byVehicle;he(r),pe(i),ue(s)}},[y,X,de,W]);const ge={title:{textStyle:{color:f==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{data:[o("Visit"),o("Sales")],bottom:0,textStyle:{color:f==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:window.innerWidth<=768?"9%":"4%",right:"4%",top:"15%",bottom:"10%",containLabel:p.length>0},xAxis:[{type:"category",data:p.map(t=>t.filterName),axisPointer:{type:"shadow"},axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{color:f==="dark"?"#ffffff":"#000000",rotate:45,fontSize:11,formatter:t=>t.length>10?t.substring(0,10)+"...":t}}],yAxis:[{type:"value",name:o("Visit"),min:0,minInterval:1,axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{color:f==="dark"?"#ffffff":"#000000"}},{type:"value",name:o("Sales"),min:0,axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{color:f==="dark"?"#ffffff":"#000000",formatter:t=>t>=1e3?t/1e3+"k":t}}],series:[{name:o("Visit"),type:"bar",barWidth:"35%",data:p.map(t=>t.count),itemStyle:{normal:{barBorderRadius:[10,10,0,0]}}},{name:o("Sales"),type:"line",yAxisIndex:1,data:p.map(t=>t.total),markPoint:{data:p.map((t,n)=>({value:t.total>=1e3?parseInt(t.total/1e3)+"k":t.total,xAxis:n,yAxis:t.total}))}}]},oe=t=>{let n="";const a=new Uint8Array(t),s=a.byteLength;for(let r=0;r<s;r++)n+=String.fromCharCode(a[r]);return window.btoa(n)},E=t=>{if(!t)return"";const n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0");return`${String(t.getDate()).padStart(2,"0")}-${a}-${n}`},ae=t=>{if(!t)return"";const n=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${n}-${a}-${s}`},xe=async()=>{const t=j.loading("Please wait..."),n=E(y[0]),a=E(y[1]),s=await re(()=>import("./exceljs.min-fd769190.js").then(b=>b.e),["assets/exceljs.min-fd769190.js","assets/vendor-5be16ce1.js"]),r=new s.Workbook,i=r.addWorksheet("Data");fetch(ce).then(b=>b.blob()).then(async b=>{const D=new FileReader;D.onload=async function(){const q=D.result,z=r.addImage({base64:q,extension:"png"});i.addImage(z,{tl:{col:0,row:0},ext:{width:100,height:60}});const k=i.getCell("A1");k.value=`${o("Top Customers Summary Data")} (${B})`,k.font={bold:!0,color:{argb:"000000"},size:14},k.alignment={vertical:"middle",horizontal:"center"},i.mergeCells("A1:D1");const c=i.getCell("A2");c.value=`${o("Period")}: ${n} ${o("to")} ${a}`,c.font={bold:!0,color:{argb:"000000"},size:12},c.alignment={horizontal:"center"},i.mergeCells("A2:D2"),i.getColumn(1).width=15,i.getColumn(2).width=50,i.getColumn(3).width=15,i.getColumn(4).width=15;const P=i.addRow([o("#"),o(h),o("Visit"),o("Sales")]);P.font={bold:!0,color:{argb:"000000"},size:12},P.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),p.forEach((u,g)=>{const x=i.addRow([g+1,u.filterName,u.count,u.total]);x.getCell(1).alignment={horizontal:"left"},x.getCell(2).alignment={horizontal:"left"},x.getCell(3).alignment={horizontal:"right"},x.getCell(4).alignment={horizontal:"right"}});const $=i.addRow(["",o("Total"),"",""]);$.font={bold:!0,color:{argb:"000000"},size:12};const L=p.reduce((u,g)=>u+g.total,0),I=p.reduce((u,g)=>u+g.count,0),V=i.getCell(`C${$.number}`);V.value=`${I}`,V.alignment={horizontal:"right"};const A=i.getCell(`D${$.number}`);A.value=`₹ ${L.toFixed(2)}`,A.alignment={horizontal:"right"};const Q=`${Date.now()}Top_Customers_Summary_by${h}_${B}_${n}_${a}.xlsx`;r.xlsx.writeBuffer().then(async u=>{const g=new FormData;g.append("file",new Blob([u]),Q);try{const x=await R.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",g,{headers:{"Content-Type":"multipart/form-data"}});x.status==200?j.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):j.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const J=x.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${J}`}catch(x){console.error("Error saving Excel file:",x)}})},D.readAsDataURL(b)})},ye=async()=>{const t=j.loading("Please wait..."),n=E(y[0]),a=E(y[1]),r=new URLSearchParams(window.location.search).get("lang"),i=await R.get(Ve,{responseType:"arraybuffer"}),b=oe(i.data),D=await R.get(Ae,{responseType:"arraybuffer"}),q=oe(D.data);re(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-34f5f1d4.js").then(z=>z.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-34f5f1d4.js","assets/vendor-5be16ce1.js","assets/index-5e5c4b91.js","assets/index-a647bc22.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async z=>{let k=z.default;const c=new k;c.addFileToVFS("NotoSansBengali.ttf",b),c.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),c.setFont("NotoSansBengali"),c.addFileToVFS("NotoSansDevanagari.ttf",q),c.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),c.setFont("NotoSansDevanagari");const P=[[o("#"),o(h),o("Visit"),o("Sales")]],$={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},L={fontSize:12,fontStyle:"bold",halign:"center"},I={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},V=ce,A=35,ne=20;c.addImage(V,"PNG",15,12,A,ne);const Q=[[`${o("Top Customers Summary Data")} (${B})`]];c.autoTable({head:Q,body:[],headStyles:{...L,fillColor:I.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const u=[[`${o("Period")}: ${n} ${o("to")} ${a}`]];c.autoTable({startY:39.5,head:u,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let g=p.map((m,_)=>[_+1,m.filterName,`${m.count}`,`₹ ${parseFloat(m.total).toFixed(2)}`]);const x=p.reduce((m,_)=>m+_.total,0),J=p.reduce((m,_)=>m+_.count,0);g.push(["",o("Total"),J,`₹ ${x.toFixed(2)}`]);const ve={startY:c.autoTable.previous.finalY+1,head:P,body:g,headStyles:{...L,fillColor:I.secondHeader,textColor:"#FFFFFF"},columnStyles:$,styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};c.autoTable(ve);const we=`${Date.now()}Top_Customerss_Summary_by${h}_${B}_${n}_${a}.pdf`,Fe=c.output("blob"),se=new FormData;se.append("file",Fe,we);try{const m=await R.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",se,{headers:{"Content-Type":"multipart/form-data"}});m.status==200?j.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):j.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const _=await m.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${_}`}catch(m){console.error("Error saving PDF file:",m)}})};d.useEffect(()=>{const t=n=>{M.current&&!M.current.contains(n.target)&&U.current&&!U.current.contains(n.target)&&n.target.tagName!=="svg"&&n.target.tagName!=="path"&&O(!1),Z.current&&!Z.current.contains(n.target)&&ee(!1)};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const be=()=>{ee(!1),O(!H)};d.useEffect(()=>{Se(Y)},[h,Y,v,w,F]);const _e=t=>{fe(t.target.value)},Se=t=>{if(t===10)h==="Name"?(S(v),C([...v,{filterName:o("Total"),total:v.reduce((n,a)=>n+a.total,0),count:v.reduce((n,a)=>n+a.count,0)}])):h==="Mobile"?(S(w),C([...w,{filterName:o("Total"),total:w.reduce((n,a)=>n+a.total,0),count:w.reduce((n,a)=>n+a.count,0)}])):h==="Vehicle"&&(S(F),C([...F,{filterName:o("Total"),total:F.reduce((n,a)=>n+a.total,0),count:F.reduce((n,a)=>n+a.count,0)}]));else if(h==="Name"){let a=v.slice().reverse().slice(0,5).map(s=>s);S(a.slice().reverse()),C([...a.slice().reverse(),{filterName:o("Total"),total:a.slice().reverse().reduce((s,r)=>s+r.total,0),count:a.slice().reverse().reduce((s,r)=>s+r.count,0)}])}else if(h==="Mobile"){let a=w.slice().reverse().slice(0,5).map(s=>s);S(a.slice().reverse()),C([...a.slice().reverse(),{filterName:o("Total"),total:a.slice().reverse().reduce((s,r)=>s+r.total,0),count:a.slice().reverse().reduce((s,r)=>s+r.count,0)}])}else if(h==="Vehicle"){let a=F.slice().reverse().slice(0,5).map(s=>s);S(a.slice().reverse()),C([...a.slice().reverse(),{filterName:o("Total"),total:a.slice().reverse().reduce((s,r)=>s+r.total,0),count:a.slice().reverse().reduce((s,r)=>s+r.count,0)}])}},Ce=Ne({typography:{button:{textTransform:"none"}}});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`${l.chartContainer} ${f==="dark"?l.darkMode:l.lightMode}`,children:[e.jsx(Pe,{position:"top-center",theme:f}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"d-flex w-100 g-0 align-items-start justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`fw-bold me-2 fs-${window.innerWidth<=768?7:5} ${f==="dark"?l.darkMode:l.lightMode}`,children:o("")}),e.jsxs(De,{theme:Ce,children:[e.jsxs(le,{sx:{mx:1,mt:1,minWidth:120},size:"small",children:[e.jsx(ze,{id:"demo-simple-select-helper-label",style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},children:o("Top Customers")}),e.jsxs(ie,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:h,onChange:_e,style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},label:o("Top Customers"),children:[e.jsx(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Name",children:o("Name")}),e.jsx(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Mobile",children:o("Mobile")}),e.jsx(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Vehicle",children:o("Vehicle")})]})]}),e.jsx(le,{sx:{mx:1,mt:1,minWidth:100},size:"small",children:e.jsxs(ie,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:Y,style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},onChange:t=>{me(t.target.value)},children:[e.jsxs(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:5,children:[o("Top")," 5"]}),e.jsxs(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:10,children:[o("Top")," 10"]})]})})]})]}),e.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:M,children:e.jsxs("div",{className:`${l.iconsContainer} d-flex justify-content-center align-items-center`,children:[e.jsx("div",{className:`${l.icon} ${f==="dark"?l.darkMode:l.lightMode} px-2 py-1`,onClick:be,children:H?e.jsx(ke,{style:{fontSize:"1.1rem"}}):e.jsx($e,{style:{fontSize:"1.1rem"}})}),H&&e.jsxs("div",{className:`${l.exportOptions} ${f==="dark"?l.darkMode:l.lightMode}`,ref:U,children:[N?e.jsxs("div",{className:l.exportOption,onClick:()=>{te(!N),O(!1)},children:[e.jsx(Be,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),e.jsx("span",{children:o("View Graph")})]}):e.jsxs("div",{className:l.exportOption,onClick:()=>{te(!N),O(!1)},children:[e.jsx(Te,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),e.jsx("span",{children:o("View Table")})]}),e.jsxs("div",{className:l.exportOption,onClick:xe,children:[e.jsx(Oe,{style:{fontSize:"1.1rem",color:"green"}}),e.jsx("span",{children:o("Export to Excel")})]}),e.jsxs("div",{className:l.exportOption,onClick:ye,children:[e.jsx(Ee,{style:{fontSize:"1.1rem",color:"red"}}),e.jsx("span",{children:o("Export to PDF")})]})]})]})})]})}),K&&e.jsx("div",{className:l.NoDataOverlay,children:e.jsx("img",{src:Le,alt:"Loading...",width:50,height:50})}),G.length==1&&!N&&!K?e.jsx("div",{className:`${l.NoDataOverlay} fs-5`,children:o("No Data Found")}):"",N?e.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"333px"},children:e.jsxs("table",{className:`table  ${f=="dark"?"table-dark":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"#"}),e.jsx("th",{scope:"col",children:o(h)}),e.jsx("th",{scope:"col",children:o("Visit")}),e.jsxs("th",{scope:"col",children:[o("Sales"),"(₹)"]})]})}),e.jsx("tbody",{children:G.map((t,n)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:G.length-1===n?"":n+1}),e.jsx("td",{children:t.filterName}),e.jsx("td",{children:t.count}),e.jsx("td",{children:parseFloat(t.total).toFixed(2)})]},t.filterName))})]})}):e.jsx(Ie,{option:ge,style:{height:"341px",width:"100%",maxWidth:"2300px"},className:l.piechart},p.length)]})})};export{xt as default};
