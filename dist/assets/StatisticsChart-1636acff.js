import{_ as M}from"./index-02818364.js";import{r as g,u as le,y as ie,j as t,h as de,z as ce,A as pe,B as fe,C as he,E as xe,a as j}from"./vendor-257ea584.js";import{l as me,E as ge,a as Y,f as ue,b as ye}from"./NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js";const be="_chartContainer_1mphg_1",we="_lightMode_1mphg_47",Se="_dateFilter_1mphg_51",_e="_officefilter_1mphg_207",Fe="_topContainer_1mphg_299",De="_darkMode_1mphg_319",Ce="_iconsContainer_1mphg_487",ve="_icon_1mphg_487",Ee="_exportOptions_1mphg_571",je="_exportOption_1mphg_571",Ne="_tableContainer_1mphg_825",ke="_table_1mphg_825",$e="_summaryHeader_1mphg_861",Be="_periodHeader_1mphg_869",Ie="_closeButton_1mphg_901",Te="_tableWrapper_1mphg_931",Ae="_loadingOverlay_1mphg_939",Oe="_NoDataOverlay_1mphg_963",ze="_loadingSpinner_1mphg_991",Pe="_boldOption_1mphg_1003",We="_optionGroup_1mphg_1013",s={chartContainer:be,lightMode:we,"label-text":"_label-text_1mphg_47",dateFilter:Se,officefilter:_e,topContainer:Fe,darkMode:De,"theme-container":"_theme-container_1mphg_329",iconsContainer:Ce,icon:ve,exportOptions:Ee,exportOption:je,tableContainer:Ne,table:ke,summaryHeader:$e,periodHeader:Be,closeButton:Ie,tableWrapper:Te,loadingOverlay:Ae,NoDataOverlay:Oe,loadingSpinner:ze,boldOption:Pe,optionGroup:We},Ge=({selectedRange:f,themeMode:d,selectedOffice:I,isAdmin:J,alldata:L,isLoading:H})=>{const[h,X]=g.useState([]),[T,N]=g.useState(!1),A=g.useRef(null),O=g.useRef(null),[Z,K]=g.useState(!0),[q,Q]=g.useState([]),[F,G]=g.useState(!1),{t:a}=le();a("Date"),`${a("Sales")}`,`${a("Expense")}`,a("Rows"),g.useEffect(()=>{const e=w(f[0]),o=w(f[1]);e&&o&&I&&(()=>{const p=L;if(Array.isArray(p.graph1)){const n=p.graph1.map(l=>({requestedDate:l.requestedDate,sales:l.totalIncome,expense:l.totalExpense}));let S=n.filter(l=>l.sales!==0||l.expense!==0);const y=n.reduce((l,u)=>l+u.sales,0).toFixed(2),b=n.reduce((l,u)=>l+u.expense,0).toFixed(2);S.push({requestedDate:a("Total"),sales:y,expense:b}),Q(S),X(p.graph1)}})()},[f,I,J,L]);const V=(h.filter(e=>e.totalIncome>0).reduce((e,o)=>e+o.totalIncome,0)/h.filter(e=>e.totalIncome>0).length).toFixed(0);g.useEffect(()=>{if(f[0]&&f[1]){const e=new Date(f[0]),o=new Date(f[1]),c=ie(o,e)+1;K(c<=7)}},[f,I]);const ee={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:d==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",formatter:function(e){for(var o=`<b>${a("Date")}:</b> `+e[0].name+"<br/>",c=0;c<e.length;c++)o+="<b>"+e[c].seriesName+":</b> "+e[c].value+"<br/>";return o},textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:window.innerWidth>550?0:270,data:[a("Sales"),a("Expense"),a("Average Sales")],textStyle:{color:d==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:(window.innerWidth<=768,"4%"),right:"3%",top:"10%",bottom:h.length>0?"15%":"20%",containLabel:h.length>0},xAxis:{type:"category",name:window.innerWidth>550?a("Date"):"",nameLocation:"middle",nameGap:35,nameTextStyle:{color:d==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},boundaryGap:!0,data:h.map(e=>e.requestedDate),axisLine:{lineStyle:{color:d==="dark"?"#ffffff":"#000000"}},axisLabel:{color:d==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,nameTextStyle:{color:d==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},axisLine:{lineStyle:{color:d==="dark"?"#ffffff":"#000000"}},axisLabel:{color:d==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:d==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],dataZoom:[{show:!0,type:"inside",filterMode:"none",xAxisIndex:[0],startValue:new Date(f[0]),endValue:new Date(f[1])}],series:Z?[{name:a("Sales"),type:"bar",data:h.map(e=>e.totalIncome),yAxisIndex:0},{name:a("Expense"),type:"bar",data:h.map(e=>e.totalExpense),yAxisIndex:0},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:h.map(()=>V)}]:[{name:a("Sales"),type:"line",smooth:!0,data:h.map(e=>e.totalIncome),yAxisIndex:0},{name:a("Expense"),type:"line",smooth:!0,data:h.map(e=>e.totalExpense),yAxisIndex:0},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:h.map(()=>V)}]},R=e=>{let o="";const c=new Uint8Array(e),p=c.byteLength;for(let n=0;n<p;n++)o+=String.fromCharCode(c[n]);return window.btoa(o)},te=async()=>{const e=w(f[0]),o=w(f[1]),c=await M(()=>import("./exceljs.min-d3f5f5bd.js").then(b=>b.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),p=new c.Workbook,n=p.addWorksheet("Graph Data"),S=await j.get(Y,{responseType:"blob"}),y=new FileReader;y.onload=function(){const b=y.result,l=p.addImage({base64:b,extension:"png"});n.addImage(l,{tl:{col:0,row:0},ext:{width:100,height:60}});const u=n.getCell("A1");u.value=a("Sales-Expense Summary"),u.font={bold:!0,color:{argb:"000000"},size:14},u.alignment={vertical:"middle",horizontal:"center"},n.mergeCells("A1:C1");const i=n.getCell("A2");i.value=`${a("Period")}: ${e} ${a("to")} ${o}`,i.font={bold:!0,color:{argb:"000000"},size:12},i.alignment={horizontal:"center"},n.mergeCells("A2:C2"),n.getColumn(1).width=50,n.getColumn(2).width=15,n.getColumn(3).width=15;const k=n.addRow([a("Date"),a("Sales"),a("Expense")]);k.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},k.eachCell(r=>{r.font={bold:!0,color:{argb:"000000"},size:12},r.border={bottom:{style:"thin",color:{argb:"000000"}}}});const D=h.filter(r=>r.totalIncome!==0||r.totalExpense!==0);D.forEach(r=>{const m=n.addRow([r.requestedDate,Number(r.totalIncome),Number(r.totalExpense)]);m.getCell(2).numFmt="0.00",m.getCell(3).numFmt="0.00"});const C=n.addRow([a("Total"),"",""]);C.font={bold:!0,color:{argb:"000000"},size:12};const z=D.reduce((r,m)=>r+m.totalIncome,0),P=D.reduce((r,m)=>r+m.totalExpense,0),_=n.getCell(`B${C.number}`);_.value=`₹${z.toFixed(2)}`,_.alignment={horizontal:"right"};const v=n.getCell(`C${C.number}`);v.value=`₹${P.toFixed(2)}`,v.alignment={horizontal:"right"},p.xlsx.writeBuffer().then(async r=>{const m=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),$=new FormData;$.append("file",m,`${Date.now()}_sales-expense.xlsx`);try{const W=(await j.post("http://115.124.120.251:5064/api/uploader",$,{headers:{"Content-Type":"multipart/form-data"}})).data.url;window.location.replace(`http://115.124.120.251:5064/static/${W}`)}catch(B){console.error("Error saving Excel file:",B)}})},y.readAsDataURL(S.data)},ae=async()=>{const e=w(f[0]),o=w(f[1]),p=new URLSearchParams(window.location.search).get("lang"),n=await j.get(ue,{responseType:"arraybuffer"}),S=R(n.data),y=await j.get(ye,{responseType:"arraybuffer"}),b=R(y.data);M(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js").then(l=>l.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js","assets/vendor-257ea584.js","assets/index-02818364.js","assets/index-4da97eed.css"]).then(async l=>{let u=l.default;const i=new u;i.setFontSize(12),i.addFileToVFS("NotoSansBengali.ttf",S),i.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),i.setFont("NotoSansBengali"),i.addFileToVFS("NotoSansDevanagari.ttf",b),i.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),i.setFont("NotoSansDevanagari");const k=Y,D=35,C=20;i.addImage(k,"PNG",15,9,D,C);const z=[[a("Sales-Expense Summary")]];i.autoTable({startY:27,head:z,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0},styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const P=[[`${a("Period")}: ${e} ${a("to")} ${o}`]];i.autoTable({startY:36,head:P,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const _=h.filter(x=>x.totalIncome!==0||x.totalExpense!==0),v=_.map(x=>[x.requestedDate,x.totalIncome.toFixed(2),x.totalExpense.toFixed(2)]),r=_.reduce((x,E)=>x+E.totalIncome,0),m=_.reduce((x,E)=>x+E.totalExpense,0);(r!==0||m!==0)&&v.push([a("Total"),`${r.toFixed(2)}`,`${m.toFixed(2)}`]);const $=[a("Date"),a("Sales"),a("Expense")],B={1:{halign:"right"},2:{halign:"right"}},W={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"};i.autoTable($,v,{startY:45,headStyles:W,columnStyles:B,styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const se=Date.now(),re=new Blob([i.output("blob")],{type:"application/pdf"}),U=new FormData;U.append("file",re,`${se}_sales-expense.pdf`);try{const E=await(await j.post("http://115.124.120.251:5064/api/uploader",U,{headers:{"Content-Type":"multipart/form-data"}})).data.url;window.location.replace(`http://115.124.120.251:5064/static/${E}`)}catch(x){console.error("Error saving PDF file:",x)}})};g.useEffect(()=>{const e=o=>{A.current&&!A.current.contains(o.target)&&O.current&&!O.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&N(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const oe=()=>{N(!T)},w=e=>{if(!e)return"";const o=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${o}-${c}-${p}`},ne=()=>{G(!F),N(!1)};return t.jsxs("div",{className:`${s.chartContainer} ${d==="dark"?s.darkMode:s.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${d==="dark"?s.darkMode:s.lightMode}`,children:a("Sales-Expense")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:A,children:t.jsxs("div",{className:`${s.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${s.icon} ${d==="dark"?s.darkMode:s.lightMode} px-2 py-1`,onClick:oe,children:T?t.jsx(de,{style:{fontSize:"1.1rem"}}):t.jsx(ce,{style:{fontSize:"1.1rem"}})}),T&&t.jsxs("div",{className:`${s.exportOptions} ${d==="dark"?s.darkMode:s.lightMode}`,ref:O,children:[F?t.jsxs("div",{className:s.exportOption,onClick:()=>{G(!F),N(!1)},children:[t.jsx(fe,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:s.exportOption,onClick:ne,children:[t.jsx(pe,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:s.exportOption,onClick:te,children:[t.jsx(he,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:s.exportOption,onClick:ae,children:[t.jsx(xe,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),H&&t.jsx("div",{className:s.NoDataOverlay,children:t.jsx("img",{src:me,alt:"Loading...",width:50,height:50})}),q.length==1&&!F&&!H?t.jsx("div",{className:`${s.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",F?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table ${d=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:a("Date")}),t.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]}),t.jsxs("th",{scope:"col",children:[a("Expense"),"(₹)"]})]})}),t.jsx("tbody",{children:q.map((e,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:o+1}),t.jsx("td",{children:e.requestedDate}),t.jsx("td",{children:parseFloat(e.sales).toFixed(2)}),t.jsx("td",{children:parseFloat(e.expense).toFixed(2)})]},e.requestedDate))})]})}):t.jsx(ge,{option:ee,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:d==="dark"?s.darkMode:s.lightMode})]})};export{Ge as default};
