import{_ as I}from"./index-0c958aca.js";import{r as g,u as rt,j as t,h as lt,z as it,A as ct,J as dt,C as ht,E as ft,a as L}from"./vendor-257ea584.js";import{l as ut,E as pt,a as R,F as gt,f as _t,b as mt}from"./NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js";const xt="_piechart_1ah4s_11",bt="_chartContainer_1ah4s_23",yt="_legendButtonContainer_1ah4s_49",St="_legendButton_1ah4s_49",Ct="_codeBlockIcon_1ah4s_133",Nt="_lightMode_1ah4s_191",wt="_dateFilter_1ah4s_195",jt="_officefilter_1ah4s_351",Ft="_topContainer_1ah4s_443",vt="_darkMode_1ah4s_463",kt="_iconsContainer_1ah4s_631",Dt="_icon_1ah4s_631",Bt="_exportOptions_1ah4s_715",Ot="_exportOption_1ah4s_715",$t="_NoDataOverlay_1ah4s_861",Pt="_tableContainer_1ah4s_993",Et="_table_1ah4s_993",Tt="_summaryHeader_1ah4s_1029",zt="_periodHeader_1ah4s_1037",Wt="_closeButton_1ah4s_1069",Ht="_tableWrapper_1ah4s_1099",It="_loadingOverlay_1ah4s_1107",Lt="_loadingSpinner_1ah4s_1133",Rt="_boldOption_1ah4s_1145",At="_optionGroup_1ah4s_1155",n={piechart:xt,chartContainer:bt,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:yt,legendButton:St,codeBlockIcon:Ct,lightMode:Nt,"label-text":"_label-text_1ah4s_191",dateFilter:wt,officefilter:jt,topContainer:Ft,darkMode:vt,"theme-container":"_theme-container_1ah4s_473",iconsContainer:kt,icon:Dt,exportOptions:Bt,exportOption:Ot,NoDataOverlay:$t,tableContainer:Pt,table:Et,summaryHeader:Tt,periodHeader:zt,closeButton:Wt,tableWrapper:Ht,loadingOverlay:It,loadingSpinner:Lt,boldOption:Rt,optionGroup:At},Gt=({themeMode:_,selectedRange:m,selectedOffice:E,isAdmin:A,alldata:w,isLoading:T})=>{const[b,M]=g.useState([]),[j,Q]=g.useState([]),[F,y]=g.useState(!1),v=g.useRef(null),k=g.useRef(null),D=g.useRef(null),{t:e}=rt(),[B,O]=g.useState(!1),[z,V]=g.useState([]),[S,$]=g.useState(!1);function G(o){return o.flatMap(a=>a.lstproduct).reduce((a,r)=>{const{productName:c,totalSales:i,qty:f,color:d,unitShortName:p}=r;return i!==0&&(a[c]?(a[c].totalSales+=i,a[c].qty+=f):a[c]={totalSales:i,qty:f,color:d,unitShortName:p}),a},{})}g.useEffect(()=>{const o=x(m[0]),s=x(m[1]);if(o&&s&&E&&w.graph2){const h=G(w.graph2),a=Object.entries(h).map(([i,{totalSales:f,color:d}])=>({value:f,name:i,itemStyle:{color:d}}));Q(a);const r=Object.entries(h).map(([i,{totalSales:f,color:d,qty:p,unitShortName:l}])=>({productName:i,totalSale:f,color:d,totalQty:p,unit:l}));M(r);const c=Object.entries(h).map(([i,{totalSales:f,qty:d,unitShortName:p}])=>({ProductName:i,Sales:f,Quantity:`${d} ${p}`}));V(c)}},[m,E,A,w]);const U=()=>{b.length>0&&(O(!B),y(!1),$(!1))},Y={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${e("Total Sales")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:_==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:B,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"2%",style:{fill:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Sales",type:"pie",radius:["40%","65%"],center:["50%","50%"],selectedMode:"single",avoidLabelOverlap:!0,label:{show:j.length<=10,color:_==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:j.length>0?j:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},W=o=>{let s="";const h=new Uint8Array(o),a=h.byteLength;for(let r=0;r<a;r++)s+=String.fromCharCode(h[r]);return window.btoa(s)},q=async()=>{const o=x(m[0]),s=x(m[1]),h=await I(()=>import("./exceljs.min-d3f5f5bd.js").then(c=>c.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),a=new h.Workbook,r=a.addWorksheet("Data");fetch(R).then(c=>c.blob()).then(c=>{const i=new FileReader;i.onload=function(){const f=i.result,d=a.addImage({base64:f,extension:"png"});r.addImage(d,{tl:{col:0,row:0},ext:{width:100,height:70}});const p=r.getCell("A2");p.value=e("Product Wise Summary Data"),p.font={bold:!0,color:{argb:"000000"},size:14},p.alignment={vertical:"middle",horizontal:"center"},r.mergeCells("A2:C2");const l=r.getCell("A3");l.value=`${e("Period")}: ${o} ${e("to")} ${s}`,l.font={bold:!0,color:{argb:"000000"},size:12},l.alignment={horizontal:"center"},r.mergeCells("A3:C3"),r.getColumn(1).width=50,r.getColumn(2).width=15;const C=r.addRow([e("Product Name"),e("Quantity"),e("Total Sales")]);C.font={bold:!0,color:{argb:"000000"},size:12},C.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),b.forEach(u=>{r.addRow([u.productName,`${u.totalQty} ${u.unit}`,`₹${u.totalSale}`])});const P=`product_wise_summary_data_${Date.now()}.xlsx`;a.xlsx.writeBuffer().then(u=>{gt.saveAs(new Blob([u]),P)})},i.readAsDataURL(c)})},x=o=>{if(!o)return"";const s=o.getFullYear(),h=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${s}-${h}-${a}`},J=async()=>{const o=x(m[0]),s=x(m[1]),a=new URLSearchParams(window.location.search).get("lang"),r=await L.get(_t,{responseType:"arraybuffer"}),c=W(r.data),i=await L.get(mt,{responseType:"arraybuffer"}),f=W(i.data);I(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js").then(d=>d.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js","assets/vendor-257ea584.js","assets/index-0c958aca.js","assets/index-4da97eed.css"]).then(d=>{let p=d.default;const l=new p;l.addFileToVFS("NotoSansBengali.ttf",c),l.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),l.setFont("NotoSansBengali"),l.addFileToVFS("NotoSansDevanagari.ttf",f),l.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),l.setFont("NotoSansDevanagari");const C=[[e("Product Name"),e("Quantity"),e("Total Sale")]],P={1:{halign:"right"},2:{halign:"right"}},u={fontSize:12,fontStyle:"bold",halign:"center"},H={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},K=R,Z=35,tt=20;l.addImage(K,"PNG",15,12,Z,tt);const et=[[e("Product Wise Summary Data")]];l.autoTable({head:et,body:[],headStyles:{...u,fillColor:H.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const ot=[[`${e("Period")}: ${o} ${e("to")} ${s}`]];l.autoTable({startY:39.5,head:ot,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const at=b.map(N=>[N.productName,`${N.totalQty} ${N.unit}`,N.totalSale.toFixed(2)]),nt={startY:l.autoTable.previous.finalY+1,head:C,body:at,headStyles:{...u,fillColor:H.secondHeader,textColor:"#FFFFFF"},columnStyles:P,styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};l.autoTable(nt);const st=`product_wise_summary_data_${Date.now()}.pdf`;l.save(st)})};g.useEffect(()=>{const o=s=>{v.current&&!v.current.contains(s.target)&&k.current&&!k.current.contains(s.target)&&s.target.tagName!=="svg"&&s.target.tagName!=="path"&&y(!1),D.current&&!D.current.contains(s.target)&&O(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const X=()=>{O(!1),y(!F)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${n.chartContainer} ${_==="dark"?n.darkMode:n.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:n.legendButton,onClick:U,ref:D,children:[t.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:n.codeBlockIcon,title:"Legends",style:{filter:B||b.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${_==="dark"?n.darkMode:n.lightMode}`,children:e("Product Volume")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:v,children:t.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${n.icon} ${_==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:X,children:F?t.jsx(lt,{style:{fontSize:"1.1rem"}}):t.jsx(it,{style:{fontSize:"1.1rem"}})}),F&&t.jsxs("div",{className:`${n.exportOptions} ${_==="dark"?n.darkMode:n.lightMode}`,ref:k,children:[S?t.jsxs("div",{className:n.exportOption,onClick:()=>{$(!S),y(!1)},children:[t.jsx(dt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:n.exportOption,onClick:()=>{$(!S),y(!1)},children:[t.jsx(ct,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:n.exportOption,onClick:q,children:[t.jsx(ht,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:n.exportOption,onClick:J,children:[t.jsx(ft,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),T&&t.jsx("div",{className:n.NoDataOverlay,children:t.jsx("img",{src:ut,alt:"Loading...",width:50,height:50})}),z.length==0&&!S&&!T?t.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",S?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${_=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:z.map((o,s)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:s+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(pt,{option:Y,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:n.piechart},b.length)]})})};export{Gt as default};
