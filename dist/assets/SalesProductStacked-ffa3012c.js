import{_ as re}from"./index-4d89e49a.js";import{r as u,u as Ne,M as Oe,j as a,T as ke,Q as $e,R as Be,U as Me,V,i as We,B as Te,C as Pe,E as Le,G as Ee,H as qe,a as E}from"./vendor-d2d59fe7.js";import{R as ze}from"./index-ac977246.js";import{k as Ie,l as Ae,Q as O,a as ie,f as Re,b as Ye}from"./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js";const He="_piechart_wa0ri_11",Ge="_chartContainer_wa0ri_23",Ue="_legendButtonContainer_wa0ri_49",Ve="_legendButton_wa0ri_49",Je="_codeBlockIcon_wa0ri_133",Qe="_lightMode_wa0ri_191",Xe="_dateFilter_wa0ri_195",Ke="_officefilter_wa0ri_351",Ze="_topContainer_wa0ri_443",et="_darkMode_wa0ri_463",tt="_iconsContainer_wa0ri_631",at="_icon_wa0ri_631",ot="_exportOptions_wa0ri_715",st="_exportOption_wa0ri_715",nt="_NoDataOverlay_wa0ri_861",lt="_tableContainer_wa0ri_993",rt="_table_wa0ri_993",it="_summaryHeader_wa0ri_1029",ct="_periodHeader_wa0ri_1037",dt="_closeButton_wa0ri_1069",ut="_tableWrapper_wa0ri_1099",pt="_loadingOverlay_wa0ri_1107",ht="_loadingSpinner_wa0ri_1133",ft="_boldOption_wa0ri_1145",mt="_optionGroup_wa0ri_1155",c={piechart:He,chartContainer:Ge,"legend-text":"_legend-text_wa0ri_31",legendButtonContainer:Ue,legendButton:Ve,codeBlockIcon:Je,lightMode:Qe,"label-text":"_label-text_wa0ri_191",dateFilter:Xe,officefilter:Ke,topContainer:Ze,darkMode:et,"theme-container":"_theme-container_wa0ri_473",iconsContainer:tt,icon:at,exportOptions:ot,exportOption:st,NoDataOverlay:nt,tableContainer:lt,table:rt,summaryHeader:it,periodHeader:ct,closeButton:dt,tableWrapper:ut,loadingOverlay:pt,loadingSpinner:ht,boldOption:ft,optionGroup:mt},_t=({themeMode:x,selectedRange:W,selectedOffice:gt,isAdmin:St,alldata:q,officeName:T,isLoading:J,setSelectedRange:ce})=>{u.useState([]);const[z,k]=u.useState(!1),I=u.useRef(null),A=u.useRef(null),R=u.useRef(null),{t:n}=Ne(),[Y,H]=u.useState(!1),[j,D]=u.useState([]),[$,G]=u.useState(!1),[d,P]=u.useState("Sales (Day Wise)"),[Q,de]=u.useState([]),[X,ue]=u.useState([]),[K,pe]=u.useState([]),[he,fe]=u.useState([]),[Z,ee]=u.useState([]),[me,te]=u.useState([]),[ae,ge]=u.useState({}),[Se,oe]=u.useState(!0);u.useEffect(()=>{if(q.graph2){const o=q.graph2;oe(!0);let e={},h=[],b=Array.from(new Set(o.flatMap(t=>t.lstproduct.map(s=>s.productId)))),m=Array.from(new Set(o.map(t=>t.requestedDate.split("-"))));const p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(b.map(t=>{e[t]={productName:"",color:"",daySales:{},monthSales:{},yearSales:{}},m.map(s=>{e[t].yearSales[s[0]]="",e[t].monthSales[s[0]]=e[t].monthSales[s[0]]||{},e[t].monthSales[s[0]][p[parseInt(s[1])-1]]=""}),o.map(s=>{e[t].daySales[s.requestedDate]=""})}),o.map(t=>{h.push(t.requestedDate);const s=t.requestedDate;t.lstproduct.map(r=>{const S=r.color,l=r.productId,_=r.productName,B=r.totalSales;e[l].productName=_,e[l].color=S,e[l].daySales[s]=B;const[w,ne]=s.split("-"),M=new Date(s+"T00:00:00").toLocaleString("en-us",{month:"short"});e[l].monthSales[w]||(e[l].monthSales[w]={}),e[l].monthSales[w][M]||(e[l].monthSales[w][M]=0),e[l].monthSales[w][M]+=B,e[l].yearSales[w]||(e[l].yearSales[w]=0),e[l].yearSales[w]+=B})}),Object.values(e).length>0){let t=Object.keys(Object.values(e)[0].monthSales).flatMap(s=>Object.keys(Object.values(e)[0].monthSales[s]).map(f=>`${f} ${s}`));ee(t),t.length>1&&P("Sales (Month Wise)"),te(Object.keys(Object.values(e)[0].yearSales).map(s=>parseInt(s)))}else ee([]),te([]);ge(e),fe(h);const g=o.flatMap((t,s)=>t.lstproduct.map(f=>({requestedDate:F(t.requestedDate),totalSales:parseFloat(f.totalSales),productName:f.productName})));ue([...g,{requestedDate:"Total",productName:"",totalSales:g.reduce((t,s)=>t+s.totalSales,0)}]);let y=Object.values(e).map(t=>({monthSales:t.monthSales,productName:t.productName})).flatMap(t=>{const s=t.productName,f=Object.keys(t.monthSales)[0],r=t.monthSales[f];return Object.keys(r).map(S=>({requestedDate:`${S} ${f}`,totalSales:r[S],productName:s}))}).filter(t=>t.totalSales>0);y.sort((t,s)=>{const f=new Date(t.requestedDate),r=new Date(s.requestedDate);return f-r}),de([...y,{requestedDate:"Total",productName:"",totalSales:y.reduce((t,s)=>t+s.totalSales,0)}]);const i=Object.values(e).flatMap(t=>({requestedDate:Object.keys(t.yearSales)[0],productName:t.productName,totalSales:Object.values(t.yearSales)[0]})).filter(t=>t.totalSales>0);pe([...i,{requestedDate:"Total",productName:"",totalSales:i.reduce((t,s)=>t+s.totalSales,0)}]),d==="Sales (Day Wise)"?D([...g,{requestedDate:"Total",productName:"",totalSales:g.reduce((t,s)=>t+s.totalSales,0)}]):d==="Sales (Month Wise)"?D([...y,{requestedDate:"Total",productName:"",totalSales:y.reduce((t,s)=>t+s.totalSales,0)}]):d==="Sales (Year Wise)"&&D([...i,{requestedDate:"Total",productName:"",totalSales:i.reduce((t,s)=>t+s.totalSales,0)}])}},[q]);const ye={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"vertical",backgroundColor:x==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:Y,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:x==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},grid:{left:"3%",right:"4%",top:"10%",bottom:"3%",containLabel:!0},xAxis:{axisLabel:{hideOverlap:!0,formatter:d==="Sales (Day Wise)"?"{d} {MMM}":null,color:x==="dark"?"#ffffff":"#000000"},type:d==="Sales (Day Wise)"?"time":"category",axisPointer:{label:{formatter:function(o){if(d==="Sales (Day Wise)"){let e=new Date(o.value);return F(e)}else return o.value}}},data:d==="Sales (Day Wise)"?he:d==="Sales (Month Wise)"?Z:me},yAxis:{axisLabel:{color:x==="dark"?"#ffffff":"#000000"},formatter:o=>o>=1e4?o/1e3+"k":o,type:"value"},series:Object.values(ae).map(o=>({name:o.productName,type:"bar",stack:"total",barWidth:"40%",label:{show:!1},itemStyle:{borderRadius:[5,5,5,5],color:o.color},data:d==="Sales (Day Wise)"?Object.entries(o.daySales):d==="Sales (Month Wise)"?[].concat(...Object.values(o.monthSales).map(e=>Object.values(e))):Object.values(o.yearSales)}))},se=o=>{let e="";const h=new Uint8Array(o),b=h.byteLength;for(let m=0;m<b;m++)e+=String.fromCharCode(h[m]);return window.btoa(e)},F=o=>{if(!o)return"";let e=new Date(o);const h=e.getFullYear(),b=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${b}-${h}`},xe=async()=>{const o=O.loading("Please wait..."),e=F(W[0]),h=F(W[1]),b=await re(()=>import("./exceljs.min-e7e785f7.js").then(g=>g.e),["assets/exceljs.min-e7e785f7.js","assets/vendor-d2d59fe7.js"]),m=new b.Workbook,p=m.addWorksheet("Data");fetch(ie).then(g=>g.blob()).then(async g=>{const v=new FileReader;v.onload=async function(){const L=v.result,y=m.addImage({base64:L,extension:"png"});p.addImage(y,{tl:{col:0,row:0},ext:{width:100,height:60}});const N=p.getCell("A1");N.value=`${n("Products Summary Data")} (${T})`,N.font={bold:!0,color:{argb:"000000"},size:14},N.alignment={vertical:"middle",horizontal:"center"},p.mergeCells("A1:D1");const i=p.getCell("A2");i.value=`${n("Period")}: ${e} ${n("to")} ${h}`,i.font={bold:!0,color:{argb:"000000"},size:12},i.alignment={horizontal:"center"},p.mergeCells("A2:D2"),p.getColumn(1).width=15,p.getColumn(2).width=50,p.getColumn(3).width=15,p.getColumn(4).width=15;const t=p.addRow([n("#"),n("Dates"),n("Product Name"),n("Sales")]);t.font={bold:!0,color:{argb:"000000"},size:12},t.eachCell(r=>{r.font={bold:!0,color:{argb:"000000"},size:12},r.border={bottom:{style:"thin",color:{argb:"000000"}}}}),j.forEach((r,S)=>{if(S!==j.length-1){const l=p.addRow([S+1,r.requestedDate,r.productName,r.totalSales.toFixed(2)]);l.getCell(1).alignment={horizontal:"left"},l.getCell(2).alignment={horizontal:"left"},l.getCell(3).alignment={horizontal:"right"},l.getCell(4).alignment={horizontal:"right"}}else{const l=p.addRow(["",n("Total"),"",""]);l.font={bold:!0,color:{argb:"000000"},size:12};const _=p.getCell(`D${l.number}`);_.value=`₹ ${r.totalSales.toFixed(2)}`,_.alignment={horizontal:"right"}}});const f=`${Date.now()}Products_Summary_by${d}_${T}_${e}_${h}.xlsx`;m.xlsx.writeBuffer().then(async r=>{const S=new FormData;S.append("file",new Blob([r]),f);try{const l=await E.post("http://115.124.120.251:5064/api/uploader",S,{headers:{"Content-Type":"multipart/form-data"}});l.status==200?O.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):O.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const _=l.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${_}`}catch(l){console.error("Error saving Excel file:",l)}})},v.readAsDataURL(g)})},be=async()=>{const o=O.loading("Please wait..."),e=F(W[0]),h=F(W[1]),m=new URLSearchParams(window.location.search).get("lang"),p=await E.get(Re,{responseType:"arraybuffer"}),g=se(p.data),v=await E.get(Ye,{responseType:"arraybuffer"}),L=se(v.data);re(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js").then(y=>y.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-67bc695a.js","assets/vendor-d2d59fe7.js","assets/index-4d89e49a.js","assets/index-0090fde3.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async y=>{let N=y.default;const i=new N;i.addFileToVFS("NotoSansBengali.ttf",g),i.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),i.setFont("NotoSansBengali"),i.addFileToVFS("NotoSansDevanagari.ttf",L),i.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),i.setFont("NotoSansDevanagari");const t=[[n("#"),n("Dates"),n("Product Name"),n("Sales")]],s={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},f={fontSize:12,fontStyle:"bold",halign:"center"},r={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},S=ie,l=35,_=20;i.addImage(S,"PNG",15,12,l,_);const B=[[`${n("Products Summary Data")} (${T})`]];i.autoTable({head:B,body:[],headStyles:{...f,fillColor:r.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:m==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const w=[[`${n("Period")}: ${e} ${n("to")} ${h}`]];i.autoTable({startY:39.5,head:w,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:m==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let ne=j.map((C,U)=>[U+1,C.requestedDate,C.productName,`₹ ${C.totalSales.toFixed(2)}`]);const M={startY:i.autoTable.previous.finalY+1,head:t,body:ne,headStyles:{...f,fillColor:r.secondHeader,textColor:"#FFFFFF"},columnStyles:s,styles:{font:m==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};i.autoTable(M);const Fe=`${Date.now()}Products_Summary_by${d}_${T}_${e}_${h}.pdf`,ve=i.output("blob"),le=new FormData;le.append("file",ve,Fe);try{const C=await E.post("http://115.124.120.251:5064/api/uploader",le,{headers:{"Content-Type":"multipart/form-data"}});C.status==200?O.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):O.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const U=await C.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${U}`}catch(C){console.error("Error saving PDF file:",C)}})};u.useEffect(()=>{const o=e=>{I.current&&!I.current.contains(e.target)&&A.current&&!A.current.contains(e.target)&&e.target.tagName!=="svg"&&e.target.tagName!=="path"&&k(!1),R.current&&!R.current.contains(e.target)&&H(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const we=()=>{H(!1),k(!z),d==="Sales (Day Wise)"?D(X):d==="Sales (Month Wise)"?D(Q):d==="Sales (Year Wise)"&&D(K)},De=o=>{P(o.target.value),o.target.value==="Sales (Day Wise)"?D(X):o.target.value==="Sales (Month Wise)"?D(Q):o.target.value==="Sales (Year Wise)"&&D(K)},_e=o=>{if(o&&o.data&&o.dataIndex>=0){if(d==="Sales (Month Wise)"){const e=new Date(Z[o.dataIndex]),h=new Date(e.getFullYear(),e.getMonth(),1),b=new Date(e.getFullYear(),e.getMonth()+1,0);ce([h,b]),P("Sales (Day Wise)")}d==="Sales (Year Wise)"&&P("Sales (Month Wise)")}},Ce=Oe({typography:{button:{textTransform:"none"}}}),je=()=>{oe(!1),H(!Y),k(!1),G(!1)};return a.jsx(a.Fragment,{children:a.jsxs("div",{ref:R,className:`${c.chartContainer} ${x==="dark"?c.darkMode:c.lightMode}`,children:[a.jsx(Ie,{position:"top-center",theme:x}),a.jsx("div",{className:"container-fluid",children:a.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[a.jsxs("button",{className:c.legendButton,onClick:je,children:[a.jsx("img",{src:"https://def-pumps.inspirigenceworks.co.in/images/code-block.png",alt:"Code Block Icon",className:c.codeBlockIcon,title:"Legends",style:{filter:Y?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),a.jsxs("div",{className:"d-flex align-items-center",children:[a.jsx("div",{className:`fw-bold me-2 fs-${window.innerWidth<=768?7:5} ${x==="dark"?c.darkMode:c.lightMode}`,children:n("")}),a.jsx(ke,{theme:Ce,children:a.jsxs($e,{sx:{mx:1,mt:1,minWidth:190},size:"small",children:[a.jsx(Be,{id:"demo-simple-select-helper-label",style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},children:n("Product Wise")}),a.jsxs(Me,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:d,onChange:De,style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},label:n("Product Wise"),children:[a.jsx(V,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Sales (Day Wise)",children:n("Sales (Day Wise)")}),a.jsx(V,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Sales (Month Wise)",children:n("Sales (Month Wise)")}),a.jsx(V,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Sales (Year Wise)",children:n("Sales (Year Wise)")})]})]})})]}),a.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:I,children:a.jsxs("div",{className:`${c.iconsContainer} d-flex justify-content-center align-items-center`,children:[a.jsx("div",{className:`${c.icon} ${x==="dark"?c.darkMode:c.lightMode} px-2 py-1`,onClick:we,children:z?a.jsx(We,{style:{fontSize:"1.1rem"}}):a.jsx(Te,{style:{fontSize:"1.1rem"}})}),z&&a.jsxs("div",{className:`${c.exportOptions} ${x==="dark"?c.darkMode:c.lightMode}`,ref:A,children:[$?a.jsxs("div",{className:c.exportOption,onClick:()=>{G(!$),k(!1)},children:[a.jsx(Le,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),a.jsx("span",{children:n("View Graph")})]}):a.jsxs("div",{className:c.exportOption,onClick:()=>{G(!$),k(!1)},children:[a.jsx(Pe,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),a.jsx("span",{children:n("View Table")})]}),a.jsxs("div",{className:c.exportOption,onClick:xe,children:[a.jsx(Ee,{style:{fontSize:"1.1rem",color:"green"}}),a.jsx("span",{children:n("Export to Excel")})]}),a.jsxs("div",{className:c.exportOption,onClick:be,children:[a.jsx(qe,{style:{fontSize:"1.1rem",color:"red"}}),a.jsx("span",{children:n("Export to PDF")})]})]})]})})]})}),J&&a.jsx("div",{className:c.loadingOverlay,children:a.jsx("img",{src:Ae,alt:"Loading...",width:50,height:50})}),j.length==1&&!$&&!J?a.jsx("div",{className:`${c.NoDataOverlay} fs-5`,children:n("No Data Found")}):"",$?a.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"333px"},children:a.jsxs("table",{className:`table  ${x=="dark"?"table-dark":""}`,children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",children:"#"}),a.jsx("th",{scope:"col",children:n("Date")}),a.jsx("th",{scope:"col",children:n(d)}),a.jsxs("th",{scope:"col",children:[n("Sales"),"(₹)"]})]})}),a.jsx("tbody",{children:j.map((o,e)=>a.jsxs("tr",{children:[a.jsx("th",{scope:"row",children:j.length-1===e?"":e+1}),a.jsx("td",{children:o.requestedDate}),a.jsx("td",{children:o.productName}),a.jsx("td",{children:parseFloat(o.totalSales).toFixed(2)})]},`${o.requestedDate} ${o.productName}`))})]})}):a.jsx(ze,{option:ye,notMerge:Se,style:{height:"341px",width:"100%",maxWidth:"2300px"},className:c.piechart,onEvents:{click:_e}},ae.length)]})})};export{_t as default};
