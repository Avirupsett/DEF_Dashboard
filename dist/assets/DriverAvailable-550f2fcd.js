import{r as a,j as e,e as O,t as S,f as q,u as K}from"./vendor-d1a31163.js";import{r as m}from"./index-536690ae.js";import{F as L,a as M,c as V}from"./axios-d9b95618.js";import{a as X,B as Y}from"./Box-f65f2bf3.js";import{Q as R,k as Z}from"./react-toastify.esm-34a8b48c.js";import{T as ee}from"./ThemeProvider-68b9b4a4.js";import{F as se,S as te,M as T}from"./Select-006978da.js";import{I as ae}from"./InputLabel-0d786470.js";/* empty css                      */import"./extendSxProp-4fc022a8.js";import"./createSvgIcon-a8b447bb.js";import"./react-is.production.min-ec3da07b.js";import"./useTheme-55d19bd2.js";const re="_viewbutton_ynk9f_29",ne="_assignbutton_ynk9f_37",W={viewbutton:re,assignbutton:ne},ie=({data:x,setData:g,deliveryPlanId:n,updatedBy:w,token:b,deliveryPlanStatusId:d})=>{const[N,z]=a.useState("all"),[c,E]=a.useState(window.innerWidth),f=a.useMemo(()=>[{Header:"Driver Name",accessor:"driverName",Cell:({cell:s,row:t})=>e.jsxs("div",{className:"d-flex align-items-center",style:{textWrap:"nowrap"},children:[s.value," ",t.original.recommendation===!0&&n===3?e.jsx("div",{className:"p-2 py-1 d-flex align-items-center ms-1 noselect",style:{color:"#9333EA",backgroundColor:"transparent",borderRadius:"8px",letterSpacing:".5px",width:"fit-content"},children:" ⭐"}):e.jsx(e.Fragment,{})]})},{Header:"Contact No",accessor:"contactNumber"},{Header:"Lic. No",accessor:"licenceNo"},{Header:"Status",accessor:"assigned",Cell:({cell:s,row:t})=>s.value&&t.original.deliveryPlanId===n?e.jsxs("div",{className:"p-2 py-1 d-flex align-items-center",style:{color:"rgb(133 77 14 /1)",backgroundColor:" rgb(254 240 138/50%)",borderRadius:"8px",letterSpacing:".5px",width:"fit-content"},children:[e.jsx(L,{className:"me-1"})," Busy"]}):s.value?e.jsxs("div",{className:"p-2 py-1 d-flex align-items-center",style:{color:"rgb(133 77 14 /1)",backgroundColor:" rgb(254 240 138/50%)",borderRadius:"8px",letterSpacing:".5px",width:"fit-content"},children:[e.jsx(L,{className:"me-1"})," Busy"]}):e.jsxs("div",{className:"p-2 py-1 d-flex align-items-center",style:{color:"rgb(22 101 52/1)",backgroundColor:" rgb(187 247 208/50%)",borderRadius:"8px",letterSpacing:".5px",width:"fit-content"},children:[e.jsx(L,{className:"me-1"})," Available"]})},{Header:"Stats",id:"stats",Cell:({cell:s,row:t})=>e.jsxs("button",{className:`ps-2 pe-3 py-1 rounded-3 fs-6 btn ${W.viewbutton}`,style:{color:"#6366F1",border:"2px solid #6366F1"},onClick:()=>C(t.original.driverId,t.original.assigned,t.original.deliveryPlanId),children:[e.jsx(X,{className:"ms-1"}),c>950?" View":""]})},{Header:"Action",accessor:"assigned",id:"action",Cell:({cell:s,row:t})=>!s.value&&d===3?e.jsx("button",{className:`px-3 py-1 text-white rounded-3 fs-6 btn ${W.assignbutton}`,style:{backgroundColor:"#3B82F6"},onClick:()=>P(t.original.driverId),children:"Assign"}):t.original.deliveryPlanId==n?e.jsx("div",{className:"fs-5 fw-bold",style:{color:"#3B82F6"},children:"Assigned"}):e.jsx(e.Fragment,{})}],[]),h=O(),C=(s,t,D)=>{t&&D===n?h("/driverdashboardweb/"+s,{state:{isback:!0,statusId:d,token:b}}):h("/driverdashboardweb/"+s,{state:{isback:!0,statusId:d,token:b}})},P=async s=>{const t=R.loading("Assigning...");await M.post("https://dev-def-pumps-api.inspirigenceworks.co.in/api/DeliveryPlan/AssignDriver",{deliveryPlanId:n,driverId:s,updatedBy:w}).then(async D=>{let J=await(await x.map(o=>o.deliveryPlanId==n?{...o,assigned:!1,deliveryPlanId:null}:o)).map(o=>o.driverId===s?{...o,assigned:!0,deliveryPlanId:n}:o);g(J),R.update(t,{render:"Assigned Successfully",type:"success",isLoading:!1,autoClose:3500,closeOnClick:!0,pauseOnFocusLoss:!1})}).catch(D=>{R.update(t,{render:"Assigned Failed !",type:"error",isLoading:!1,autoClose:4e3,closeOnClick:!0,pauseOnFocusLoss:!1})})};a.useEffect(()=>{const s=()=>{E(window.innerWidth)};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]);const{getTableProps:k,getTableBodyProps:v,headerGroups:F,page:i,prepareRow:H,state:B,setGlobalFilter:I,gotoPage:y,nextPage:r,previousPage:p,canNextPage:u,canPreviousPage:l,pageOptions:A,pageCount:j,setPageSize:le,setFilter:_}=m.useTable({columns:f,data:x,initialState:{pageIndex:0,pageSize:5}},m.useFilters,m.useGlobalFilter,m.useSortBy,m.usePagination),{globalFilter:$,pageIndex:G,pageSize:oe}=B,Q=(s,t)=>{t==="all"?_("assigned",""):_("assigned",t)},U=V({});return e.jsxs("div",{className:"my-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("div",{className:"d-flex",children:e.jsx("input",{type:"text",className:"form-control ms-3 my-2 py-2",placeholder:"Search","aria-label":"Search",value:$||"",onChange:s=>I(s.target.value)})}),e.jsx("div",{className:"d-flex me-3 ms-2",children:e.jsx(ee,{theme:U,children:e.jsx(Y,{sx:{minWidth:120},children:e.jsxs(se,{sx:{mx:1,mt:1,minWidth:180},size:"small",children:[e.jsx(ae,{className:"px-1",id:"demo-simple-select-helper-label",style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important',backgroundColor:"white"},children:S("Status")}),e.jsxs(te,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:N,onChange:s=>{z(s.target.value),Q(i,s.target.value)},style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},selectprops:{MenuProps:{MenuListProps:{className:W.menu}}},children:[e.jsx(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"all",children:S("All")}),e.jsx(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"true",children:S("Busy")}),e.jsx(T,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"false",children:S("Available")})]})]})})})})]}),e.jsxs("div",{className:"rounded-3 mx-3 overflow-x-auto",style:{border:"2px solid #F4F4F5",boxShadow:"rgba(0, 0, 0, 0.075) 0.1rem 0.1rem 1rem 2px"},children:[e.jsxs("table",{...k(),style:{width:"100%"},children:[e.jsx("thead",{className:"",children:F.map(s=>e.jsx("tr",{style:{backgroundColor:"#239dab",textWrap:"nowrap",fontSize:c>500?"22px":"14px"},...s.getHeaderGroupProps(),children:s.headers.map(t=>e.jsxs("th",{className:"text-white px-2 py-2",style:{textWrap:"nowrap",fontSize:c>500?"22px":"14px"},...t.getHeaderProps(t.getSortByToggleProps()),children:[t.render("Header"),e.jsx("span",{children:t.isSorted?t.isSortedDesc?" ↑":" ↓":""})]}))}))}),e.jsx("tbody",{...v(),children:i.map(s=>(H(s),e.jsx("tr",{...s.getRowProps(),children:s.cells.map(t=>e.jsx("td",{className:"px-2 fs-6 py-2",...t.getCellProps(),children:t.render("Cell")}))})))})]}),i.length===0&&e.jsx("div",{className:"text-center py-3 fs-6",style:{color:"#4B5563"},children:"No Records found..."})]}),e.jsxs("div",{className:c>500?"mt-1 d-flex justify-content-between align-items-center flex-row":"mt-1 d-flex justify-content-center align-items-center flex-column",children:[e.jsxs("span",{className:"py-2 fs-6 mx-2 ms-3",children:["Page"," ",e.jsxs("strong",{children:[G+1," of ",A.length]})," "]}),e.jsx("div",{}),e.jsxs("div",{className:"py-2 d-flex justify-content-center fs-5 mx-2 me-3",children:[e.jsx("button",{className:"mx-1 px-2 py-1 text-white rounded-3",style:{backgroundColor:l?"#239dab":"rgb(193 201 211)"},onClick:()=>y(0),disabled:!l,children:"<<"})," ",e.jsxs("button",{className:"mx-1 px-2 py-1 pe-3 text-white rounded-3",style:{backgroundColor:l?"#239dab":"rgb(193 201 211)"},onClick:()=>p(),disabled:!l,children:["<"," Prev"]})," ",e.jsxs("button",{className:"mx-1 px-2 py-1 ps-3 text-white rounded-3",style:{backgroundColor:u?"#239dab":"rgb(193 201 211)"},onClick:()=>r(),disabled:!u,children:["Next ",">"]})," ",e.jsx("button",{className:"mx-1 px-2 py-1 text-white rounded-3",style:{backgroundColor:u?"#239dab":"rgb(193 201 211)"},onClick:()=>y(j-1),disabled:!u,children:">>"})," "]})]})]})};function we(){const[x,g]=a.useState([]),[n,w]=a.useState(0),[b,d]=a.useState(!0),[N,z]=a.useState(!1),[c,E]=a.useState("");a.useState(""),a.useState("");const[f,h]=a.useState("false"),C=O();q();const[P,k]=a.useState(""),[v,F]=a.useState([]),i=new URLSearchParams(window.location.search),{t:H,i18n:B}=K();function I(r){return atob(r)}const y=async()=>{try{B.changeLanguage(i.get("lang")||"en");let r="";const p=i.get("token"),u=i.get("tableview");if(h(u),p&&(r=JSON.parse(I(p))),r){const l=r.deliveryPlanId;if(k(r.updatedBy),w(l),l){let A=await M.get(`https://dev-def-dash-route-api.inspirigenceworks.co.in/api/v1/driver_available/${l}`);const{data:j}=A;g(j.driverAvailable),F(j.deliveryPlanStatus),d(!1)}}}catch(r){console.log(r),d(!1)}};return a.useEffect(()=>{y()},[]),e.jsx(e.Fragment,{children:b?e.jsx("div",{className:"my-3 d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"spinner-border text-primary ",role:"status",style:{}})}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{position:"top-center"}),N&&(f==="false"||f===null)?C(`/driverdashboardweb/${c}`,{state:{isback:!1,statusId:v[0].DeliveryPlanStatusId,token:i.get("token")}}):e.jsx(ie,{data:x,setData:g,deliveryPlanId:n,updatedBy:P,token:i.get("token"),deliveryPlanStatusId:v[0].DeliveryPlanStatusId})]})})}export{we as default};
