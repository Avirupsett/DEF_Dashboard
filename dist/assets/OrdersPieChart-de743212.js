import{_ as Q}from"./index-02818364.js";import{r as g,u as ct,j as t,h as dt,z as ht,A as ft,J as pt,C as ut,E as gt,a as v}from"./vendor-257ea584.js";import{l as mt,E as _t,a as V,f as xt,b as bt}from"./NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js";const yt="_piechart_1ah4s_11",St="_chartContainer_1ah4s_23",Ct="_legendButtonContainer_1ah4s_49",wt="_legendButton_1ah4s_49",Nt="_codeBlockIcon_1ah4s_133",Ft="_lightMode_1ah4s_191",jt="_dateFilter_1ah4s_195",vt="_officefilter_1ah4s_351",Dt="_topContainer_1ah4s_443",kt="_darkMode_1ah4s_463",$t="_iconsContainer_1ah4s_631",Bt="_icon_1ah4s_631",Ot="_exportOptions_1ah4s_715",Pt="_exportOption_1ah4s_715",Et="_NoDataOverlay_1ah4s_861",Tt="_tableContainer_1ah4s_993",zt="_table_1ah4s_993",It="_summaryHeader_1ah4s_1029",Wt="_periodHeader_1ah4s_1037",Ht="_closeButton_1ah4s_1069",Lt="_tableWrapper_1ah4s_1099",Rt="_loadingOverlay_1ah4s_1107",At="_loadingSpinner_1ah4s_1133",Mt="_boldOption_1ah4s_1145",Qt="_optionGroup_1ah4s_1155",n={piechart:yt,chartContainer:St,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:Ct,legendButton:wt,codeBlockIcon:Nt,lightMode:Ft,"label-text":"_label-text_1ah4s_191",dateFilter:jt,officefilter:vt,topContainer:Dt,darkMode:kt,"theme-container":"_theme-container_1ah4s_473",iconsContainer:$t,icon:Bt,exportOptions:Ot,exportOption:Pt,NoDataOverlay:Et,tableContainer:Tt,table:zt,summaryHeader:It,periodHeader:Wt,closeButton:Ht,tableWrapper:Lt,loadingOverlay:Rt,loadingSpinner:At,boldOption:Mt,optionGroup:Qt},Yt=({themeMode:m,selectedRange:_,selectedOffice:W,isAdmin:q,alldata:D,isLoading:H})=>{const[y,G]=g.useState([]),[k,U]=g.useState([]),[$,S]=g.useState(!1),B=g.useRef(null),O=g.useRef(null),P=g.useRef(null),{t:e}=ct(),[E,T]=g.useState(!1),[L,Y]=g.useState([]),[C,z]=g.useState(!1);function J(o){return o.flatMap(a=>a.lstproduct).reduce((a,r)=>{const{productName:c,totalSales:i,qty:f,color:d,unitShortName:u}=r;return i!==0&&(a[c]?(a[c].totalSales+=i,a[c].qty+=f):a[c]={totalSales:i,qty:f,color:d,unitShortName:u}),a},{})}g.useEffect(()=>{const o=b(_[0]),s=b(_[1]);if(o&&s&&W&&D.graph2){const h=J(D.graph2),a=Object.entries(h).map(([i,{totalSales:f,color:d}])=>({value:f,name:i,itemStyle:{color:d}}));U(a);const r=Object.entries(h).map(([i,{totalSales:f,color:d,qty:u,unitShortName:l}])=>({productName:i,totalSale:f,color:d,totalQty:u,unit:l}));G(r);const c=Object.entries(h).map(([i,{totalSales:f,qty:d,unitShortName:u}])=>({ProductName:i,Sales:f,Quantity:`${d} ${u}`}));Y(c)}},[_,W,q,D]);const X=()=>{y.length>0&&(T(!E),S(!1),z(!1))},K={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${e("Total Sales")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:m==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:E,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:m==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"2%",style:{fill:m==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Sales",type:"pie",radius:["40%","65%"],center:["50%","50%"],selectedMode:"single",avoidLabelOverlap:!0,label:{show:k.length<=10,color:m==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:k.length>0?k:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},R=o=>{let s="";const h=new Uint8Array(o),a=h.byteLength;for(let r=0;r<a;r++)s+=String.fromCharCode(h[r]);return window.btoa(s)},b=o=>{if(!o)return"";const s=o.getFullYear(),h=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${s}-${h}-${a}`},Z=async()=>{const o=b(_[0]),s=b(_[1]),h=await Q(()=>import("./exceljs.min-d3f5f5bd.js").then(c=>c.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),a=new h.Workbook,r=a.addWorksheet("Data");fetch(V).then(c=>c.blob()).then(async c=>{const i=new FileReader;i.onload=async function(){const f=i.result,d=a.addImage({base64:f,extension:"png"});r.addImage(d,{tl:{col:0,row:0},ext:{width:100,height:70}});const u=r.getCell("A2");u.value=e("Product Wise Summary Data"),u.font={bold:!0,color:{argb:"000000"},size:14},u.alignment={vertical:"middle",horizontal:"center"},r.mergeCells("A2:C2");const l=r.getCell("A3");l.value=`${e("Period")}: ${o} ${e("to")} ${s}`,l.font={bold:!0,color:{argb:"000000"},size:12},l.alignment={horizontal:"center"},r.mergeCells("A3:C3"),r.getColumn(1).width=50,r.getColumn(2).width=15;const w=r.addRow([e("Product Name"),e("Quantity"),e("Total Sales")]);w.font={bold:!0,color:{argb:"000000"},size:12},w.eachCell(p=>{p.font={bold:!0,color:{argb:"000000"},size:12},p.border={bottom:{style:"thin",color:{argb:"000000"}}}}),y.forEach(p=>{r.addRow([p.productName,`${p.totalQty} ${p.unit}`,`â‚¹${p.totalSale}`])});const N=`${Date.now()}_product_wise_summary_data.xlsx`;a.xlsx.writeBuffer().then(async p=>{const F=new FormData;F.append("file",new Blob([p]),N);try{const I=(await v.post("http://115.124.120.251:5064/api/uploader",F,{headers:{"Content-Type":"multipart/form-data"}})).data.url;window.location.replace(`http://115.124.120.251:5064/static/${I}`)}catch(j){console.error("Error saving Excel file:",j)}})},i.readAsDataURL(c)})},tt=async()=>{const o=b(_[0]),s=b(_[1]),a=new URLSearchParams(window.location.search).get("lang"),r=await v.get(xt,{responseType:"arraybuffer"}),c=R(r.data),i=await v.get(bt,{responseType:"arraybuffer"}),f=R(i.data);Q(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js").then(d=>d.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js","assets/vendor-257ea584.js","assets/index-02818364.js","assets/index-4da97eed.css"]).then(async d=>{let u=d.default;const l=new u;l.addFileToVFS("NotoSansBengali.ttf",c),l.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),l.setFont("NotoSansBengali"),l.addFileToVFS("NotoSansDevanagari.ttf",f),l.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),l.setFont("NotoSansDevanagari");const w=[[e("Product Name"),e("Quantity"),e("Total Sale")]],A={1:{halign:"right"},2:{halign:"right"}},N={fontSize:12,fontStyle:"bold",halign:"center"},p={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},F=V,j=35,I=20;l.addImage(F,"PNG",15,12,j,I);const ot=[[e("Product Wise Summary Data")]];l.autoTable({head:ot,body:[],headStyles:{...N,fillColor:p.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const at=[[`${e("Period")}: ${o} ${e("to")} ${s}`]];l.autoTable({startY:39.5,head:at,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const nt=y.map(x=>[x.productName,`${x.totalQty} ${x.unit}`,x.totalSale.toFixed(2)]),st={startY:l.autoTable.previous.finalY+1,head:w,body:nt,headStyles:{...N,fillColor:p.secondHeader,textColor:"#FFFFFF"},columnStyles:A,styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};l.autoTable(st);const rt=`${Date.now()}_product_wise_summary_data.pdf`,lt=l.output("blob"),M=new FormData;M.append("file",lt,rt);try{const it=await(await v.post("http://115.124.120.251:5064/api/uploader",M,{headers:{"Content-Type":"multipart/form-data"}})).data.url;window.location.replace(`http://115.124.120.251:5064/static/${it}`)}catch(x){console.error("Error saving PDF file:",x)}})};g.useEffect(()=>{const o=s=>{B.current&&!B.current.contains(s.target)&&O.current&&!O.current.contains(s.target)&&s.target.tagName!=="svg"&&s.target.tagName!=="path"&&S(!1),P.current&&!P.current.contains(s.target)&&T(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const et=()=>{T(!1),S(!$)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${n.chartContainer} ${m==="dark"?n.darkMode:n.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:n.legendButton,onClick:X,ref:P,children:[t.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:n.codeBlockIcon,title:"Legends",style:{filter:E||y.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${m==="dark"?n.darkMode:n.lightMode}`,children:e("Product Volume")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:B,children:t.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${n.icon} ${m==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:et,children:$?t.jsx(dt,{style:{fontSize:"1.1rem"}}):t.jsx(ht,{style:{fontSize:"1.1rem"}})}),$&&t.jsxs("div",{className:`${n.exportOptions} ${m==="dark"?n.darkMode:n.lightMode}`,ref:O,children:[C?t.jsxs("div",{className:n.exportOption,onClick:()=>{z(!C),S(!1)},children:[t.jsx(pt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:n.exportOption,onClick:()=>{z(!C),S(!1)},children:[t.jsx(ft,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:n.exportOption,onClick:Z,children:[t.jsx(ut,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:n.exportOption,onClick:tt,children:[t.jsx(gt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),H&&t.jsx("div",{className:n.NoDataOverlay,children:t.jsx("img",{src:mt,alt:"Loading...",width:50,height:50})}),L.length==0&&!C&&!H?t.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",C?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${m=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(â‚¹)"]})]})}),t.jsx("tbody",{children:L.map((o,s)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:s+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(_t,{option:K,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:n.piechart},y.length)]})})};export{Yt as default};
