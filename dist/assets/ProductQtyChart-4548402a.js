import{_ as I}from"./index-0c958aca.js";import{r as g,u as st,j as t,h as lt,z as it,A as ct,J as dt,C as ut,E as ft,a as L}from"./vendor-257ea584.js";import{l as ht,E as pt,a as R,F as gt,f as yt,b as _t}from"./NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js";const mt="_piechart_yc0ui_11",xt="_chartContainer_yc0ui_23",bt="_legendButtonContainer_yc0ui_49",St="_legendButton_yc0ui_49",Ct="_codeBlockIcon_yc0ui_133",Nt="_lightMode_yc0ui_191",wt="_dateFilter_yc0ui_195",jt="_officefilter_yc0ui_351",Ft="_topContainer_yc0ui_443",vt="_darkMode_yc0ui_463",kt="_iconsContainer_yc0ui_631",Dt="_icon_yc0ui_631",Bt="_exportOptions_yc0ui_715",Ot="_NoDataOverlay_yc0ui_741",$t="_exportOption_yc0ui_715",Pt="_tableContainer_yc0ui_999",Et="_table_yc0ui_999",Tt="_summaryHeader_yc0ui_1035",zt="_periodHeader_yc0ui_1043",Wt="_closeButton_yc0ui_1075",Ht="_tableWrapper_yc0ui_1105",It="_loadingOverlay_yc0ui_1113",Lt="_loadingSpinner_yc0ui_1139",Rt="_boldOption_yc0ui_1151",At="_optionGroup_yc0ui_1161",n={piechart:mt,chartContainer:xt,"legend-text":"_legend-text_yc0ui_31",legendButtonContainer:bt,legendButton:St,codeBlockIcon:Ct,lightMode:Nt,"label-text":"_label-text_yc0ui_191",dateFilter:wt,officefilter:jt,topContainer:Ft,darkMode:vt,"theme-container":"_theme-container_yc0ui_473",iconsContainer:kt,icon:Dt,exportOptions:Bt,NoDataOverlay:Ot,exportOption:$t,tableContainer:Pt,table:Et,summaryHeader:Tt,periodHeader:zt,closeButton:Wt,tableWrapper:Ht,loadingOverlay:It,loadingSpinner:Lt,boldOption:Rt,optionGroup:At},Vt=({themeMode:y,selectedRange:_,selectedOffice:E,isAdmin:A,alldata:w,isLoading:T})=>{const[x,Q]=g.useState([]),[j,b]=g.useState(!1),F=g.useRef(null),v=g.useRef(null),k=g.useRef(null),[D,B]=g.useState(!1),[z,M]=g.useState([]),[S,O]=g.useState(!1),[$,G]=g.useState([]),{t:e}=st();function V(o){return o.flatMap(a=>a.lstproduct).reduce((a,s)=>{const{productName:c,totalSales:i,qty:f,color:d,unitShortName:p}=s;return i!==0&&(a[c]?(a[c].totalSales+=i,a[c].qty+=f):a[c]={totalSales:i,qty:f,color:d,unitShortName:p}),a},{})}g.useEffect(()=>{const o=m(_[0]),r=m(_[1]);if(o&&r&&E&&w.graph2){const u=V(w.graph2),a=Object.entries(u).map(([i,{qty:f,color:d}])=>({value:f,name:i,itemStyle:{color:d}}));G(a);const s=Object.entries(u).map(([i,{totalSales:f,color:d,qty:p,unitShortName:l}])=>({productName:i,totalSale:f,color:d,totalQty:p,unit:l}));Q(s);const c=Object.entries(u).map(([i,{totalSales:f,qty:d,unitShortName:p}])=>({ProductName:i,Sales:f,Quantity:`${d} ${p}`}));M(c)}},[_,E,A,w]);const U=()=>{x.length>0&&B(!D),b(!1),O(!1)},Y={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${e("Total Qty")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:y==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:D,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:y==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"top",style:{fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Qty",type:"pie",radius:["35%","70%"],center:["50%","50%"],roseType:"radius",selectedMode:"single",avoidLabelOverlap:!0,label:{show:$.length<=10,color:y==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:$.length>0?$:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},W=o=>{let r="";const u=new Uint8Array(o),a=u.byteLength;for(let s=0;s<a;s++)r+=String.fromCharCode(u[s]);return window.btoa(r)},q=async()=>{const o=m(_[0]),r=m(_[1]),u=await I(()=>import("./exceljs.min-d3f5f5bd.js").then(c=>c.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),a=new u.Workbook,s=a.addWorksheet("Data");fetch(R).then(c=>c.blob()).then(c=>{const i=new FileReader;i.onload=function(){const f=i.result,d=a.addImage({base64:f,extension:"png"});s.addImage(d,{tl:{col:0,row:0},ext:{width:100,height:70}});const p=s.getCell("A2");p.value=e("Product Wise Summary Data"),p.font={bold:!0,color:{argb:"000000"},size:14},p.alignment={vertical:"middle",horizontal:"center"},s.mergeCells("A2:C2");const l=s.getCell("A3");l.value=`${e("Period")}: ${o} ${e("to")} ${r}`,l.font={bold:!0,color:{argb:"000000"},size:12},l.alignment={horizontal:"center"},s.mergeCells("A3:C3"),s.getColumn(1).width=50,s.getColumn(2).width=15;const C=s.addRow([e("Product Name"),e("Quantity"),e("Total Sales")]);C.font={bold:!0,color:{argb:"000000"},size:12},C.eachCell(h=>{h.font={bold:!0,color:{argb:"000000"},size:12},h.border={bottom:{style:"thin",color:{argb:"000000"}}}}),x.forEach(h=>{s.addRow([h.productName,`${h.totalQty} ${h.unit}`,`₹${h.totalSale}`])});const P=`product_wise_summary_data_${Date.now()}.xlsx`;a.xlsx.writeBuffer().then(h=>{gt.saveAs(new Blob([h]),P)})},i.readAsDataURL(c)})},m=o=>{if(!o)return"";const r=o.getFullYear(),u=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${r}-${u}-${a}`},J=async()=>{const o=m(_[0]),r=m(_[1]),a=new URLSearchParams(window.location.search).get("lang"),s=await L.get(yt,{responseType:"arraybuffer"}),c=W(s.data),i=await L.get(_t,{responseType:"arraybuffer"}),f=W(i.data);I(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js").then(d=>d.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js","assets/vendor-257ea584.js","assets/index-0c958aca.js","assets/index-4da97eed.css"]).then(d=>{let p=d.default;const l=new p;l.addFileToVFS("NotoSansBengali.ttf",c),l.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),l.setFont("NotoSansBengali"),l.addFileToVFS("NotoSansDevanagari.ttf",f),l.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),l.setFont("NotoSansDevanagari");const C=[[e("Product Name"),e("Quantity"),e("Total Sale")]],P={1:{halign:"right"},2:{halign:"right"}},h={fontSize:12,fontStyle:"bold",halign:"center"},H={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},K=R,Z=35,tt=20;l.addImage(K,"PNG",15,12,Z,tt);const et=[[e("Product Wise Summary Data")]];l.autoTable({head:et,body:[],headStyles:{...h,fillColor:H.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const ot=[[`${e("Period")}: ${o} ${e("to")} ${r}`]];l.autoTable({startY:39.5,head:ot,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const at=x.map(N=>[N.productName,`${N.totalQty} ${N.unit}`,N.totalSale.toFixed(2)]),nt={startY:l.autoTable.previous.finalY+1,head:C,body:at,headStyles:{...h,fillColor:H.secondHeader,textColor:"#FFFFFF"},columnStyles:P,styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};l.autoTable(nt);const rt=`product_wise_summary_data_${Date.now()}.pdf`;l.save(rt)})};g.useEffect(()=>{const o=r=>{F.current&&!F.current.contains(r.target)&&v.current&&!v.current.contains(r.target)&&r.target.tagName!=="svg"&&r.target.tagName!=="path"&&b(!1),k.current&&!k.current.contains(r.target)&&B(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const X=()=>{B(!1),b(!j)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${n.chartContainer} ${y==="dark"?n.darkMode:n.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:n.legendButton,onClick:U,ref:k,children:[t.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:n.codeBlockIcon,title:"Legends",style:{filter:D||x.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${y==="dark"?n.darkMode:n.lightMode}`,children:e("Product Quantity")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:F,children:t.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${n.icon} ${y==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:X,children:j?t.jsx(lt,{style:{fontSize:"1.1rem"}}):t.jsx(it,{style:{fontSize:"1.1rem"}})}),j&&t.jsxs("div",{className:`${n.exportOptions} ${y==="dark"?n.darkMode:n.lightMode}`,ref:v,children:[S?t.jsxs("div",{className:n.exportOption,onClick:()=>{O(!S),b(!1)},children:[t.jsx(dt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:n.exportOption,onClick:()=>{O(!S),b(!1)},children:[t.jsx(ct,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:n.exportOption,onClick:q,children:[t.jsx(ut,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:n.exportOption,onClick:J,children:[t.jsx(ft,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),T&&t.jsx("div",{className:n.NoDataOverlay,children:t.jsx("img",{src:ht,alt:"Loading...",width:50,height:50})}),z.length==0&&!S&&!T?t.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",S?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${y=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:z.map((o,r)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:r+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(pt,{option:Y,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:n.piechart},x.length)]})})};export{Vt as default};
