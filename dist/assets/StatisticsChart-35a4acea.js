import{_ as P}from"./index-b65a56b3.js";import{r as m,u as Z,y as ee,j as a,g as te,z as ae,A as oe,B as ne,C as se,E as re,l as H}from"./vendor-f9418046.js";import{L as le,a as ie,E as de,M as ce,F as pe}from"./index-82834b22.js";import{l as G}from"./logo-604665f9.js";const fe="_chartContainer_1mphg_1",he="_lightMode_1mphg_47",xe="_dateFilter_1mphg_51",me="_officefilter_1mphg_207",ge="_topContainer_1mphg_299",ue="_darkMode_1mphg_319",_e="_iconsContainer_1mphg_487",be="_icon_1mphg_487",ye="_exportOptions_1mphg_571",Se="_exportOption_1mphg_571",Ce="_tableContainer_1mphg_825",we="_table_1mphg_825",Fe="_summaryHeader_1mphg_861",De="_periodHeader_1mphg_869",ve="_closeButton_1mphg_901",ke="_tableWrapper_1mphg_931",Ee="_loadingOverlay_1mphg_939",je="_NoDataOverlay_1mphg_963",$e="_loadingSpinner_1mphg_991",Ne="_boldOption_1mphg_1003",Ae="_optionGroup_1mphg_1013",s={chartContainer:fe,lightMode:he,"label-text":"_label-text_1mphg_47",dateFilter:xe,officefilter:me,topContainer:ge,darkMode:ue,"theme-container":"_theme-container_1mphg_329",iconsContainer:_e,icon:be,exportOptions:ye,exportOption:Se,tableContainer:Ce,table:we,summaryHeader:Fe,periodHeader:De,closeButton:ve,tableWrapper:ke,loadingOverlay:Ee,NoDataOverlay:je,loadingSpinner:$e,boldOption:Ne,optionGroup:Ae},Le=({selectedRange:f,themeMode:d,selectedOffice:v,isAdmin:z})=>{const[c,R]=m.useState([]),[j,k]=m.useState(!1),$=m.useRef(null),N=m.useRef(null),[T,I]=m.useState(!0),[q,M]=m.useState(!0),[L,V]=m.useState([]),[w,W]=m.useState(!1),{t}=Z(),Y=[{name:"requestedDate",label:t("Date")},{name:"sales",label:`${t("Sales")}(₹)`},{name:"expense",label:`${t("Expense")}(₹)`}],U={selectableRowsHeader:!1,filter:!1,download:!1,print:!1,viewColumns:!1,search:!1,responsive:"standard",selectableRows:"none",rowsPerPage:10,rowsPerPageOptions:[10,25,50],tableBodyHeight:"228px",elevation:0,fixedHeader:!1,textLabels:{pagination:{rowsPerPage:t("Rows")}}};m.useEffect(()=>{const e=y(f[0]),n=y(f[1]);e&&n&&v&&(()=>{I(!0),H.get(`http://115.124.120.251:5059/api/Dashboard/DEFDashBoardGraphData/${e}/${n}/${v}/${z}`).then(h=>{const{data:o}=h;if(Array.isArray(o.graph1)){const g=o.graph1.map(l=>({requestedDate:l.requestedDate,sales:l.totalIncome,expense:l.totalExpense}));let u=g.filter(l=>l.sales!==0||l.expense!==0);const b=g.reduce((l,x)=>l+x.sales,0).toFixed(2),F=g.reduce((l,x)=>l+x.expense,0).toFixed(2);u.push({requestedDate:t("Total"),sales:b,expense:F}),V(u),R(g)}}).catch(h=>{console.log("Error fetching data:",h)}).finally(()=>{I(!1)})})()},[f,v,z]);const B=(c.filter(e=>e.sales>0).reduce((e,n)=>e+n.sales,0)/c.filter(e=>e.sales>0).length).toFixed(2);m.useEffect(()=>{if(f[0]&&f[1]){const e=new Date(f[0]),n=new Date(f[1]),i=ee(n,e)+1;M(i<=7)}},[f,v]);const J={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:d==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",formatter:function(e){for(var n=`<b>${t("Date")}:</b> `+e[0].name+"<br/>",i=0;i<e.length;i++)n+="<b>"+e[i].seriesName+":</b> "+e[i].value+"<br/>";return n},textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:window.innerWidth>550?0:270,data:[t("Sales"),t("Expense"),t("Average Sales")],textStyle:{color:d==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:window.innerWidth<=768?"7%":"4%",right:"3%",top:"10%",bottom:c.length>0?"15%":"20%",containLabel:c.length>0},xAxis:{type:"category",name:window.innerWidth>550?t("Date"):"",nameLocation:"middle",nameGap:35,nameTextStyle:{color:d==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},boundaryGap:!0,data:c.map(e=>e.requestedDate),axisLine:{lineStyle:{color:d==="dark"?"#ffffff":"#000000"}},axisLabel:{color:d==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,nameTextStyle:{color:d==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},axisLine:{lineStyle:{color:d==="dark"?"#ffffff":"#000000"}},axisLabel:{color:d==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:d==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],series:q?[{name:t("Sales"),type:"bar",data:c.map(e=>e.sales),yAxisIndex:0},{name:t("Expense"),type:"bar",data:c.map(e=>e.expense),yAxisIndex:0},{name:t("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:c.map(()=>B)}]:[{name:t("Sales"),type:"line",smooth:!0,data:c.map(e=>e.sales),yAxisIndex:0},{name:t("Expense"),type:"line",smooth:!0,data:c.map(e=>e.expense),yAxisIndex:0},{name:t("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:c.map(()=>B)}]},X=async()=>{const e=y(f[0]),n=y(f[1]),i=await P(()=>import("./exceljs.min-3ff9b368.js").then(b=>b.e),["assets/exceljs.min-3ff9b368.js","assets/vendor-f9418046.js"]),h=new i.Workbook,o=h.addWorksheet("Graph Data"),g=await H.get(G,{responseType:"blob"}),u=new FileReader;u.onload=function(){const b=u.result,F=h.addImage({base64:b,extension:"png"});o.addImage(F,{tl:{col:0,row:0},ext:{width:100,height:60}});const l=o.getCell("A1");l.value=t("Sales-Expense Summary"),l.font={bold:!0,color:{argb:"000000"},size:14},l.alignment={vertical:"middle",horizontal:"center"},o.mergeCells("A1:C1");const x=o.getCell("A2");x.value=`${t("Period")}: ${e} ${t("to")} ${n}`,x.font={bold:!0,color:{argb:"000000"},size:12},x.alignment={horizontal:"center"},o.mergeCells("A2:C2"),o.getColumn(1).width=50,o.getColumn(2).width=15,o.getColumn(3).width=15;const D=o.addRow([t("Date"),t("Sales"),t("Expense")]);D.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},D.eachCell(r=>{r.font={bold:!0,color:{argb:"000000"},size:12},r.border={bottom:{style:"thin",color:{argb:"000000"}}}});const S=c.filter(r=>r.sales!==0||r.expense!==0);S.forEach(r=>{const _=o.addRow([r.requestedDate,Number(r.sales),Number(r.expense)]);_.getCell(2).numFmt="0.00",_.getCell(3).numFmt="0.00"});const C=o.addRow([t("Total"),"",""]);C.font={bold:!0,color:{argb:"000000"},size:12};const A=S.reduce((r,_)=>r+_.sales,0),O=S.reduce((r,_)=>r+_.expense,0),E=o.getCell(`B${C.number}`);E.value=`₹${A.toFixed(2)}`,E.alignment={horizontal:"right"};const p=o.getCell(`C${C.number}`);p.value=`₹${O.toFixed(2)}`,p.alignment={horizontal:"right"},h.xlsx.writeBuffer().then(r=>{const _=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});pe.saveAs(_,"sales-expense.xlsx")})},u.readAsDataURL(g.data)},K=()=>{const e=y(f[0]),n=y(f[1]);P(()=>import("./index-82834b22.js").then(i=>i.j),["assets/index-82834b22.js","assets/vendor-f9418046.js","assets/index-b65a56b3.js","assets/index-4da97eed.css"]).then(i=>{let h=i.default;const o=new h;o.setFontSize(12);const g=G,u=35,b=20;o.addImage(g,"PNG",15,9,u,b);const F=[["Sales-Expense Summary"]];o.autoTable({startY:27,head:F,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0}});const l=[[`Period: ${e} to ${n}`]];o.autoTable({startY:36,head:l,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30}});const x=c.filter(p=>p.sales!==0||p.expense!==0),D=x.map(p=>[p.requestedDate,p.sales.toFixed(2),p.expense.toFixed(2)]),S=x.reduce((p,r)=>p+r.sales,0),C=x.reduce((p,r)=>p+r.expense,0);(S!==0||C!==0)&&D.push(["Total",`${S.toFixed(2)}`,`${C.toFixed(2)}`]);const A=["Date","Sales","Expense"],O={1:{halign:"right"},2:{halign:"right"}},E={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"};o.autoTable(A,D,{startY:45,headStyles:E,columnStyles:O}),o.save("sales-expense.pdf")})};m.useEffect(()=>{const e=n=>{$.current&&!$.current.contains(n.target)&&N.current&&!N.current.contains(n.target)&&n.target.tagName!=="svg"&&n.target.tagName!=="path"&&k(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const Q=()=>{k(!j)},y=e=>{if(!e)return"";const n=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),h=String(e.getDate()).padStart(2,"0");return`${n}-${i}-${h}`};return a.jsxs("div",{className:`${s.chartContainer} ${d==="dark"?s.darkMode:s.lightMode}`,children:[a.jsx("div",{className:"container-fluid",children:a.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[a.jsx("div",{className:`fw-bold fs-5 ${d==="dark"?s.darkMode:s.lightMode}`,children:t("Sales-Expense")}),a.jsx("div",{className:"d-flex g-0",ref:$,children:a.jsxs("div",{className:`${s.iconsContainer} d-flex justify-content-center align-items-center`,children:[a.jsx("div",{className:`${s.icon} ${d==="dark"?s.darkMode:s.lightMode} px-2 py-1`,onClick:Q,children:j?a.jsx(te,{style:{fontSize:"1.1rem"}}):a.jsx(ae,{style:{fontSize:"1.1rem"}})}),j&&a.jsxs("div",{className:`${s.exportOptions} ${d==="dark"?s.darkMode:s.lightMode}`,ref:N,children:[w?a.jsxs("div",{className:s.exportOption,onClick:()=>{W(!w),k(!1)},children:[a.jsx(ne,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),a.jsx("span",{children:t("View Graph")})]}):a.jsxs("div",{className:s.exportOption,onClick:()=>{W(!w),k(!1)},children:[a.jsx(oe,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),a.jsx("span",{children:t("View Table")})]}),a.jsxs("div",{className:s.exportOption,onClick:X,children:[a.jsx(se,{style:{fontSize:"1.1rem",color:"green"}}),a.jsx("span",{children:t("Export to Excel")})]}),a.jsxs("div",{className:s.exportOption,onClick:K,children:[a.jsx(re,{style:{fontSize:"1.1rem",color:"red"}}),a.jsx("span",{children:t("Export to PDF")})]})]})]})})]})}),T&&a.jsx("div",{className:s.NoDataOverlay,children:a.jsx(le,{animationData:ie,loop:!0})}),L.length==1&&!w&&!T?a.jsx("div",{className:`${s.NoDataOverlay} fs-5`,children:t("No Data Found")}):"",w?a.jsx("div",{className:"container-fluid mt-2",children:a.jsx(ce,{data:L,columns:Y,options:U})}):a.jsx(de,{option:J,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:d==="dark"?s.darkMode:s.lightMode})]})};export{Le as default};
