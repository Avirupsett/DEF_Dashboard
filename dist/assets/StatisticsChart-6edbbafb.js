import{_ as U}from"./index-0c958aca.js";import{r as g,u as ne,y as se,j as t,h as re,z as le,A as ie,B as de,C as ce,E as pe,a as $}from"./vendor-257ea584.js";import{l as fe,E as he,a as M,f as xe,b as me}from"./NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js";const ge="_chartContainer_1mphg_1",ue="_lightMode_1mphg_47",ye="_dateFilter_1mphg_51",be="_officefilter_1mphg_207",Se="_topContainer_1mphg_299",_e="_darkMode_1mphg_319",we="_iconsContainer_1mphg_487",Fe="_icon_1mphg_487",Ce="_exportOptions_1mphg_571",De="_exportOption_1mphg_571",ve="_tableContainer_1mphg_825",Ee="_table_1mphg_825",je="_summaryHeader_1mphg_861",Ne="_periodHeader_1mphg_869",ke="_closeButton_1mphg_901",$e="_tableWrapper_1mphg_931",Ie="_loadingOverlay_1mphg_939",Te="_NoDataOverlay_1mphg_963",Ae="_loadingSpinner_1mphg_991",Be="_boldOption_1mphg_1003",Oe="_optionGroup_1mphg_1013",s={chartContainer:ge,lightMode:ue,"label-text":"_label-text_1mphg_47",dateFilter:ye,officefilter:be,topContainer:Se,darkMode:_e,"theme-container":"_theme-container_1mphg_329",iconsContainer:we,icon:Fe,exportOptions:Ce,exportOption:De,tableContainer:ve,table:Ee,summaryHeader:je,periodHeader:Ne,closeButton:ke,tableWrapper:$e,loadingOverlay:Ie,NoDataOverlay:Te,loadingSpinner:Ae,boldOption:Be,optionGroup:Oe},Le=({selectedRange:f,themeMode:d,selectedOffice:I,isAdmin:Y,alldata:L,isLoading:H})=>{const[h,J]=g.useState([]),[T,E]=g.useState(!1),A=g.useRef(null),B=g.useRef(null),[X,Z]=g.useState(!0),[q,K]=g.useState([]),[F,G]=g.useState(!1),{t:a}=ne();a("Date"),`${a("Sales")}`,`${a("Expense")}`,a("Rows"),g.useEffect(()=>{const e=S(f[0]),o=S(f[1]);e&&o&&I&&(()=>{const p=L;if(Array.isArray(p.graph1)){const n=p.graph1.map(l=>({requestedDate:l.requestedDate,sales:l.totalIncome,expense:l.totalExpense}));let _=n.filter(l=>l.sales!==0||l.expense!==0);const y=n.reduce((l,u)=>l+u.sales,0).toFixed(2),b=n.reduce((l,u)=>l+u.expense,0).toFixed(2);_.push({requestedDate:a("Total"),sales:y,expense:b}),K(_),J(p.graph1)}})()},[f,I,Y,L]);const V=(h.filter(e=>e.totalIncome>0).reduce((e,o)=>e+o.totalIncome,0)/h.filter(e=>e.totalIncome>0).length).toFixed(0);g.useEffect(()=>{if(f[0]&&f[1]){const e=new Date(f[0]),o=new Date(f[1]),c=se(o,e)+1;Z(c<=7)}},[f,I]);const Q={color:["#66BA69","#E81A1A","#FFC107"],title:{textStyle:{color:d==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",formatter:function(e){for(var o=`<b>${a("Date")}:</b> `+e[0].name+"<br/>",c=0;c<e.length;c++)o+="<b>"+e[c].seriesName+":</b> "+e[c].value+"<br/>";return o},textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{top:window.innerWidth>550?0:270,data:[a("Sales"),a("Expense"),a("Average Sales")],textStyle:{color:d==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:window.innerWidth<=768?"7%":"4%",right:"3%",top:"10%",bottom:h.length>0?"15%":"20%",containLabel:h.length>0},xAxis:{type:"category",name:window.innerWidth>550?a("Date"):"",nameLocation:"middle",nameGap:35,nameTextStyle:{color:d==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},boundaryGap:!0,data:h.map(e=>e.requestedDate),axisLine:{lineStyle:{color:d==="dark"?"#ffffff":"#000000"}},axisLabel:{color:d==="dark"?"#ffffff":"#000000"}},yAxis:[{type:"value",name:(window.innerWidth>550,""),nameLocation:"middle",nameGap:42,nameTextStyle:{color:d==="dark"?"#ffffff":"#000000",fontWeight:"bold",fontSize:window.innerWidth<=768?14:16},axisLine:{lineStyle:{color:d==="dark"?"#ffffff":"#000000"}},axisLabel:{color:d==="dark"?"#ffffff":"#000000",formatter:e=>e>=1e4?e/1e3+"k":e},splitLine:{show:!0,lineStyle:{color:d==="dark"?"grey":"silver",type:"dashed"}}},{type:"value",show:!1},{type:"value",show:!1}],dataZoom:[{show:!0,type:"inside",filterMode:"none",xAxisIndex:[0],startValue:new Date(f[0]),endValue:new Date(f[1])}],series:X?[{name:a("Sales"),type:"bar",data:h.map(e=>e.totalIncome),yAxisIndex:0},{name:a("Expense"),type:"bar",data:h.map(e=>e.totalExpense),yAxisIndex:0},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:h.map(()=>V)}]:[{name:a("Sales"),type:"line",smooth:!0,data:h.map(e=>e.totalIncome),yAxisIndex:0},{name:a("Expense"),type:"line",smooth:!0,data:h.map(e=>e.totalExpense),yAxisIndex:0},{name:a("Average Sales"),type:"line",yAxisIndex:0,smooth:!0,lineStyle:{color:"#FFC107",width:2,type:"dashed"},data:h.map(()=>V)}]},R=e=>{let o="";const c=new Uint8Array(e),p=c.byteLength;for(let n=0;n<p;n++)o+=String.fromCharCode(c[n]);return window.btoa(o)},ee=async()=>{const e=S(f[0]),o=S(f[1]),c=await U(()=>import("./exceljs.min-d3f5f5bd.js").then(b=>b.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),p=new c.Workbook,n=p.addWorksheet("Graph Data"),_=await $.get(M,{responseType:"blob"}),y=new FileReader;y.onload=function(){const b=y.result,l=p.addImage({base64:b,extension:"png"});n.addImage(l,{tl:{col:0,row:0},ext:{width:100,height:60}});const u=n.getCell("A1");u.value=a("Sales-Expense Summary"),u.font={bold:!0,color:{argb:"000000"},size:14},u.alignment={vertical:"middle",horizontal:"center"},n.mergeCells("A1:C1");const i=n.getCell("A2");i.value=`${a("Period")}: ${e} ${a("to")} ${o}`,i.font={bold:!0,color:{argb:"000000"},size:12},i.alignment={horizontal:"center"},n.mergeCells("A2:C2"),n.getColumn(1).width=50,n.getColumn(2).width=15,n.getColumn(3).width=15;const j=n.addRow([a("Date"),a("Sales"),a("Expense")]);j.font={bold:!0,color:{argb:"000000"},size:12,underline:!0},j.eachCell(r=>{r.font={bold:!0,color:{argb:"000000"},size:12},r.border={bottom:{style:"thin",color:{argb:"000000"}}}});const C=h.filter(r=>r.totalIncome!==0||r.totalExpense!==0);C.forEach(r=>{const x=n.addRow([r.requestedDate,Number(r.totalIncome),Number(r.totalExpense)]);x.getCell(2).numFmt="0.00",x.getCell(3).numFmt="0.00"});const D=n.addRow([a("Total"),"",""]);D.font={bold:!0,color:{argb:"000000"},size:12};const O=C.reduce((r,x)=>r+x.totalIncome,0),z=C.reduce((r,x)=>r+x.totalExpense,0),w=n.getCell(`B${D.number}`);w.value=`₹${O.toFixed(2)}`,w.alignment={horizontal:"right"};const v=n.getCell(`C${D.number}`);v.value=`₹${z.toFixed(2)}`,v.alignment={horizontal:"right"},p.xlsx.writeBuffer().then(async r=>{const x=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),N=new FormData;N.append("file",x,`${Date.now()}_sales-expense.xlsx`);try{const P=(await $.post("http://115.124.120.251:5064/api/uploader",N,{headers:{"Content-Type":"multipart/form-data"}})).data.url;window.location.replace(`http://115.124.120.251:5064/static/${P}`)}catch(k){console.error("Error saving Excel file:",k)}})},y.readAsDataURL(_.data)},te=async()=>{const e=S(f[0]),o=S(f[1]),p=new URLSearchParams(window.location.search).get("lang"),n=await $.get(xe,{responseType:"arraybuffer"}),_=R(n.data),y=await $.get(me,{responseType:"arraybuffer"}),b=R(y.data);U(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js").then(l=>l.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-a4894ae6.js","assets/vendor-257ea584.js","assets/index-0c958aca.js","assets/index-4da97eed.css"]).then(l=>{let u=l.default;const i=new u;i.setFontSize(12),i.addFileToVFS("NotoSansBengali.ttf",_),i.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),i.setFont("NotoSansBengali"),i.addFileToVFS("NotoSansDevanagari.ttf",b),i.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),i.setFont("NotoSansDevanagari");const j=M,C=35,D=20;i.addImage(j,"PNG",15,9,C,D);const O=[[a("Sales-Expense Summary")]];i.autoTable({startY:27,head:O,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:20,bottom:0},styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const z=[[`${a("Period")}: ${e} ${a("to")} ${o}`]];i.autoTable({startY:36,head:z,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}});const w=h.filter(m=>m.totalIncome!==0||m.totalExpense!==0),v=w.map(m=>[m.requestedDate,m.totalIncome.toFixed(2),m.totalExpense.toFixed(2)]),r=w.reduce((m,W)=>m+W.totalIncome,0),x=w.reduce((m,W)=>m+W.totalExpense,0);(r!==0||x!==0)&&v.push([a("Total"),`${r.toFixed(2)}`,`${x.toFixed(2)}`]);const N=[a("Date"),a("Sales"),a("Expense")],k={1:{halign:"right"},2:{halign:"right"}},P={fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#75AAF0",textColor:"#FFFFFF"};i.autoTable(N,v,{startY:45,headStyles:P,columnStyles:k,styles:{font:p==="hi"?"NotoSansDevanagari":"NotoSansBengali"}}),i.save("sales-expense.pdf")})};g.useEffect(()=>{const e=o=>{A.current&&!A.current.contains(o.target)&&B.current&&!B.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&E(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const ae=()=>{E(!T)},S=e=>{if(!e)return"";const o=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${o}-${c}-${p}`},oe=()=>{G(!F),E(!1)};return t.jsxs("div",{className:`${s.chartContainer} ${d==="dark"?s.darkMode:s.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${d==="dark"?s.darkMode:s.lightMode}`,children:a("Sales-Expense")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:A,children:t.jsxs("div",{className:`${s.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${s.icon} ${d==="dark"?s.darkMode:s.lightMode} px-2 py-1`,onClick:ae,children:T?t.jsx(re,{style:{fontSize:"1.1rem"}}):t.jsx(le,{style:{fontSize:"1.1rem"}})}),T&&t.jsxs("div",{className:`${s.exportOptions} ${d==="dark"?s.darkMode:s.lightMode}`,ref:B,children:[F?t.jsxs("div",{className:s.exportOption,onClick:()=>{G(!F),E(!1)},children:[t.jsx(de,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:a("View Graph")})]}):t.jsxs("div",{className:s.exportOption,onClick:oe,children:[t.jsx(ie,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:a("View Table")})]}),t.jsxs("div",{className:s.exportOption,onClick:ee,children:[t.jsx(ce,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:a("Export to Excel")})]}),t.jsxs("div",{className:s.exportOption,onClick:te,children:[t.jsx(pe,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),H&&t.jsx("div",{className:s.NoDataOverlay,children:t.jsx("img",{src:fe,alt:"Loading...",width:50,height:50})}),q.length==1&&!F&&!H?t.jsx("div",{className:`${s.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",F?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table ${d=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:a("Date")}),t.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]}),t.jsxs("th",{scope:"col",children:[a("Expense"),"(₹)"]})]})}),t.jsx("tbody",{children:q.map((e,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:o+1}),t.jsx("td",{children:e.requestedDate}),t.jsx("td",{children:parseFloat(e.sales).toFixed(2)}),t.jsx("td",{children:parseFloat(e.expense).toFixed(2)})]},e.requestedDate))})]})}):t.jsx(he,{option:Q,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:d==="dark"?s.darkMode:s.lightMode})]})};export{Le as default};
