import{_ as M}from"./index-02818364.js";import{r as g,u as ct,j as t,h as dt,z as ut,A as pt,J as ft,C as ht,E as gt,a as v}from"./vendor-257ea584.js";import{l as yt,E as mt,a as q,f as _t,b as xt}from"./NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js";const bt="_piechart_yc0ui_11",St="_chartContainer_yc0ui_23",Ct="_legendButtonContainer_yc0ui_49",wt="_legendButton_yc0ui_49",Nt="_codeBlockIcon_yc0ui_133",Ft="_lightMode_yc0ui_191",jt="_dateFilter_yc0ui_195",vt="_officefilter_yc0ui_351",Dt="_topContainer_yc0ui_443",kt="_darkMode_yc0ui_463",$t="_iconsContainer_yc0ui_631",Bt="_icon_yc0ui_631",Ot="_exportOptions_yc0ui_715",Pt="_NoDataOverlay_yc0ui_741",Et="_exportOption_yc0ui_715",Tt="_tableContainer_yc0ui_999",zt="_table_yc0ui_999",It="_summaryHeader_yc0ui_1035",Wt="_periodHeader_yc0ui_1043",Ht="_closeButton_yc0ui_1075",Lt="_tableWrapper_yc0ui_1105",Rt="_loadingOverlay_yc0ui_1113",Qt="_loadingSpinner_yc0ui_1139",At="_boldOption_yc0ui_1151",Mt="_optionGroup_yc0ui_1161",n={piechart:bt,chartContainer:St,"legend-text":"_legend-text_yc0ui_31",legendButtonContainer:Ct,legendButton:wt,codeBlockIcon:Nt,lightMode:Ft,"label-text":"_label-text_yc0ui_191",dateFilter:jt,officefilter:vt,topContainer:Dt,darkMode:kt,"theme-container":"_theme-container_yc0ui_473",iconsContainer:$t,icon:Bt,exportOptions:Ot,NoDataOverlay:Pt,exportOption:Et,tableContainer:Tt,table:zt,summaryHeader:It,periodHeader:Wt,closeButton:Ht,tableWrapper:Lt,loadingOverlay:Rt,loadingSpinner:Qt,boldOption:At,optionGroup:Mt},Yt=({themeMode:y,selectedRange:m,selectedOffice:W,isAdmin:G,alldata:D,isLoading:H})=>{const[b,U]=g.useState([]),[k,S]=g.useState(!1),$=g.useRef(null),B=g.useRef(null),O=g.useRef(null),[P,E]=g.useState(!1),[L,V]=g.useState([]),[C,T]=g.useState(!1),[z,Y]=g.useState([]),{t:e}=ct();function J(o){return o.flatMap(a=>a.lstproduct).reduce((a,s)=>{const{productName:c,totalSales:i,qty:p,color:d,unitShortName:h}=s;return i!==0&&(a[c]?(a[c].totalSales+=i,a[c].qty+=p):a[c]={totalSales:i,qty:p,color:d,unitShortName:h}),a},{})}g.useEffect(()=>{const o=x(m[0]),r=x(m[1]);if(o&&r&&W&&D.graph2){const u=J(D.graph2),a=Object.entries(u).map(([i,{qty:p,color:d}])=>({value:p,name:i,itemStyle:{color:d}}));Y(a);const s=Object.entries(u).map(([i,{totalSales:p,color:d,qty:h,unitShortName:l}])=>({productName:i,totalSale:p,color:d,totalQty:h,unit:l}));U(s);const c=Object.entries(u).map(([i,{totalSales:p,qty:d,unitShortName:h}])=>({ProductName:i,Sales:p,Quantity:`${d} ${h}`}));V(c)}},[m,W,G,D]);const X=()=>{b.length>0&&E(!P),S(!1),T(!1)},K={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${e("Total Qty")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:y==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:P,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:y==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"top",style:{fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Qty",type:"pie",radius:["35%","70%"],center:["50%","50%"],roseType:"radius",selectedMode:"single",avoidLabelOverlap:!0,label:{show:z.length<=10,color:y==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:z.length>0?z:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},R=o=>{let r="";const u=new Uint8Array(o),a=u.byteLength;for(let s=0;s<a;s++)r+=String.fromCharCode(u[s]);return window.btoa(r)},x=o=>{if(!o)return"";const r=o.getFullYear(),u=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${r}-${u}-${a}`},Z=async()=>{const o=x(m[0]),r=x(m[1]),u=await M(()=>import("./exceljs.min-d3f5f5bd.js").then(c=>c.e),["assets/exceljs.min-d3f5f5bd.js","assets/vendor-257ea584.js"]),a=new u.Workbook,s=a.addWorksheet("Data");fetch(q).then(c=>c.blob()).then(async c=>{const i=new FileReader;i.onload=async function(){const p=i.result,d=a.addImage({base64:p,extension:"png"});s.addImage(d,{tl:{col:0,row:0},ext:{width:100,height:70}});const h=s.getCell("A2");h.value=e("Product Wise Summary Data"),h.font={bold:!0,color:{argb:"000000"},size:14},h.alignment={vertical:"middle",horizontal:"center"},s.mergeCells("A2:C2");const l=s.getCell("A3");l.value=`${e("Period")}: ${o} ${e("to")} ${r}`,l.font={bold:!0,color:{argb:"000000"},size:12},l.alignment={horizontal:"center"},s.mergeCells("A3:C3"),s.getColumn(1).width=50,s.getColumn(2).width=15;const w=s.addRow([e("Product Name"),e("Quantity"),e("Total Sales")]);w.font={bold:!0,color:{argb:"000000"},size:12},w.eachCell(f=>{f.font={bold:!0,color:{argb:"000000"},size:12},f.border={bottom:{style:"thin",color:{argb:"000000"}}}}),b.forEach(f=>{s.addRow([f.productName,`${f.totalQty} ${f.unit}`,`â‚¹${f.totalSale}`])});const N=`${Date.now()}_product_wise_summary_data.xlsx`;a.xlsx.writeBuffer().then(async f=>{const F=new FormData;F.append("file",new Blob([f]),N);try{const I=(await v.post("http://115.124.120.251:5064/api/uploader",F,{headers:{"Content-Type":"multipart/form-data"}})).data.url;window.location.replace(`http://115.124.120.251:5064/static/${I}`)}catch(j){console.error("Error saving Excel file:",j)}})},i.readAsDataURL(c)})},tt=async()=>{const o=x(m[0]),r=x(m[1]),a=new URLSearchParams(window.location.search).get("lang"),s=await v.get(_t,{responseType:"arraybuffer"}),c=R(s.data),i=await v.get(xt,{responseType:"arraybuffer"}),p=R(i.data);M(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js").then(d=>d.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-a10c3ce4.js","assets/vendor-257ea584.js","assets/index-02818364.js","assets/index-4da97eed.css"]).then(async d=>{let h=d.default;const l=new h;l.addFileToVFS("NotoSansBengali.ttf",c),l.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),l.setFont("NotoSansBengali"),l.addFileToVFS("NotoSansDevanagari.ttf",p),l.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),l.setFont("NotoSansDevanagari");const w=[[e("Product Name"),e("Quantity"),e("Total Sale")]],Q={1:{halign:"right"},2:{halign:"right"}},N={fontSize:12,fontStyle:"bold",halign:"center"},f={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},F=q,j=35,I=20;l.addImage(F,"PNG",15,12,j,I);const ot=[[e("Product Wise Summary Data")]];l.autoTable({head:ot,body:[],headStyles:{...N,fillColor:f.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const at=[[`${e("Period")}: ${o} ${e("to")} ${r}`]];l.autoTable({startY:39.5,head:at,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const nt=b.map(_=>[_.productName,`${_.totalQty} ${_.unit}`,_.totalSale.toFixed(2)]),rt={startY:l.autoTable.previous.finalY+1,head:w,body:nt,headStyles:{...N,fillColor:f.secondHeader,textColor:"#FFFFFF"},columnStyles:Q,styles:{font:a==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};l.autoTable(rt);const st=`${Date.now()}_product_wise_summary_data.pdf`,lt=l.output("blob"),A=new FormData;A.append("file",lt,st);try{const it=await(await v.post("http://115.124.120.251:5064/api/uploader",A,{headers:{"Content-Type":"multipart/form-data"}})).data.url;window.location.replace(`http://115.124.120.251:5064/static/${it}`)}catch(_){console.error("Error saving PDF file:",_)}})};g.useEffect(()=>{const o=r=>{$.current&&!$.current.contains(r.target)&&B.current&&!B.current.contains(r.target)&&r.target.tagName!=="svg"&&r.target.tagName!=="path"&&S(!1),O.current&&!O.current.contains(r.target)&&E(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const et=()=>{E(!1),S(!k)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${n.chartContainer} ${y==="dark"?n.darkMode:n.lightMode}`,children:[t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:n.legendButton,onClick:X,ref:O,children:[t.jsx("img",{src:"http://115.124.120.251:5007/images/code-block.png",alt:"Code Block Icon",className:n.codeBlockIcon,title:"Legends",style:{filter:P||b.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${y==="dark"?n.darkMode:n.lightMode}`,children:e("Product Quantity")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:$,children:t.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${n.icon} ${y==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:et,children:k?t.jsx(dt,{style:{fontSize:"1.1rem"}}):t.jsx(ut,{style:{fontSize:"1.1rem"}})}),k&&t.jsxs("div",{className:`${n.exportOptions} ${y==="dark"?n.darkMode:n.lightMode}`,ref:B,children:[C?t.jsxs("div",{className:n.exportOption,onClick:()=>{T(!C),S(!1)},children:[t.jsx(ft,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:n.exportOption,onClick:()=>{T(!C),S(!1)},children:[t.jsx(pt,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:n.exportOption,onClick:Z,children:[t.jsx(ht,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:n.exportOption,onClick:tt,children:[t.jsx(gt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),H&&t.jsx("div",{className:n.NoDataOverlay,children:t.jsx("img",{src:yt,alt:"Loading...",width:50,height:50})}),L.length==0&&!C&&!H?t.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",C?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${y=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(â‚¹)"]})]})}),t.jsx("tbody",{children:L.map((o,r)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:r+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(mt,{option:K,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:n.piechart},b.length)]})})};export{Yt as default};
