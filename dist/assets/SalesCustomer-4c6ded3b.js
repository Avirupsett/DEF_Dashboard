import{_ as le}from"./index-c9f7d2a4.js";import{r as c,u as je,a as B,L as Ne,j as e,T as De,P as ie,Q as $e,R as ce,U as O,i as ke,A as Te,B as Be,C as Oe,E as Ee,G as Le}from"./vendor-5be16ce1.js";import{k as Pe,l as ze,E as Ie,Q as j,a as de,f as Ve,b as Ae}from"./NotoSansDevanagari-VariableFont_wdth_wght-72e9d373.js";const We="_piechart_1ah4s_11",Re="_chartContainer_1ah4s_23",He="_legendButtonContainer_1ah4s_49",Me="_legendButton_1ah4s_49",Ue="_codeBlockIcon_1ah4s_133",Ge="_lightMode_1ah4s_191",Ye="_dateFilter_1ah4s_195",qe="_officefilter_1ah4s_351",Qe="_topContainer_1ah4s_443",Je="_darkMode_1ah4s_463",Xe="_iconsContainer_1ah4s_631",Ke="_icon_1ah4s_631",Ze="_exportOptions_1ah4s_715",et="_exportOption_1ah4s_715",tt="_NoDataOverlay_1ah4s_861",at="_tableContainer_1ah4s_993",ot="_table_1ah4s_993",st="_summaryHeader_1ah4s_1029",nt="_periodHeader_1ah4s_1037",rt="_closeButton_1ah4s_1069",lt="_tableWrapper_1ah4s_1099",it="_loadingOverlay_1ah4s_1107",ct="_loadingSpinner_1ah4s_1133",dt="_boldOption_1ah4s_1145",ft="_optionGroup_1ah4s_1155",l={piechart:We,chartContainer:Re,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:He,legendButton:Me,codeBlockIcon:Ue,lightMode:Ge,"label-text":"_label-text_1ah4s_191",dateFilter:Ye,officefilter:qe,topContainer:Qe,darkMode:Je,"theme-container":"_theme-container_1ah4s_473",iconsContainer:Xe,icon:Ke,exportOptions:Ze,exportOption:et,NoDataOverlay:tt,tableContainer:at,table:ot,summaryHeader:st,periodHeader:nt,closeButton:rt,tableWrapper:lt,loadingOverlay:it,loadingSpinner:ct,boldOption:dt,optionGroup:ft},xt=({themeMode:f,selectedRange:b,selectedOffice:R,isAdmin:X,officeName:E})=>{const[p,S]=c.useState([]),[H,L]=c.useState(!1),M=c.useRef(null),U=c.useRef(null),K=c.useRef(null),[Z,ee]=c.useState(!0),{t:a}=je(),[ut,te]=c.useState(!1),[G,C]=c.useState([]),[N,ae]=c.useState(!1),[h,fe]=c.useState("Name"),[v,ue]=c.useState([]),[w,he]=c.useState([]),[F,pe]=c.useState([]),[Y,me]=c.useState(window.innerWidth>500?10:5);c.useEffect(()=>{const t=se(b[0]),s=se(b[1]);t&&s&&R&&(ee(!0),B.get(`https://def-dash-route-api.inspirigenceworks.co.in/api/v1/dashboard/sales_customer/${t}/${s}/${R}/${X}`).then(o=>{const n=o.data,r=n.byName,i=n.byMobile,y=n.byVehicle;he(i),pe(y),ue(r)}).catch(o=>{console.log("Error fetching data:",o)}).finally(()=>{ee(!1)}))},[b,R,X]);const ge={title:{textStyle:{color:f==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?18:25}},tooltip:{trigger:"axis",textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{data:[a("Visit"),a("Sales")],bottom:0,textStyle:{color:f==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=768?10:12}},grid:{left:window.innerWidth<=768?"9%":"4%",right:"4%",top:"15%",bottom:"10%",containLabel:p.length>0},xAxis:[{type:"category",data:p.map(t=>t.filterName),axisPointer:{type:"shadow"},axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{color:f==="dark"?"#ffffff":"#000000",rotate:45,fontSize:11,formatter:t=>t.length>10?t.substring(0,10)+"...":t}}],yAxis:[{type:"value",name:a("Visit"),min:0,axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{color:f==="dark"?"#ffffff":"#000000"}},{type:"value",name:a("Sales"),min:0,axisLine:{lineStyle:{color:f==="dark"?"#ffffff":"#000000"}},axisLabel:{color:f==="dark"?"#ffffff":"#000000",formatter:t=>t>=1e3?t/1e3+"k":t}}],series:[{name:a("Visit"),type:"bar",barWidth:"35%",data:p.map(t=>t.count),itemStyle:{normal:{barBorderRadius:[10,10,0,0]}}},{name:a("Sales"),type:"line",yAxisIndex:1,data:p.map(t=>t.total),markPoint:{data:p.map((t,s)=>({value:t.total>=1e3?parseInt(t.total/1e3)+"k":t.total,xAxis:s,yAxis:t.total}))}}]},oe=t=>{let s="";const o=new Uint8Array(t),n=o.byteLength;for(let r=0;r<n;r++)s+=String.fromCharCode(o[r]);return window.btoa(s)},P=t=>{if(!t)return"";const s=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0");return`${String(t.getDate()).padStart(2,"0")}-${o}-${s}`},se=t=>{if(!t)return"";const s=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${s}-${o}-${n}`},xe=async()=>{const t=j.loading("Please wait..."),s=P(b[0]),o=P(b[1]),n=await le(()=>import("./exceljs.min-fd769190.js").then(y=>y.e),["assets/exceljs.min-fd769190.js","assets/vendor-5be16ce1.js"]),r=new n.Workbook,i=r.addWorksheet("Data");fetch(de).then(y=>y.blob()).then(async y=>{const D=new FileReader;D.onload=async function(){const q=D.result,$=r.addImage({base64:q,extension:"png"});i.addImage($,{tl:{col:0,row:0},ext:{width:100,height:60}});const k=i.getCell("A1");k.value=`${a("Top Customers Summary Data")} (${E})`,k.font={bold:!0,color:{argb:"000000"},size:14},k.alignment={vertical:"middle",horizontal:"center"},i.mergeCells("A1:D1");const d=i.getCell("A2");d.value=`${a("Period")}: ${s} ${a("to")} ${o}`,d.font={bold:!0,color:{argb:"000000"},size:12},d.alignment={horizontal:"center"},i.mergeCells("A2:D2"),i.getColumn(1).width=15,i.getColumn(2).width=50,i.getColumn(3).width=15,i.getColumn(4).width=15;const z=i.addRow([a("#"),a(h),a("Visit"),a("Sales")]);z.font={bold:!0,color:{argb:"000000"},size:12},z.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),p.forEach((u,g)=>{const x=i.addRow([g+1,u.filterName,u.count,u.total]);x.getCell(1).alignment={horizontal:"left"},x.getCell(2).alignment={horizontal:"left"},x.getCell(3).alignment={horizontal:"right"},x.getCell(4).alignment={horizontal:"right"}});const T=i.addRow(["",a("Total"),"",""]);T.font={bold:!0,color:{argb:"000000"},size:12};const I=p.reduce((u,g)=>u+g.total,0),V=p.reduce((u,g)=>u+g.count,0),A=i.getCell(`C${T.number}`);A.value=`${V}`,A.alignment={horizontal:"right"};const W=i.getCell(`D${T.number}`);W.value=`₹ ${I.toFixed(2)}`,W.alignment={horizontal:"right"};const Q=`${Date.now()}Top_Customers_Summary_by${h}_${E}_${s}_${o}.xlsx`;r.xlsx.writeBuffer().then(async u=>{const g=new FormData;g.append("file",new Blob([u]),Q);try{const x=await B.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",g,{headers:{"Content-Type":"multipart/form-data"}});x.status==200?j.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):j.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const J=x.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${J}`}catch(x){console.error("Error saving Excel file:",x)}})},D.readAsDataURL(y)})},ye=async()=>{const t=j.loading("Please wait..."),s=P(b[0]),o=P(b[1]),r=new URLSearchParams(window.location.search).get("lang"),i=await B.get(Ve,{responseType:"arraybuffer"}),y=oe(i.data),D=await B.get(Ae,{responseType:"arraybuffer"}),q=oe(D.data);le(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-72e9d373.js").then($=>$.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-72e9d373.js","assets/vendor-5be16ce1.js","assets/index-c9f7d2a4.js","assets/index-a647bc22.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async $=>{let k=$.default;const d=new k;d.addFileToVFS("NotoSansBengali.ttf",y),d.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),d.setFont("NotoSansBengali"),d.addFileToVFS("NotoSansDevanagari.ttf",q),d.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),d.setFont("NotoSansDevanagari");const z=[[a("#"),a(h),a("Visit"),a("Sales")]],T={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},I={fontSize:12,fontStyle:"bold",halign:"center"},V={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},A=de,W=35,ne=20;d.addImage(A,"PNG",15,12,W,ne);const Q=[[`${a("Top Customers Summary Data")} (${E})`]];d.autoTable({head:Q,body:[],headStyles:{...I,fillColor:V.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const u=[[`${a("Period")}: ${s} ${a("to")} ${o}`]];d.autoTable({startY:39.5,head:u,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let g=p.map((m,_)=>[_+1,m.filterName,`${m.count}`,`₹ ${parseFloat(m.total).toFixed(2)}`]);const x=p.reduce((m,_)=>m+_.total,0),J=p.reduce((m,_)=>m+_.count,0);g.push(["",a("Total"),J,`₹ ${x.toFixed(2)}`]);const ve={startY:d.autoTable.previous.finalY+1,head:z,body:g,headStyles:{...I,fillColor:V.secondHeader,textColor:"#FFFFFF"},columnStyles:T,styles:{font:r==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};d.autoTable(ve);const we=`${Date.now()}Top_Customerss_Summary_by${h}_${E}_${s}_${o}.pdf`,Fe=d.output("blob"),re=new FormData;re.append("file",Fe,we);try{const m=await B.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",re,{headers:{"Content-Type":"multipart/form-data"}});m.status==200?j.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):j.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const _=await m.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${_}`}catch(m){console.error("Error saving PDF file:",m)}})};c.useEffect(()=>{const t=s=>{M.current&&!M.current.contains(s.target)&&U.current&&!U.current.contains(s.target)&&s.target.tagName!=="svg"&&s.target.tagName!=="path"&&L(!1),K.current&&!K.current.contains(s.target)&&te(!1)};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const be=()=>{te(!1),L(!H)};c.useEffect(()=>{Se(Y)},[h,Y,v,w,F]);const _e=t=>{fe(t.target.value)},Se=t=>{if(t===10)h==="Name"?(S(v),C([...v,{filterName:a("Total"),total:v.reduce((s,o)=>s+o.total,0),count:v.reduce((s,o)=>s+o.count,0)}])):h==="Mobile"?(S(w),C([...w,{filterName:a("Total"),total:w.reduce((s,o)=>s+o.total,0),count:w.reduce((s,o)=>s+o.count,0)}])):h==="Vehicle"&&(S(F),C([...F,{filterName:a("Total"),total:F.reduce((s,o)=>s+o.total,0),count:F.reduce((s,o)=>s+o.count,0)}]));else if(h==="Name"){let o=v.slice().reverse().slice(0,5).map(n=>n);S(o.slice().reverse()),C([...o.slice().reverse(),{filterName:a("Total"),total:o.slice().reverse().reduce((n,r)=>n+r.total,0),count:o.slice().reverse().reduce((n,r)=>n+r.count,0)}])}else if(h==="Mobile"){let o=w.slice().reverse().slice(0,5).map(n=>n);S(o.slice().reverse()),C([...o.slice().reverse(),{filterName:a("Total"),total:o.slice().reverse().reduce((n,r)=>n+r.total,0),count:o.slice().reverse().reduce((n,r)=>n+r.count,0)}])}else if(h==="Vehicle"){let o=F.slice().reverse().slice(0,5).map(n=>n);S(o.slice().reverse()),C([...o.slice().reverse(),{filterName:a("Total"),total:o.slice().reverse().reduce((n,r)=>n+r.total,0),count:o.slice().reverse().reduce((n,r)=>n+r.count,0)}])}},Ce=Ne({typography:{button:{textTransform:"none"}}});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:`${l.chartContainer} ${f==="dark"?l.darkMode:l.lightMode}`,children:[e.jsx(Pe,{position:"top-center",theme:f}),e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"d-flex w-100 g-0 align-items-start justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`fw-bold me-2 fs-${window.innerWidth<=768?7:5} ${f==="dark"?l.darkMode:l.lightMode}`,children:a("")}),e.jsxs(De,{theme:Ce,children:[e.jsxs(ie,{sx:{mx:1,mt:1,minWidth:120},size:"small",children:[e.jsx($e,{id:"demo-simple-select-helper-label",style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},children:a("Top Customers")}),e.jsxs(ce,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:h,onChange:_e,style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},label:a("Top Customers"),children:[e.jsx(O,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Name",children:a("Name")}),e.jsx(O,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Mobile",children:a("Mobile")}),e.jsx(O,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Vehicle",children:a("Vehicle")})]})]}),e.jsx(ie,{sx:{mx:1,mt:1,minWidth:100},size:"small",children:e.jsxs(ce,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:Y,style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},onChange:t=>{me(t.target.value)},children:[e.jsxs(O,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:5,children:[a("Top")," 5"]}),e.jsxs(O,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:10,children:[a("Top")," 10"]})]})})]})]}),e.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:M,children:e.jsxs("div",{className:`${l.iconsContainer} d-flex justify-content-center align-items-center`,children:[e.jsx("div",{className:`${l.icon} ${f==="dark"?l.darkMode:l.lightMode} px-2 py-1`,onClick:be,children:H?e.jsx(ke,{style:{fontSize:"1.1rem"}}):e.jsx(Te,{style:{fontSize:"1.1rem"}})}),H&&e.jsxs("div",{className:`${l.exportOptions} ${f==="dark"?l.darkMode:l.lightMode}`,ref:U,children:[N?e.jsxs("div",{className:l.exportOption,onClick:()=>{ae(!N),L(!1)},children:[e.jsx(Oe,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),e.jsx("span",{children:a("View Graph")})]}):e.jsxs("div",{className:l.exportOption,onClick:()=>{ae(!N),L(!1)},children:[e.jsx(Be,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),e.jsx("span",{children:a("View Table")})]}),e.jsxs("div",{className:l.exportOption,onClick:xe,children:[e.jsx(Ee,{style:{fontSize:"1.1rem",color:"green"}}),e.jsx("span",{children:a("Export to Excel")})]}),e.jsxs("div",{className:l.exportOption,onClick:ye,children:[e.jsx(Le,{style:{fontSize:"1.1rem",color:"red"}}),e.jsx("span",{children:a("Export to PDF")})]})]})]})})]})}),Z&&e.jsx("div",{className:l.NoDataOverlay,children:e.jsx("img",{src:ze,alt:"Loading...",width:50,height:50})}),G.length==1&&!N&&!Z?e.jsx("div",{className:`${l.NoDataOverlay} fs-5`,children:a("No Data Found")}):"",N?e.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"333px"},children:e.jsxs("table",{className:`table  ${f=="dark"?"table-dark":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"#"}),e.jsx("th",{scope:"col",children:a(h)}),e.jsx("th",{scope:"col",children:a("Visit")}),e.jsxs("th",{scope:"col",children:[a("Sales"),"(₹)"]})]})}),e.jsx("tbody",{children:G.map((t,s)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:G.length-1===s?"":s+1}),e.jsx("td",{children:t.filterName}),e.jsx("td",{children:t.count}),e.jsx("td",{children:parseFloat(t.total).toFixed(2)})]},t.filterName))})]})}):e.jsx(Ie,{option:ge,style:{height:"341px",width:"100%",maxWidth:"2300px"},className:l.piechart},p.length)]})})};export{xt as default};
