import{_ as de}from"./index-3d8d8b63.js";import{r as g,u as Me,L as ke,j as o,T as Be,P as We,Q as Te,R as Pe,U as Q,i as Le,B as Ye,C as Ee,E as Ie,G as qe,H as ze,a as Y}from"./vendor-d27bb63f.js";import{L as Ae,R as He}from"./index-3570dccd.js";import{k as Ge,l as Ue,Q as O,a as ue,f as Re,b as Ve}from"./NotoSansDevanagari-VariableFont_wdth_wght-05058995.js";const Je="_piechart_wa0ri_11",Qe="_chartContainer_wa0ri_23",Xe="_legendButtonContainer_wa0ri_49",Ke="_legendButton_wa0ri_49",Ze="_codeBlockIcon_wa0ri_133",et="_lightMode_wa0ri_191",tt="_dateFilter_wa0ri_195",at="_officefilter_wa0ri_351",ot="_topContainer_wa0ri_443",st="_darkMode_wa0ri_463",nt="_iconsContainer_wa0ri_631",rt="_icon_wa0ri_631",lt="_exportOptions_wa0ri_715",it="_exportOption_wa0ri_715",ct="_NoDataOverlay_wa0ri_861",dt="_tableContainer_wa0ri_993",ut="_table_wa0ri_993",ht="_summaryHeader_wa0ri_1029",ft="_periodHeader_wa0ri_1037",pt="_closeButton_wa0ri_1069",gt="_tableWrapper_wa0ri_1099",mt="_loadingOverlay_wa0ri_1107",St="_loadingSpinner_wa0ri_1133",yt="_boldOption_wa0ri_1145",xt="_optionGroup_wa0ri_1155",h={piechart:Je,chartContainer:Qe,"legend-text":"_legend-text_wa0ri_31",legendButtonContainer:Xe,legendButton:Ke,codeBlockIcon:Ze,lightMode:et,"label-text":"_label-text_wa0ri_191",dateFilter:tt,officefilter:at,topContainer:ot,darkMode:st,"theme-container":"_theme-container_wa0ri_473",iconsContainer:nt,icon:rt,exportOptions:lt,exportOption:it,NoDataOverlay:ct,tableContainer:dt,table:ut,summaryHeader:ht,periodHeader:ft,closeButton:pt,tableWrapper:gt,loadingOverlay:mt,loadingSpinner:St,boldOption:yt,optionGroup:xt},$t=({themeMode:b,selectedRange:m,selectedOffice:Dt,isAdmin:bt,alldata:E,officeName:P,isLoading:X,setSelectedRange:I,isDateRangeActive:he,setIsDateRangeActive:K})=>{g.useState([]);const[q,M]=g.useState(!1),z=g.useRef(null),A=g.useRef(null),H=g.useRef(null),{t:i}=Me(),[G,U]=g.useState(!1),[$,_]=g.useState([]),[k,R]=g.useState(!1),[f,B]=g.useState("Sales (Day Wise)"),[Z,fe]=g.useState([]),[ee,pe]=g.useState([]),[te,ge]=g.useState([]),[me,Se]=g.useState([]),[V,ae]=g.useState([]),[ye,oe]=g.useState([]),[se,xe]=g.useState({}),[De,ne]=g.useState(!0);g.useEffect(()=>{if(E.graph2){const t=E.graph2;ne(!0);let e={},n=[],r=Array.from(new Set(t.flatMap(a=>a.lstproduct.map(s=>s.productId)))),l=Array.from(new Set(t.map(a=>a.requestedDate.split("-"))));const p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(r.map(a=>{e[a]={productName:"",color:"",daySales:{},monthSales:{},yearSales:{}},l.map(s=>{e[a].yearSales[s[0]]="",e[a].monthSales[s[0]]=e[a].monthSales[s[0]]||{},e[a].monthSales[s[0]][p[parseInt(s[1])-1]]=""}),t.map(s=>{e[a].daySales[s.requestedDate]=""})}),t.map(a=>{n.push(a.requestedDate);const s=a.requestedDate;a.lstproduct.map(d=>{const x=d.color,c=d.productId,F=d.productName,W=d.totalSales;e[c].productName=F,e[c].color=x,e[c].daySales[s]=Math.round(W*100)/100;const[w,ie]=s.split("-"),T=new Date(s+"T00:00:00").toLocaleString("en-us",{month:"short"});e[c].monthSales[w]||(e[c].monthSales[w]={}),e[c].monthSales[w][T]||(e[c].monthSales[w][T]=0),e[c].monthSales[w][T]+=Math.round(W*100)/100,e[c].yearSales[w]||(e[c].yearSales[w]=0),e[c].yearSales[w]+=Math.round(W*100)/100})}),Object.values(e).length>0){let a=Object.keys(Object.values(e)[0].yearSales).map(S=>parseInt(S)),s=Object.keys(Object.values(e)[0].monthSales).flatMap(S=>Object.keys(Object.values(e)[0].monthSales[S]).map(d=>`${d} ${S}`));ae(s),oe(a),a.length>1?B("Sales (Year Wise)"):s.length>1&&B("Sales (Month Wise)")}else ae([]),oe([]);xe(e),Se(n);const y=t.flatMap((a,s)=>a.lstproduct.map(S=>({requestedDate:v(a.requestedDate),totalSales:parseFloat(S.totalSales),productName:S.productName})));pe([...y,{requestedDate:"Total",productName:"",totalSales:y.reduce((a,s)=>a+s.totalSales,0)}]);let D=Object.values(e).map(a=>({monthSales:a.monthSales,productName:a.productName})).flatMap(a=>{const s=a.productName;return Object.keys(a.monthSales).flatMap(d=>Object.keys(a.monthSales[d]).map(x=>({requestedDate:`${x} ${d}`,totalSales:a.monthSales[d][x],productName:s})))}).filter(a=>a.totalSales>0);D.sort((a,s)=>{const S=new Date(a.requestedDate),d=new Date(s.requestedDate);return S-d}),fe([...D,{requestedDate:"Total",productName:"",totalSales:D.reduce((a,s)=>a+s.totalSales,0)}]);const u=Object.values(e).flatMap(a=>Object.entries(a.yearSales).map(s=>({requestedDate:s[0],productName:a.productName,totalSales:s[1]}))).filter(a=>a.totalSales>0);ge([...u,{requestedDate:"Total",productName:"",totalSales:u.reduce((a,s)=>a+s.totalSales,0)}]),f==="Sales (Day Wise)"?_([...y,{requestedDate:"Total",productName:"",totalSales:y.reduce((a,s)=>a+s.totalSales,0)}]):f==="Sales (Month Wise)"?_([...D,{requestedDate:"Total",productName:"",totalSales:D.reduce((a,s)=>a+s.totalSales,0)}]):f==="Sales (Year Wise)"&&_([...u,{requestedDate:"Total",productName:"",totalSales:u.reduce((a,s)=>a+s.totalSales,0)}])}},[E]);function re(t,e){var n=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),l=parseInt(t.substring(5,7),16);n=parseInt(n*(100+e)/100),r=parseInt(r*(100+e)/100),l=parseInt(l*(100+e)/100),n=n<255?n:255,r=r<255?r:255,l=l<255?l:255,n=Math.round(n),r=Math.round(r),l=Math.round(l);var p=n.toString(16).length==1?"0"+n.toString(16):n.toString(16),y=r.toString(16).length==1?"0"+r.toString(16):r.toString(16),C=l.toString(16).length==1?"0"+l.toString(16):l.toString(16);return"#"+p+y+C}const be={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"vertical",backgroundColor:b==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:G,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:b==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},grid:{left:"3%",right:"4%",top:"10%",bottom:"3%",containLabel:!0},xAxis:{axisLabel:{hideOverlap:!0,formatter:f==="Sales (Day Wise)"?"{d} {MMM}":null,color:b==="dark"?"#ffffff":"#000000"},type:f==="Sales (Day Wise)"?"time":"category",axisPointer:{label:{formatter:function(t){if(f==="Sales (Day Wise)"){let e=new Date(t.value);return v(e)}else return t.value}}},data:f==="Sales (Day Wise)"?me:f==="Sales (Month Wise)"?V:ye},yAxis:{axisLabel:{color:b==="dark"?"#ffffff":"#000000"},formatter:t=>t>=1e4?t/1e3+"k":t,type:"value"},series:Object.values(se).map(t=>({name:t.productName,type:"bar",stack:"total",barWidth:"40%",label:{show:!1},itemStyle:{borderRadius:[5,5,5,5],color:new Ae(0,1,0,0,[{offset:1,color:re(t.color,40)},{offset:0,color:re(t.color,80)}])},data:f==="Sales (Day Wise)"?Object.entries(t.daySales):f==="Sales (Month Wise)"?[].concat(...Object.values(t.monthSales).map(e=>Object.values(e))):Object.values(t.yearSales)}))},le=t=>{let e="";const n=new Uint8Array(t),r=n.byteLength;for(let l=0;l<r;l++)e+=String.fromCharCode(n[l]);return window.btoa(e)},v=t=>{if(!t)return"";let e=new Date(t);const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0");return`${String(e.getDate()).padStart(2,"0")}-${r}-${n}`},we=async()=>{const t=O.loading("Please wait..."),e=v(m[0]),n=v(m[1]),r=await de(()=>import("./exceljs.min-b41d4843.js").then(y=>y.e),["assets/exceljs.min-b41d4843.js","assets/vendor-d27bb63f.js"]),l=new r.Workbook,p=l.addWorksheet("Data");fetch(ue).then(y=>y.blob()).then(async y=>{const C=new FileReader;C.onload=async function(){const L=C.result,D=l.addImage({base64:L,extension:"png"});p.addImage(D,{tl:{col:0,row:0},ext:{width:100,height:60}});const N=p.getCell("A1");N.value=`${i("Products Summary Data")} (${P})`,N.font={bold:!0,color:{argb:"000000"},size:14},N.alignment={vertical:"middle",horizontal:"center"},p.mergeCells("A1:D1");const u=p.getCell("A2");u.value=`${i("Period")}: ${e} ${i("to")} ${n}`,u.font={bold:!0,color:{argb:"000000"},size:12},u.alignment={horizontal:"center"},p.mergeCells("A2:D2"),p.getColumn(1).width=15,p.getColumn(2).width=50,p.getColumn(3).width=15,p.getColumn(4).width=15;const a=p.addRow([i("#"),i("Dates"),i("Product Name"),i("Sales")]);a.font={bold:!0,color:{argb:"000000"},size:12},a.eachCell(d=>{d.font={bold:!0,color:{argb:"000000"},size:12},d.border={bottom:{style:"thin",color:{argb:"000000"}}}}),$.forEach((d,x)=>{if(x!==$.length-1){const c=p.addRow([x+1,d.requestedDate,d.productName,d.totalSales.toFixed(2)]);c.getCell(1).alignment={horizontal:"left"},c.getCell(2).alignment={horizontal:"left"},c.getCell(3).alignment={horizontal:"right"},c.getCell(4).alignment={horizontal:"right"}}else{const c=p.addRow(["",i("Total"),"",""]);c.font={bold:!0,color:{argb:"000000"},size:12};const F=p.getCell(`D${c.number}`);F.value=`₹ ${d.totalSales.toFixed(2)}`,F.alignment={horizontal:"right"}}});const S=`${Date.now()}Products_Summary_by${f}_${P}_${e}_${n}.xlsx`;l.xlsx.writeBuffer().then(async d=>{const x=new FormData;x.append("file",new Blob([d]),S);try{const c=await Y.post("http://115.124.120.251:5064/api/uploader",x,{headers:{"Content-Type":"multipart/form-data"}});c.status==200?O.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):O.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const F=c.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${F}`}catch(c){console.error("Error saving Excel file:",c)}})},C.readAsDataURL(y)})},_e=async()=>{const t=O.loading("Please wait..."),e=v(m[0]),n=v(m[1]),l=new URLSearchParams(window.location.search).get("lang"),p=await Y.get(Re,{responseType:"arraybuffer"}),y=le(p.data),C=await Y.get(Ve,{responseType:"arraybuffer"}),L=le(C.data);de(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-05058995.js").then(D=>D.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-05058995.js","assets/vendor-d27bb63f.js","assets/index-3d8d8b63.js","assets/index-0090fde3.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async D=>{let N=D.default;const u=new N;u.addFileToVFS("NotoSansBengali.ttf",y),u.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),u.setFont("NotoSansBengali"),u.addFileToVFS("NotoSansDevanagari.ttf",L),u.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),u.setFont("NotoSansDevanagari");const a=[[i("#"),i("Dates"),i("Product Name"),i("Sales")]],s={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},S={fontSize:12,fontStyle:"bold",halign:"center"},d={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},x=ue,c=35,F=20;u.addImage(x,"PNG",15,12,c,F);const W=[[`${i("Products Summary Data")} (${P})`]];u.autoTable({head:W,body:[],headStyles:{...S,fillColor:d.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const w=[[`${i("Period")}: ${e} ${i("to")} ${n}`]];u.autoTable({startY:39.5,head:w,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let ie=$.map((j,J)=>[J+1,j.requestedDate,j.productName,`₹ ${j.totalSales.toFixed(2)}`]);const T={startY:u.autoTable.previous.finalY+1,head:a,body:ie,headStyles:{...S,fillColor:d.secondHeader,textColor:"#FFFFFF"},columnStyles:s,styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};u.autoTable(T);const Ne=`${Date.now()}Products_Summary_by${f}_${P}_${e}_${n}.pdf`,Oe=u.output("blob"),ce=new FormData;ce.append("file",Oe,Ne);try{const j=await Y.post("http://115.124.120.251:5064/api/uploader",ce,{headers:{"Content-Type":"multipart/form-data"}});j.status==200?O.update(t,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):O.update(t,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const J=await j.data.url;window.location.href=`http://115.124.120.251:5064/static/downloads/${J}`}catch(j){console.error("Error saving PDF file:",j)}})};g.useEffect(()=>{const t=e=>{z.current&&!z.current.contains(e.target)&&A.current&&!A.current.contains(e.target)&&e.target.tagName!=="svg"&&e.target.tagName!=="path"&&M(!1),H.current&&!H.current.contains(e.target)&&U(!1)};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const Ce=()=>{U(!1),M(!q),f==="Sales (Day Wise)"?_(ee):f==="Sales (Month Wise)"?_(Z):f==="Sales (Year Wise)"&&_(te)},Fe=t=>{if(B(t.target.value),t.target.value==="Sales (Day Wise)")_(ee);else if(t.target.value==="Sales (Month Wise)"){if(_(Z),he===!1){const e=new Date(m[0]),n=new Date(m[1]),r=new Date(e.getFullYear(),0,1),l=new Date(n.getFullYear(),11,31);(`${m[0].getFullYear()}-${m[0].getMonth()+1}-${m[0].getDate()}`!=`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`||`${m[1].getFullYear()}-${m[1].getMonth()+1}-${m[1].getDate()}`!=`${l.getFullYear()}-${l.getMonth()+1}-${l.getDate()}`)&&I([r,l])}}else t.target.value==="Sales (Year Wise)"&&_(te)},je=t=>{if(t&&t.data&&t.dataIndex>=0){if(f==="Sales (Month Wise)"){const e=new Date(V[t.dataIndex]),n=new Date(e.getFullYear(),e.getMonth(),1);K(!1);const r=new Date(e.getFullYear(),e.getMonth()+1,0);I([n,r]),B("Sales (Day Wise)")}if(f==="Sales (Year Wise)"){K(!1),B("Sales (Month Wise)");const e=new Date(V[t.dataIndex]),n=new Date(e.getFullYear(),0,1),r=new Date(e.getFullYear()+1,0,0);(`${m[0].getFullYear()}-${m[0].getMonth()+1}-${m[0].getDate()}`!=`${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}`||`${m[1].getFullYear()}-${m[1].getMonth()+1}-${m[1].getDate()}`!=`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`)&&I([n,r])}}},$e=ke({typography:{button:{textTransform:"none"}}}),ve=()=>{ne(!1),U(!G),M(!1),R(!1)};return o.jsx(o.Fragment,{children:o.jsxs("div",{ref:H,className:`${h.chartContainer} ${b==="dark"?h.darkMode:h.lightMode}`,children:[o.jsx(Ge,{position:"top-center",theme:b}),o.jsx("div",{className:"container-fluid",children:o.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[o.jsxs("button",{className:h.legendButton,onClick:ve,children:[o.jsx("img",{src:"https://def-pumps.inspirigenceworks.co.in/images/code-block.png",alt:"Code Block Icon",className:h.codeBlockIcon,title:"Legends",style:{filter:G?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),o.jsxs("div",{className:"d-flex align-items-center",children:[o.jsx("div",{className:`fw-bold me-2 fs-${window.innerWidth<=768?7:5} ${b==="dark"?h.darkMode:h.lightMode}`,children:i("")}),o.jsx(Be,{theme:$e,children:o.jsxs(We,{sx:{mx:1,mt:1,minWidth:190},size:"small",children:[o.jsx(Te,{id:"demo-simple-select-helper-label",style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},children:i("Product Wise")}),o.jsxs(Pe,{labelId:"demo-simple-select-standard-label",id:"demo-simple-select-standard",displayEmpty:!0,value:f,onChange:Fe,style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},label:i("Product Wise"),children:[o.jsx(Q,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Sales (Day Wise)",children:i("Sales (Day Wise)")}),o.jsx(Q,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Sales (Month Wise)",children:i("Sales (Month Wise)")}),o.jsx(Q,{style:{color:"var(--text-color)",fontFamily:'"Public Sans", sans-serif !important'},value:"Sales (Year Wise)",children:i("Sales (Year Wise)")})]})]})})]}),o.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:z,children:o.jsxs("div",{className:`${h.iconsContainer} d-flex justify-content-center align-items-center`,children:[o.jsx("div",{className:`${h.icon} ${b==="dark"?h.darkMode:h.lightMode} px-2 py-1`,onClick:Ce,children:q?o.jsx(Le,{style:{fontSize:"1.1rem"}}):o.jsx(Ye,{style:{fontSize:"1.1rem"}})}),q&&o.jsxs("div",{className:`${h.exportOptions} ${b==="dark"?h.darkMode:h.lightMode}`,ref:A,children:[k?o.jsxs("div",{className:h.exportOption,onClick:()=>{R(!k),M(!1)},children:[o.jsx(Ie,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),o.jsx("span",{children:i("View Graph")})]}):o.jsxs("div",{className:h.exportOption,onClick:()=>{R(!k),M(!1)},children:[o.jsx(Ee,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),o.jsx("span",{children:i("View Table")})]}),o.jsxs("div",{className:h.exportOption,onClick:we,children:[o.jsx(qe,{style:{fontSize:"1.1rem",color:"green"}}),o.jsx("span",{children:i("Export to Excel")})]}),o.jsxs("div",{className:h.exportOption,onClick:_e,children:[o.jsx(ze,{style:{fontSize:"1.1rem",color:"red"}}),o.jsx("span",{children:i("Export to PDF")})]})]})]})})]})}),X&&o.jsx("div",{className:h.loadingOverlay,children:o.jsx("img",{src:Ue,alt:"Loading...",width:50,height:50})}),$.length==1&&!k&&!X?o.jsx("div",{className:`${h.NoDataOverlay} fs-5`,children:i("No Data Found")}):"",k?o.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"333px"},children:o.jsxs("table",{className:`table  ${b=="dark"?"table-dark":""}`,children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{scope:"col",children:"#"}),o.jsx("th",{scope:"col",children:i("Date")}),o.jsx("th",{scope:"col",children:i(f)}),o.jsxs("th",{scope:"col",children:[i("Sales"),"(₹)"]})]})}),o.jsx("tbody",{children:$.map((t,e)=>o.jsxs("tr",{children:[o.jsx("th",{scope:"row",children:$.length-1===e?"":e+1}),o.jsx("td",{children:t.requestedDate}),o.jsx("td",{children:t.productName}),o.jsx("td",{children:parseFloat(t.totalSales).toFixed(2)})]},`${t.requestedDate} ${t.productName}`))})]})}):o.jsx(He,{option:be,notMerge:De,style:{height:"341px",width:"100%",maxWidth:"2300px"},className:h.piechart,onEvents:{click:je}},se.length)]})})};export{$t as default};
