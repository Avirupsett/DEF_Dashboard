import{_ as Z}from"./index-154f7bfb.js";import{r as g,u as _t,L as St,j as t,T as wt,M as Ct,N as tt,i as Ft,A as jt,B as Nt,O as $t,E as vt,G as Dt,a as z}from"./vendor-5be16ce1.js";import{k as kt,l as Ot,E as Bt,Q as v,a as et,f as Tt,b as Pt}from"./NotoSansDevanagari-VariableFont_wdth_wght-d6392853.js";const Et="_piechart_1ah4s_11",zt="_chartContainer_1ah4s_23",Lt="_legendButtonContainer_1ah4s_49",Wt="_legendButton_1ah4s_49",It="_codeBlockIcon_1ah4s_133",Qt="_lightMode_1ah4s_191",Rt="_dateFilter_1ah4s_195",Ht="_officefilter_1ah4s_351",At="_topContainer_1ah4s_443",Mt="_darkMode_1ah4s_463",Gt="_iconsContainer_1ah4s_631",qt="_icon_1ah4s_631",Ut="_exportOptions_1ah4s_715",Vt="_exportOption_1ah4s_715",Yt="_NoDataOverlay_1ah4s_861",Jt="_tableContainer_1ah4s_993",Xt="_table_1ah4s_993",Kt="_summaryHeader_1ah4s_1029",Zt="_periodHeader_1ah4s_1037",te="_closeButton_1ah4s_1069",ee="_tableWrapper_1ah4s_1099",oe="_loadingOverlay_1ah4s_1107",ae="_loadingSpinner_1ah4s_1133",ne="_boldOption_1ah4s_1145",se="_optionGroup_1ah4s_1155",r={piechart:Et,chartContainer:zt,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:Lt,legendButton:Wt,codeBlockIcon:It,lightMode:Qt,"label-text":"_label-text_1ah4s_191",dateFilter:Rt,officefilter:Ht,topContainer:At,darkMode:Mt,"theme-container":"_theme-container_1ah4s_473",iconsContainer:Gt,icon:qt,exportOptions:Ut,exportOption:Vt,NoDataOverlay:Yt,tableContainer:Jt,table:Xt,summaryHeader:Kt,periodHeader:Zt,closeButton:te,tableWrapper:ee,loadingOverlay:oe,loadingSpinner:ae,boldOption:ne,optionGroup:se},de=({themeMode:y,selectedRange:w,selectedOffice:U,isAdmin:ot,alldata:L,isLoading:V,officeName:B})=>{const[_,at]=g.useState([]),[Y,nt]=g.useState([]),[W,st]=g.useState([]),[I,D]=g.useState(!1),Q=g.useRef(null),R=g.useRef(null),H=g.useRef(null),{t:e}=_t(),[A,M]=g.useState(!1),[T,rt]=g.useState([]),[k,G]=g.useState(!1),[C,lt]=g.useState("Sale");function it(a){return a.flatMap(d=>d.lstproduct).reduce((d,h)=>{const{productName:n,totalSales:p,qty:x,color:F,unitShortName:l}=h;return p!==0&&(d[n]?(d[n].totalSales+=p,d[n].qty+=x):d[n]={totalSales:p,qty:x,color:F,unitShortName:l}),d},{})}g.useEffect(()=>{const a=N(w[0]),o=N(w[1]);if(a&&o&&U&&L.graph2){const c=it(L.graph2),d=Object.entries(c).map(([l,{totalSales:i,color:s}])=>({value:i,name:l,itemStyle:{color:s}}));st(d);const h=Object.entries(c).map(([l,{qty:i,color:s}])=>({value:i,name:l,itemStyle:{color:s}}));nt(h);const n=Object.entries(c).map(([l,{totalSales:i,color:s,qty:S,unitShortName:$}])=>({productName:l,totalSale:i,color:s,totalQty:S,unit:$}));at(n);const p=Object.entries(c).map(([l,{totalSales:i,qty:s,unitShortName:S}])=>({ProductName:l,Sales:i,Quantity:`${s} ${S}`})),x=n.reduce((l,i)=>l+i.totalSale,0).toFixed(2),F=n.reduce((l,i)=>l+i.totalQty,0);p.push({ProductName:e("Total"),Sales:`${x}`,Quantity:`${F}`}),rt(p)}},[w,U,ot,L]);const ct=()=>{_.length>0&&(M(!A),D(!1),G(!1))},dt={tooltip:{trigger:"item",formatter:C==="Sale"?`<b>{b}</b><br><b>${e("Total Sales")}:</b> {c}`:`<b>{b}</b><br><b>${e("Total Qty")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:y==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:A,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:y==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"2%",style:{fill:y==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Sales",type:"pie",radius:C==="Sale"?["40%","65%"]:["35%","70%"],roseType:C==="Sale"?"":"radius",center:["50%","50%"],selectedMode:"single",avoidLabelOverlap:!0,label:{show:W.length<=10,color:y==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:C==="Sale"?W.length>0?W:[]:Y.length>0?Y:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},J=a=>{let o="";const c=new Uint8Array(a),d=c.byteLength;for(let h=0;h<d;h++)o+=String.fromCharCode(c[h]);return window.btoa(o)},N=a=>{if(!a)return"";const o=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0");return`${String(a.getDate()).padStart(2,"0")}-${c}-${o}`},ht=async()=>{const a=v.loading("Please wait..."),o=N(w[0]),c=N(w[1]),d=await Z(()=>import("./exceljs.min-fd769190.js").then(p=>p.e),["assets/exceljs.min-fd769190.js","assets/vendor-5be16ce1.js"]),h=new d.Workbook,n=h.addWorksheet("Data");fetch(et).then(p=>p.blob()).then(async p=>{const x=new FileReader;x.onload=async function(){const F=x.result,l=h.addImage({base64:F,extension:"png"});n.addImage(l,{tl:{col:0,row:0},ext:{width:100,height:60}});const i=n.getCell("A1");i.value=`${e("Product Wise Summary Data")} (${B})`,i.font={bold:!0,color:{argb:"000000"},size:14},i.alignment={vertical:"middle",horizontal:"center"},n.mergeCells("A1:D1");const s=n.getCell("A2");s.value=`${e("Period")}: ${o} ${e("to")} ${c}`,s.font={bold:!0,color:{argb:"000000"},size:12},s.alignment={horizontal:"center"},n.mergeCells("A2:D2"),n.getColumn(1).width=15,n.getColumn(2).width=50,n.getColumn(3).width=15,n.getColumn(4).width=15;const S=n.addRow([e("#"),e("Product Name"),e("Quantity"),e("Total Sales")]);S.font={bold:!0,color:{argb:"000000"},size:12},S.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),_.forEach((u,b)=>{const m=n.addRow([b+1,u.productName,`${u.totalQty} ${u.unit}`,u.totalSale]);m.getCell(1).alignment={horizontal:"left"},m.getCell(2).alignment={horizontal:"left"},m.getCell(3).alignment={horizontal:"right"},m.getCell(4).alignment={horizontal:"right"}});const $=n.addRow(["",e("Total"),"",""]);$.font={bold:!0,color:{argb:"000000"},size:12};const P=_.reduce((u,b)=>u+b.totalSale,0);_.reduce((u,b)=>u+b.totalQty,0);const O=n.getCell(`D${$.number}`);O.value=`₹ ${P.toFixed(2)}`,O.alignment={horizontal:"right"};const q=`${Date.now()}product_wise_summary_${B}_${o}_${c}.xlsx`;h.xlsx.writeBuffer().then(async u=>{const b=new FormData;b.append("file",new Blob([u]),q);try{const m=await z.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",b,{headers:{"Content-Type":"multipart/form-data"}});m.status==200?v.update(a,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(a,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const E=m.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${E}`}catch(m){console.error("Error saving Excel file:",m)}})},x.readAsDataURL(p)})},ut=async()=>{const a=v.loading("Please wait..."),o=N(w[0]),c=N(w[1]),h=new URLSearchParams(window.location.search).get("lang"),n=await z.get(Tt,{responseType:"arraybuffer"}),p=J(n.data),x=await z.get(Pt,{responseType:"arraybuffer"}),F=J(x.data);Z(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-d6392853.js").then(l=>l.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-d6392853.js","assets/vendor-5be16ce1.js","assets/index-154f7bfb.js","assets/index-a647bc22.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async l=>{let i=l.default;const s=new i;s.addFileToVFS("NotoSansBengali.ttf",p),s.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),s.setFont("NotoSansBengali"),s.addFileToVFS("NotoSansDevanagari.ttf",F),s.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),s.setFont("NotoSansDevanagari");const S=[[e("#"),e("Product Name"),e("Quantity"),e("Total Sale")]],$={0:{halign:"center"},1:{halign:"center"},2:{halign:"center"},3:{halign:"center"}},P={fontSize:12,fontStyle:"bold",halign:"center"},O={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},X=et,q=35,u=20;s.addImage(X,"PNG",15,12,q,u);const b=[[`${e("Product Wise Summary Data")} (${B})`]];s.autoTable({head:b,body:[],headStyles:{...P,fillColor:O.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:h==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const m=[[`${e("Period")}: ${o} ${e("to")} ${c}`]];s.autoTable({startY:39.5,head:m,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:h==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let E=_.map((f,j)=>[j+1,f.productName,`${f.totalQty} ${f.unit}`,`₹ ${f.totalSale.toFixed(2)}`]);const mt=_.reduce((f,j)=>f+j.totalSale,0);_.reduce((f,j)=>f+j.totalQty,0),E.push(["",e("Total"),"",`₹ ${mt.toFixed(2)}`]);const yt={startY:s.autoTable.previous.finalY+1,head:S,body:E,headStyles:{...P,fillColor:O.secondHeader,textColor:"#FFFFFF"},columnStyles:$,styles:{font:h==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};s.autoTable(yt);const xt=`${Date.now()}product_wise_summary_${B}_${o}_${c}.pdf`,bt=s.output("blob"),K=new FormData;K.append("file",bt,xt);try{const f=await z.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",K,{headers:{"Content-Type":"multipart/form-data"}});f.status==200?v.update(a,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):v.update(a,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const j=await f.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${j}`}catch(f){console.error("Error saving PDF file:",f)}})};g.useEffect(()=>{const a=o=>{Q.current&&!Q.current.contains(o.target)&&R.current&&!R.current.contains(o.target)&&o.target.tagName!=="svg"&&o.target.tagName!=="path"&&D(!1),H.current&&!H.current.contains(o.target)&&M(!1)};return document.addEventListener("click",a),()=>{document.removeEventListener("click",a)}},[]);const pt=()=>{M(!1),D(!I)},ft=(a,o)=>{o!==null&&lt(o)},gt=St({typography:{button:{textTransform:"none"}}});return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${r.chartContainer} ${y==="dark"?r.darkMode:r.lightMode}`,children:[t.jsx(kt,{position:"top-center",theme:y}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:r.legendButton,onClick:ct,ref:H,children:[t.jsx("img",{src:"https://def-pumps.inspirigenceworks.co.in/images/code-block.png",alt:"Code Block Icon",className:r.codeBlockIcon,title:"Legends",style:{filter:A||_.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:`fw-bold me-2 fs-${window.innerWidth<=768?7:5} ${y==="dark"?r.darkMode:r.lightMode}`,children:e("Product")}),t.jsx(wt,{theme:gt,children:t.jsxs(Ct,{size:"small",color:"primary",value:C,exclusive:!0,onChange:ft,"aria-label":"Platform",style:{fontFamily:'"Public Sans", sans-serif !important'},children:[t.jsx(tt,{style:{color:C=="Sale"?"":"var(--text-color)"},className:`fw-bold fs-${window.innerWidth<=1300?7:6}`,value:"Sale",children:e("Sale")}),t.jsx(tt,{style:{color:C=="Qty"?"":"var(--text-color)"},className:`fw-bold fs-${window.innerWidth<=1300?7:6}`,value:"Qty",children:e("Qty")})]})})]}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:Q,children:t.jsxs("div",{className:`${r.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${r.icon} ${y==="dark"?r.darkMode:r.lightMode} px-2 py-1`,onClick:pt,children:I?t.jsx(Ft,{style:{fontSize:"1.1rem"}}):t.jsx(jt,{style:{fontSize:"1.1rem"}})}),I&&t.jsxs("div",{className:`${r.exportOptions} ${y==="dark"?r.darkMode:r.lightMode}`,ref:R,children:[k?t.jsxs("div",{className:r.exportOption,onClick:()=>{G(!k),D(!1)},children:[t.jsx($t,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:r.exportOption,onClick:()=>{G(!k),D(!1)},children:[t.jsx(Nt,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:r.exportOption,onClick:ht,children:[t.jsx(vt,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:r.exportOption,onClick:ut,children:[t.jsx(Dt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),V&&t.jsx("div",{className:r.NoDataOverlay,children:t.jsx("img",{src:Ot,alt:"Loading...",width:50,height:50})}),T.length==1&&!k&&!V?t.jsx("div",{className:`${r.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",k?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"289px"},children:t.jsxs("table",{className:`table  ${y=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:T.map((a,o)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:T.length-1===o?"":o+1}),t.jsx("td",{children:a.ProductName}),t.jsx("td",{children:T.length-1===o?"":a.Quantity}),t.jsx("td",{children:parseFloat(a.Sales).toFixed(2)})]},a.ProductName))})]})}):t.jsx(Bt,{option:dt,style:{height:"297px",width:"100%",maxWidth:"2300px"},className:r.piechart},_.length)]})})};export{de as default};
