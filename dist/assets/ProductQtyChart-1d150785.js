import{_ as J}from"./index-fa8b92ad.js";import{r as y,u as pt,j as t,i as ft,A as ht,B as gt,L as yt,E as mt,G as _t,a as T}from"./vendor-ff86a3b6.js";import{k as xt,l as bt,E as St,Q as N,a as X,f as wt,b as Ct}from"./NotoSansDevanagari-VariableFont_wdth_wght-133c39b0.js";const Ft="_piechart_yc0ui_11",Nt="_chartContainer_yc0ui_23",jt="_legendButtonContainer_yc0ui_49",kt="_legendButton_yc0ui_49",Dt="_codeBlockIcon_yc0ui_133",vt="_lightMode_yc0ui_191",$t="_dateFilter_yc0ui_195",Ot="_officefilter_yc0ui_351",Bt="_topContainer_yc0ui_443",Pt="_darkMode_yc0ui_463",Tt="_iconsContainer_yc0ui_631",Et="_icon_yc0ui_631",Lt="_exportOptions_yc0ui_715",zt="_NoDataOverlay_yc0ui_741",Wt="_exportOption_yc0ui_715",It="_tableContainer_yc0ui_999",Qt="_table_yc0ui_999",Rt="_summaryHeader_yc0ui_1035",Ht="_periodHeader_yc0ui_1043",At="_closeButton_yc0ui_1075",Mt="_tableWrapper_yc0ui_1105",qt="_loadingOverlay_yc0ui_1113",Gt="_loadingSpinner_yc0ui_1139",Ut="_boldOption_yc0ui_1151",Vt="_optionGroup_yc0ui_1161",s={piechart:Ft,chartContainer:Nt,"legend-text":"_legend-text_yc0ui_31",legendButtonContainer:jt,legendButton:kt,codeBlockIcon:Dt,lightMode:vt,"label-text":"_label-text_yc0ui_191",dateFilter:$t,officefilter:Ot,topContainer:Bt,darkMode:Pt,"theme-container":"_theme-container_yc0ui_473",iconsContainer:Tt,icon:Et,exportOptions:Lt,NoDataOverlay:zt,exportOption:Wt,tableContainer:It,table:Qt,summaryHeader:Rt,periodHeader:Ht,closeButton:At,tableWrapper:Mt,loadingOverlay:qt,loadingSpinner:Gt,boldOption:Ut,optionGroup:Vt},Zt=({themeMode:_,selectedRange:S,selectedOffice:q,isAdmin:K,alldata:E,isLoading:G})=>{const[x,Z]=y.useState([]),[L,j]=y.useState(!1),z=y.useRef(null),W=y.useRef(null),I=y.useRef(null),[Q,R]=y.useState(!1),[$,tt]=y.useState([]),[k,H]=y.useState(!1),[A,et]=y.useState([]),{t:e}=pt();function ot(o){return o.flatMap(c=>c.lstproduct).reduce((c,l)=>{const{productName:n,totalSales:f,qty:m,color:d,unitShortName:i}=l;return f!==0&&(c[n]?(c[n].totalSales+=f,c[n].qty+=m):c[n]={totalSales:f,qty:m,color:d,unitShortName:i}),c},{})}y.useEffect(()=>{const o=w(S[0]),a=w(S[1]);if(o&&a&&q&&E.graph2){const p=ot(E.graph2),c=Object.entries(p).map(([d,{qty:i,color:g}])=>({value:i,name:d,itemStyle:{color:g}}));et(c);const l=Object.entries(p).map(([d,{totalSales:i,color:g,qty:r,unitShortName:C}])=>({productName:d,totalSale:i,color:g,totalQty:r,unit:C}));Z(l);let n=Object.entries(p).map(([d,{totalSales:i,qty:g,unitShortName:r}])=>({ProductName:d,Sales:i,Quantity:`${g} ${r}`}));const f=l.reduce((d,i)=>d+i.totalSale,0).toFixed(2),m=l.reduce((d,i)=>d+i.totalQty,0);n.push({ProductName:e("Total"),Sales:`${f}`,Quantity:`${m}`}),tt(n)}},[S,q,K,E]);const at=()=>{x.length>0&&R(!Q),j(!1),H(!1)},nt={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${e("Total Qty")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:_==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:Q,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:_==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"top",style:{fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Qty",type:"pie",radius:["35%","70%"],center:["50%","50%"],roseType:"radius",selectedMode:"single",avoidLabelOverlap:!0,label:{show:A.length<=10,color:_==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:A.length>0?A:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},U=o=>{let a="";const p=new Uint8Array(o),c=p.byteLength;for(let l=0;l<c;l++)a+=String.fromCharCode(p[l]);return window.btoa(a)},w=o=>{if(!o)return"";const a=o.getFullYear(),p=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0");return`${a}-${p}-${c}`},st=async()=>{const o=N.loading("Please wait..."),a=w(S[0]),p=w(S[1]),c=await J(()=>import("./exceljs.min-e7dcf029.js").then(f=>f.e),["assets/exceljs.min-e7dcf029.js","assets/vendor-ff86a3b6.js"]),l=new c.Workbook,n=l.addWorksheet("Data");fetch(X).then(f=>f.blob()).then(async f=>{const m=new FileReader;m.onload=async function(){const d=m.result,i=l.addImage({base64:d,extension:"png"});n.addImage(i,{tl:{col:0,row:0},ext:{width:100,height:70}});const g=n.getCell("A2");g.value=e("Product Wise Summary Data"),g.font={bold:!0,color:{argb:"000000"},size:14},g.alignment={vertical:"middle",horizontal:"center"},n.mergeCells("A2:C2");const r=n.getCell("A3");r.value=`${e("Period")}: ${a} ${e("to")} ${p}`,r.font={bold:!0,color:{argb:"000000"},size:12},r.alignment={horizontal:"center"},n.mergeCells("A3:C3"),n.getColumn(1).width=50,n.getColumn(2).width=15;const C=n.addRow([e("Product Name"),e("Quantity"),e("Total Sales")]);C.font={bold:!0,color:{argb:"000000"},size:12},C.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),x.forEach(u=>{n.addRow([u.productName,`${u.totalQty} ${u.unit}`,`₹${u.totalSale}`])});const O=n.addRow([e("Total"),"",""]);O.font={bold:!0,color:{argb:"000000"},size:12};const B=x.reduce((u,b)=>u+b.totalSale,0);x.reduce((u,b)=>u+b.totalQty,0);const D=n.getCell(`C${O.number}`);D.value=`₹${B.toFixed(2)}`,D.alignment={horizontal:"right"};const M=`${Date.now()}_product_wise_summary_data.xlsx`;l.xlsx.writeBuffer().then(async u=>{const b=new FormData;b.append("file",new Blob([u]),M);try{const F=await T.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",b,{headers:{"Content-Type":"multipart/form-data"}});F.status==200?N.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):N.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const P=F.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${P}`}catch(F){console.error("Error saving Excel file:",F)}})},m.readAsDataURL(f)})},rt=async()=>{const o=N.loading("Please wait..."),a=w(S[0]),p=w(S[1]),l=new URLSearchParams(window.location.search).get("lang"),n=await T.get(wt,{responseType:"arraybuffer"}),f=U(n.data),m=await T.get(Ct,{responseType:"arraybuffer"}),d=U(m.data);J(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-133c39b0.js").then(i=>i.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-133c39b0.js","assets/vendor-ff86a3b6.js","assets/index-fa8b92ad.js","assets/index-4da97eed.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async i=>{let g=i.default;const r=new g;r.addFileToVFS("NotoSansBengali.ttf",f),r.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),r.setFont("NotoSansBengali"),r.addFileToVFS("NotoSansDevanagari.ttf",d),r.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),r.setFont("NotoSansDevanagari");const C=[[e("Product Name"),e("Quantity"),e("Total Sale")]],O={1:{halign:"right"},2:{halign:"right"}},B={fontSize:12,fontStyle:"bold",halign:"center"},D={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},V=X,M=35,u=20;r.addImage(V,"PNG",15,12,M,u);const b=[[e("Product Wise Summary Data")]];r.autoTable({head:b,body:[],headStyles:{...B,fillColor:D.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const F=[[`${e("Period")}: ${a} ${e("to")} ${p}`]];r.autoTable({startY:39.5,head:F,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let P=x.map(h=>[h.productName,`${h.totalQty} ${h.unit}`,h.totalSale.toFixed(2)]);const it=x.reduce((h,v)=>h+v.totalSale,0);x.reduce((h,v)=>h+v.totalQty,0),P.push([e("Total"),"",`${it.toFixed(2)}`]);const ct={startY:r.autoTable.previous.finalY+1,head:C,body:P,headStyles:{...B,fillColor:D.secondHeader,textColor:"#FFFFFF"},columnStyles:O,styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};r.autoTable(ct);const dt=`${Date.now()}_product_wise_summary_data.pdf`,ut=r.output("blob"),Y=new FormData;Y.append("file",ut,dt);try{const h=await T.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",Y,{headers:{"Content-Type":"multipart/form-data"}});h.status==200?N.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):N.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const v=await h.data.url;window.location.href=`https://def-dash-route-api.inspirigenceworks.co.in/static/downloads/${v}`}catch(h){console.error("Error saving PDF file:",h)}})};y.useEffect(()=>{const o=a=>{z.current&&!z.current.contains(a.target)&&W.current&&!W.current.contains(a.target)&&a.target.tagName!=="svg"&&a.target.tagName!=="path"&&j(!1),I.current&&!I.current.contains(a.target)&&R(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const lt=()=>{R(!1),j(!L)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${s.chartContainer} ${_==="dark"?s.darkMode:s.lightMode}`,children:[t.jsx(xt,{position:"top-center",theme:_}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:s.legendButton,onClick:at,ref:I,children:[t.jsx("img",{src:"https://def-pumps.inspirigenceworks.co.in/images/code-block.png",alt:"Code Block Icon",className:s.codeBlockIcon,title:"Legends",style:{filter:Q||x.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${_==="dark"?s.darkMode:s.lightMode}`,children:e("Product Wise Qty")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:z,children:t.jsxs("div",{className:`${s.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${s.icon} ${_==="dark"?s.darkMode:s.lightMode} px-2 py-1`,onClick:lt,children:L?t.jsx(ft,{style:{fontSize:"1.1rem"}}):t.jsx(ht,{style:{fontSize:"1.1rem"}})}),L&&t.jsxs("div",{className:`${s.exportOptions} ${_==="dark"?s.darkMode:s.lightMode}`,ref:W,children:[k?t.jsxs("div",{className:s.exportOption,onClick:()=>{H(!k),j(!1)},children:[t.jsx(yt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:s.exportOption,onClick:()=>{H(!k),j(!1)},children:[t.jsx(gt,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:s.exportOption,onClick:st,children:[t.jsx(mt,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:s.exportOption,onClick:rt,children:[t.jsx(_t,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),G&&t.jsx("div",{className:s.NoDataOverlay,children:t.jsx("img",{src:bt,alt:"Loading...",width:50,height:50})}),$.length==0&&!k&&!G?t.jsx("div",{className:`${s.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",k?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${_=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:$.map((o,a)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:$.length-1===a?"":a+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:$.length-1===a?"":o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(St,{option:nt,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:s.piechart},x.length)]})})};export{Zt as default};
