import{_ as K}from"./index-2c5bb4bd.js";import{r as m,u as ht,j as t,i as ft,A as gt,B as mt,L as xt,E as _t,G as yt,a as T}from"./vendor-ff86a3b6.js";import{k as bt,l as St,E as wt,Q as N,a as Z,f as Ct,b as Ft}from"./NotoSansDevanagari-VariableFont_wdth_wght-8bb09184.js";const Nt="_piechart_1ah4s_11",jt="_chartContainer_1ah4s_23",kt="_legendButtonContainer_1ah4s_49",Dt="_legendButton_1ah4s_49",vt="_codeBlockIcon_1ah4s_133",$t="_lightMode_1ah4s_191",Ot="_dateFilter_1ah4s_195",Bt="_officefilter_1ah4s_351",Pt="_topContainer_1ah4s_443",Tt="_darkMode_1ah4s_463",Et="_iconsContainer_1ah4s_631",zt="_icon_1ah4s_631",Lt="_exportOptions_1ah4s_715",Wt="_exportOption_1ah4s_715",It="_NoDataOverlay_1ah4s_861",Qt="_tableContainer_1ah4s_993",Rt="_table_1ah4s_993",Ht="_summaryHeader_1ah4s_1029",At="_periodHeader_1ah4s_1037",Mt="_closeButton_1ah4s_1069",qt="_tableWrapper_1ah4s_1099",Gt="_loadingOverlay_1ah4s_1107",Ut="_loadingSpinner_1ah4s_1133",Vt="_boldOption_1ah4s_1145",Yt="_optionGroup_1ah4s_1155",n={piechart:Nt,chartContainer:jt,"legend-text":"_legend-text_1ah4s_31",legendButtonContainer:kt,legendButton:Dt,codeBlockIcon:vt,lightMode:$t,"label-text":"_label-text_1ah4s_191",dateFilter:Ot,officefilter:Bt,topContainer:Pt,darkMode:Tt,"theme-container":"_theme-container_1ah4s_473",iconsContainer:Et,icon:zt,exportOptions:Lt,exportOption:Wt,NoDataOverlay:It,tableContainer:Qt,table:Rt,summaryHeader:Ht,periodHeader:At,closeButton:Mt,tableWrapper:qt,loadingOverlay:Gt,loadingSpinner:Ut,boldOption:Vt,optionGroup:Yt},te=({themeMode:x,selectedRange:S,selectedOffice:G,isAdmin:tt,alldata:E,isLoading:U})=>{const[y,et]=m.useState([]),[z,ot]=m.useState([]),[L,j]=m.useState(!1),W=m.useRef(null),I=m.useRef(null),Q=m.useRef(null),{t:e}=ht(),[R,H]=m.useState(!1),[V,at]=m.useState([]),[k,A]=m.useState(!1);function nt(o){return o.flatMap(c=>c.lstproduct).reduce((c,l)=>{const{productName:a,totalSales:h,qty:_,color:d,unitShortName:i}=l;return h!==0&&(c[a]?(c[a].totalSales+=h,c[a].qty+=_):c[a]={totalSales:h,qty:_,color:d,unitShortName:i}),c},{})}m.useEffect(()=>{const o=w(S[0]),r=w(S[1]);if(o&&r&&G&&E.graph2){const p=nt(E.graph2),c=Object.entries(p).map(([d,{totalSales:i,color:g}])=>({value:i,name:d,itemStyle:{color:g}}));ot(c);const l=Object.entries(p).map(([d,{totalSales:i,color:g,qty:s,unitShortName:C}])=>({productName:d,totalSale:i,color:g,totalQty:s,unit:C}));et(l);const a=Object.entries(p).map(([d,{totalSales:i,qty:g,unitShortName:s}])=>({ProductName:d,Sales:i,Quantity:`${g} ${s}`})),h=l.reduce((d,i)=>d+i.totalSale,0).toFixed(2),_=l.reduce((d,i)=>d+i.totalQty,0);a.push({ProductName:e("Total"),Sales:`${h}`,Quantity:`${_}`}),at(a)}},[S,G,tt,E]);const st=()=>{y.length>0&&(H(!R),j(!1),A(!1))},rt={tooltip:{trigger:"item",formatter:`<b>{b}</b><br><b>${e("Total Sales")}:</b> {c}`,textStyle:{fontSize:window.innerWidth<=768?10:14}},legend:{orient:"vertical",backgroundColor:x==="dark"?"#111111df":"rgb(249 249 249 / 97%)",left:"8px",top:"0",borderRadius:7,padding:10,show:R,shadowColor:"#ececec",borderColor:"rgba(57, 50, 50, 0.7)",borderWidth:1,itemGap:10,textStyle:{color:x==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?12:14,padding:4},type:"scroll",scroll:{show:!0,orient:"horizontal"}},graphic:{type:"text",left:"center",top:"2%",style:{fill:x==="dark"?"#ffffff":"#000000",fontSize:window.innerWidth<=1496?16:18,fontWeight:"bold"}},series:[{name:"Product Sales",type:"pie",radius:["40%","65%"],center:["50%","50%"],selectedMode:"single",avoidLabelOverlap:!0,label:{show:z.length<=10,color:x==="dark"?"#ffffff":"#111111"},emphasis:{label:{show:!0,fontSize:9,fontWeight:"bold"}},data:z.length>0?z:[],itemStyle:{borderWidth:2,borderColor:"#ffffff00",borderRadius:4}}]},Y=o=>{let r="";const p=new Uint8Array(o),c=p.byteLength;for(let l=0;l<c;l++)r+=String.fromCharCode(p[l]);return window.btoa(r)},w=o=>{if(!o)return"";const r=o.getFullYear(),p=String(o.getMonth()+1).padStart(2,"0"),c=String(o.getDate()).padStart(2,"0");return`${r}-${p}-${c}`},lt=async()=>{const o=N.loading("Please wait..."),r=w(S[0]),p=w(S[1]),c=await K(()=>import("./exceljs.min-e7dcf029.js").then(h=>h.e),["assets/exceljs.min-e7dcf029.js","assets/vendor-ff86a3b6.js"]),l=new c.Workbook,a=l.addWorksheet("Data");fetch(Z).then(h=>h.blob()).then(async h=>{const _=new FileReader;_.onload=async function(){const d=_.result,i=l.addImage({base64:d,extension:"png"});a.addImage(i,{tl:{col:0,row:0},ext:{width:100,height:70}});const g=a.getCell("A2");g.value=e("Product Wise Summary Data"),g.font={bold:!0,color:{argb:"000000"},size:14},g.alignment={vertical:"middle",horizontal:"center"},a.mergeCells("A2:C2");const s=a.getCell("A3");s.value=`${e("Period")}: ${r} ${e("to")} ${p}`,s.font={bold:!0,color:{argb:"000000"},size:12},s.alignment={horizontal:"center"},a.mergeCells("A3:C3"),a.getColumn(1).width=50,a.getColumn(2).width=15;const C=a.addRow([e("Product Name"),e("Quantity"),e("Total Sales")]);C.font={bold:!0,color:{argb:"000000"},size:12},C.eachCell(u=>{u.font={bold:!0,color:{argb:"000000"},size:12},u.border={bottom:{style:"thin",color:{argb:"000000"}}}}),y.forEach(u=>{a.addRow([u.productName,`${u.totalQty} ${u.unit}`,`₹${u.totalSale}`])});const D=a.addRow([e("Total"),"",""]);D.font={bold:!0,color:{argb:"000000"},size:12};const $=y.reduce((u,b)=>u+b.totalSale,0),O=y.reduce((u,b)=>u+b.totalQty,0),B=a.getCell(`B${D.number}`);B.value=`${O.toFixed(2)}`,B.alignment={horizontal:"right"};const P=a.getCell(`C${D.number}`);P.value=`₹${$.toFixed(2)}`,P.alignment={horizontal:"right"};const M=`${Date.now()}_product_wise_summary_data.xlsx`;l.xlsx.writeBuffer().then(async u=>{const b=new FormData;b.append("file",new Blob([u]),M);try{const F=await T.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",b,{headers:{"Content-Type":"multipart/form-data"}});F.status==200?N.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):N.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const q=F.data.url;window.location.replace(`https://def-dash-route-api.inspirigenceworks.co.in/static/${q}`)}catch(F){console.error("Error saving Excel file:",F)}})},_.readAsDataURL(h)})},it=async()=>{const o=N.loading("Please wait..."),r=w(S[0]),p=w(S[1]),l=new URLSearchParams(window.location.search).get("lang"),a=await T.get(Ct,{responseType:"arraybuffer"}),h=Y(a.data),_=await T.get(Ft,{responseType:"arraybuffer"}),d=Y(_.data);K(()=>import("./NotoSansDevanagari-VariableFont_wdth_wght-8bb09184.js").then(i=>i.j),["assets/NotoSansDevanagari-VariableFont_wdth_wght-8bb09184.js","assets/vendor-ff86a3b6.js","assets/index-2c5bb4bd.js","assets/index-4da97eed.css","assets/NotoSansDevanagari-VariableFont_wdth_wght-55fec1ff.css"]).then(async i=>{let g=i.default;const s=new g;s.addFileToVFS("NotoSansBengali.ttf",h),s.addFont("NotoSansBengali.ttf","NotoSansBengali","normal"),s.setFont("NotoSansBengali"),s.addFileToVFS("NotoSansDevanagari.ttf",d),s.addFont("NotoSansDevanagari.ttf","NotoSansDevanagari","normal"),s.setFont("NotoSansDevanagari");const C=[[e("Product Name"),e("Quantity"),e("Total Sale")]],D={1:{halign:"right"},2:{halign:"right"}},$={fontSize:12,fontStyle:"bold",halign:"center"},O={summaryHeader:"#3CB043",secondHeader:"#75AAF0"},B=Z,P=35,J=20;s.addImage(B,"PNG",15,12,P,J);const M=[[e("Product Wise Summary Data")]];s.autoTable({head:M,body:[],headStyles:{...$,fillColor:O.summaryHeader,textColor:"#FFFFFF"},margin:{top:30},styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});const u=[[`${e("Period")}: ${r} ${e("to")} ${p}`]];s.autoTable({startY:39.5,head:u,body:[],headStyles:{fontSize:12,fontStyle:"bold",halign:"center",fillColor:"#3CB043",textColor:"#FFFFFF"},margin:{top:30},styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}});let b=y.map(f=>[f.productName,`${f.totalQty} ${f.unit}`,f.totalSale.toFixed(2)]);const F=y.reduce((f,v)=>f+v.totalSale,0),q=y.reduce((f,v)=>f+v.totalQty,0);b.push([e("Total"),`${q.toFixed(2)}`,`${F.toFixed(2)}`]);const dt={startY:s.autoTable.previous.finalY+1,head:C,body:b,headStyles:{...$,fillColor:O.secondHeader,textColor:"#FFFFFF"},columnStyles:D,styles:{font:l==="hi"?"NotoSansDevanagari":"NotoSansBengali",fontStyle:"bold"}};s.autoTable(dt);const ut=`${Date.now()}_product_wise_summary_data.pdf`,pt=s.output("blob"),X=new FormData;X.append("file",pt,ut);try{const f=await T.post("https://def-dash-route-api.inspirigenceworks.co.in/api/uploader",X,{headers:{"Content-Type":"multipart/form-data"}});f.status==200?N.update(o,{render:"Download Starting...",type:"success",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1}):N.update(o,{render:"Download Failed !",type:"error",isLoading:!1,autoClose:5e3,closeOnClick:!0,pauseOnFocusLoss:!1});const v=await f.data.url;window.location.replace(`https://def-dash-route-api.inspirigenceworks.co.in/static/${v}`)}catch(f){console.error("Error saving PDF file:",f)}})};m.useEffect(()=>{const o=r=>{W.current&&!W.current.contains(r.target)&&I.current&&!I.current.contains(r.target)&&r.target.tagName!=="svg"&&r.target.tagName!=="path"&&j(!1),Q.current&&!Q.current.contains(r.target)&&H(!1)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}},[]);const ct=()=>{H(!1),j(!L)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${n.chartContainer} ${x==="dark"?n.darkMode:n.lightMode}`,children:[t.jsx(bt,{position:"top-center",theme:x}),t.jsx("div",{className:"container-fluid",children:t.jsxs("div",{className:"d-flex w-100 g-0 align-items-center justify-content-between",children:[t.jsxs("button",{className:n.legendButton,onClick:st,ref:Q,children:[t.jsx("img",{src:"https://def-pumps.inspirigenceworks.co.in/images/code-block.png",alt:"Code Block Icon",className:n.codeBlockIcon,title:"Legends",style:{filter:R||y.length===0?"opacity(0.4)":"opacity(1)",transition:"all .25s ease-in-out"}})," "]}),t.jsx("div",{className:`fw-bold fs-${window.innerWidth<=768?7:5} ${x==="dark"?n.darkMode:n.lightMode}`,children:e("Product Wise Sale")}),t.jsx("div",{title:"Export Options",className:"d-flex g-0",ref:W,children:t.jsxs("div",{className:`${n.iconsContainer} d-flex justify-content-center align-items-center`,children:[t.jsx("div",{className:`${n.icon} ${x==="dark"?n.darkMode:n.lightMode} px-2 py-1`,onClick:ct,children:L?t.jsx(ft,{style:{fontSize:"1.1rem"}}):t.jsx(gt,{style:{fontSize:"1.1rem"}})}),L&&t.jsxs("div",{className:`${n.exportOptions} ${x==="dark"?n.darkMode:n.lightMode}`,ref:I,children:[k?t.jsxs("div",{className:n.exportOption,onClick:()=>{A(!k),j(!1)},children:[t.jsx(xt,{style:{fontSize:"1.1rem",color:"#6c3fb5"}}),t.jsx("span",{children:e("View Graph")})]}):t.jsxs("div",{className:n.exportOption,onClick:()=>{A(!k),j(!1)},children:[t.jsx(mt,{style:{fontSize:"1.1rem",color:"#0d6efd"}}),t.jsx("span",{children:e("View Table")})]}),t.jsxs("div",{className:n.exportOption,onClick:lt,children:[t.jsx(_t,{style:{fontSize:"1.1rem",color:"green"}}),t.jsx("span",{children:e("Export to Excel")})]}),t.jsxs("div",{className:n.exportOption,onClick:it,children:[t.jsx(yt,{style:{fontSize:"1.1rem",color:"red"}}),t.jsx("span",{children:e("Export to PDF")})]})]})]})})]})}),U&&t.jsx("div",{className:n.NoDataOverlay,children:t.jsx("img",{src:St,alt:"Loading...",width:50,height:50})}),V.length==0&&!k&&!U?t.jsx("div",{className:`${n.NoDataOverlay} fs-5`,children:e("No Data Found")}):"",k?t.jsx("div",{className:"container-fluid mt-2 table-responsive",style:{height:"291px"},children:t.jsxs("table",{className:`table  ${x=="dark"?"table-dark":""}`,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",children:"#"}),t.jsx("th",{scope:"col",children:e("Product")}),t.jsx("th",{scope:"col",children:e("Quantity")}),t.jsxs("th",{scope:"col",children:[e("Sales"),"(₹)"]})]})}),t.jsx("tbody",{children:V.map((o,r)=>t.jsxs("tr",{children:[t.jsx("th",{scope:"row",children:r+1}),t.jsx("td",{children:o.ProductName}),t.jsx("td",{children:o.Quantity}),t.jsx("td",{children:parseFloat(o.Sales).toFixed(2)})]},o.ProductName))})]})}):t.jsx(wt,{option:rt,style:{height:"300px",width:"100%",maxWidth:"2300px"},className:n.piechart},y.length)]})})};export{te as default};
